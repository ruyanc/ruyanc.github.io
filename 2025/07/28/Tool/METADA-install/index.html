<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/Egg_32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/Egg_16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="METADA-install项目简介METADA (Modern Earth system Toolkit for Assimilation and Data Analysis) 是一个高性能、跨平台的数据同化框架，专为地球科学应用而设计。使用现代C++构建并针对性能进行了优化，METADA为在各种计算环境中实现、测试和部署数据同化算法提供了强大的基础设施。 安装环境说明本教程专门针对超算平台环境">
<meta property="og:type" content="article">
<meta property="og:title" content="ruyanc">
<meta property="og:url" content="http://example.com/2025/07/28/Tool/METADA-install/index.html">
<meta property="og:site_name" content="ruyanc">
<meta property="og:description" content="METADA-install项目简介METADA (Modern Earth system Toolkit for Assimilation and Data Analysis) 是一个高性能、跨平台的数据同化框架，专为地球科学应用而设计。使用现代C++构建并针对性能进行了优化，METADA为在各种计算环境中实现、测试和部署数据同化算法提供了强大的基础设施。 安装环境说明本教程专门针对超算平台环境">
<meta property="og:locale">
<meta property="article:published_time" content="2025-07-28T01:45:44.812Z">
<meta property="article:modified_time" content="2025-08-01T03:07:34.209Z">
<meta property="article:author" content="ruyanc">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2025/07/28/Tool/METADA-install/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title> | ruyanc</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">ruyanc</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Acedemic Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-atmsci">

    <a href="/categories/AtmSci/" rel="section"><i class="fa fa-graduation-cap fa-fw"></i>AtmSci</a>

  </li>
        <li class="menu-item menu-item-ocnsci">

    <a href="/categories/OcnSci/" rel="section"><i class="fa fa-graduation-cap fa-fw"></i>OcnSci</a>

  </li>
        <li class="menu-item menu-item-seminar">

    <a href="/categories/Seminar/" rel="section"><i class="fa fa-users fa-fw"></i>Seminar</a>

  </li>
        <li class="menu-item menu-item-readcube">

    <a href="/categories/ReadCube/" rel="section"><i class="fa fa-archive fa-fw"></i>ReadCube</a>

  </li>
        <li class="menu-item menu-item-publication">

    <a href="/categories/Publication" rel="section"><i class="fa fa-archive fa-fw"></i>Publication</a>

  </li>
        <li class="menu-item menu-item-recharge">

    <a href="/categories/Recharge/" rel="section"><i class="fa fa-coffee fa-fw"></i>Recharge</a>

  </li>
        <li class="menu-item menu-item-tool">

    <a href="/categories/Tool/" rel="section"><i class="fa fa-wrench fa-fw"></i>Tool</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/28/Tool/METADA-install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ruyanc">
      <meta itemprop="description" content="E-mail: ruyan1810@gmail.com">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruyanc">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-07-28 09:45:44" itemprop="dateCreated datePublished" datetime="2025-07-28T09:45:44+08:00">2025-07-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-08-01 11:07:34" itemprop="dateModified" datetime="2025-08-01T11:07:34+08:00">2025-08-01</time>
              </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="METADA-install"><a href="#METADA-install" class="headerlink" title="METADA-install"></a>METADA-install</h1><h2 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h2><p>METADA (Modern Earth system Toolkit for Assimilation and Data Analysis) 是一个高性能、跨平台的数据同化框架，专为地球科学应用而设计。使用现代C++构建并针对性能进行了优化，METADA为在各种计算环境中实现、测试和部署数据同化算法提供了强大的基础设施。</p>
<h2 id="安装环境说明"><a href="#安装环境说明" class="headerlink" title="安装环境说明"></a>安装环境说明</h2><p>本教程专门针对超算平台环境编写，适用于以下情况：</p>
<ul>
<li><strong>无sudo权限</strong>：无法使用系统包管理器安装软件</li>
<li><strong>网络限制</strong>：可能无法直接联网下载软件包</li>
<li><strong>模块化管理</strong>：使用Lmod进行软件环境管理</li>
<li><strong>用户空间安装</strong>：所有软件安装在用户目录下</li>
</ul>
<h3 id="环境变量设置"><a href="#环境变量设置" class="headerlink" title="环境变量设置"></a>环境变量设置</h3><p>在开始安装前，请设置以下环境变量（请根据你的实际路径修改）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置安装目录（请根据实际情况修改）</span></span><br><span class="line"><span class="built_in">export</span> INSTALL_DIR=<span class="string">&quot;<span class="variable">$HOME</span>/install_soft&quot;</span></span><br><span class="line"><span class="built_in">export</span> DOWNLOAD_DIR=<span class="string">&quot;<span class="variable">$HOME</span>/down_soft&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$INSTALL_DIR</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置PATH和库路径</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/bin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/lib:<span class="variable">$LD_LIBRARY_PATH</span>&quot;</span></span><br><span class="line"><span class="built_in">export</span> PKG_CONFIG_PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/lib/pkgconfig:<span class="variable">$PKG_CONFIG_PATH</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="安装逻辑概述"><a href="#安装逻辑概述" class="headerlink" title="安装逻辑概述"></a>安装逻辑概述</h2><p>本安装教程采用分层安装的方式，按照以下逻辑进行：</p>
<ol>
<li><strong>Lmod模块管理系统</strong> - 用于管理软件环境，可能依赖TCL</li>
<li><strong>HPC-Stack科学软件库</strong> - 安装必要的科学计算库，包括编译器、MPI、NetCDF等</li>
<li><strong>其他依赖库</strong> - 安装METADA项目特有的依赖库</li>
<li><strong>METADA本体编译</strong> - 配置环境变量，使用CMake编译METADA项目</li>
</ol>
<h2 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h2><h3 id="第一步：安装Lmod模块管理系统"><a href="#第一步：安装Lmod模块管理系统" class="headerlink" title="第一步：安装Lmod模块管理系统"></a>第一步：安装Lmod模块管理系统</h3><p>Lmod是一个用于管理软件环境的工具，在超算平台上广泛使用。我们需要先安装Lmod来管理后续的软件环境。</p>
<h4 id="1-1-安装Lua-5-4"><a href="#1-1-安装Lua-5-4" class="headerlink" title="1.1 安装Lua 5.4"></a>1.1 安装Lua 5.4</h4><p>Lmod依赖于Lua，首先安装Lua：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载Lua 5.4.6</span></span><br><span class="line">curl -L -R -O https://www.lua.org/ftp/lua-5.4.6.tar.gz</span><br><span class="line">tar zxf lua-5.4.6.tar.gz</span><br><span class="line"><span class="built_in">cd</span> lua-5.4.6</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改Makefile中的安装路径</span></span><br><span class="line">sed -i <span class="string">&quot;s|INSTALL_TOP= /usr/local|INSTALL_TOP= <span class="variable">$INSTALL_DIR</span>/lua|g&quot;</span> Makefile</span><br><span class="line">sed -i <span class="string">&quot;s|INSTALL_BIN= \$(INSTALL_TOP)/bin|INSTALL_BIN= \$(INSTALL_TOP)/bin|g&quot;</span> Makefile</span><br><span class="line">sed -i <span class="string">&quot;s|INSTALL_INC= \$(INSTALL_TOP)/include|INSTALL_INC= \$(INSTALL_TOP)/include|g&quot;</span> Makefile</span><br><span class="line">sed -i <span class="string">&quot;s|INSTALL_LIB= \$(INSTALL_TOP)/lib|INSTALL_LIB= \$(INSTALL_TOP)/lib|g&quot;</span> Makefile</span><br><span class="line">sed -i <span class="string">&quot;s|INSTALL_MAN= \$(INSTALL_TOP)/man/man1|INSTALL_MAN= \$(INSTALL_TOP)/man/man1|g&quot;</span> Makefile</span><br><span class="line">sed -i <span class="string">&quot;s|INSTALL_LMOD= \$(INSTALL_TOP)/share/lua/\$(V)|INSTALL_LMOD= \$(INSTALL_TOP)/share/lua/\$(V)|g&quot;</span> Makefile</span><br><span class="line">sed -i <span class="string">&quot;s|INSTALL_CMOD= \$(INSTALL_TOP)/lib/lua/\$(V)|INSTALL_CMOD= \$(INSTALL_TOP)/lib/lua/\$(V)|g&quot;</span> Makefile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译和安装</span></span><br><span class="line">make all <span class="built_in">test</span></span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置Lua环境变量</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/lua/bin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/lua/lib:<span class="variable">$LD_LIBRARY_PATH</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="1-2-安装LuaRocks"><a href="#1-2-安装LuaRocks" class="headerlink" title="1.2 安装LuaRocks"></a>1.2 安装LuaRocks</h4><p>LuaRocks是Lua的包管理器，用于安装Lua模块：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载LuaRocks</span></span><br><span class="line">wget https://luarocks.org/releases/luarocks-3.9.2.tar.gz</span><br><span class="line">tar zxpf luarocks-3.9.2.tar.gz</span><br><span class="line"><span class="built_in">cd</span> luarocks-3.9.2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置和安装</span></span><br><span class="line">./configure --prefix=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/luarocks&quot;</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置LuaRocks环境变量</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/luarocks/bin:<span class="variable">$PATH</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="1-3-安装luaposix"><a href="#1-3-安装luaposix" class="headerlink" title="1.3 安装luaposix"></a>1.3 安装luaposix</h4><p>luaposix是Lua的POSIX接口库，Lmod需要这个模块：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入LuaRocks安装目录</span></span><br><span class="line"><span class="built_in">cd</span> <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/luarocks/bin&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装luaposix模块</span></span><br><span class="line">./luarocks install luaposix</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置Lua模块路径，方便找到luaposix</span></span><br><span class="line"><span class="built_in">export</span> LUAROCKS_PREFIX=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/luarocks&quot;</span></span><br><span class="line"><span class="built_in">export</span> LUA_PATH=<span class="string">&quot;<span class="variable">$LUAROCKS_PREFIX</span>/share/lua/5.4/?.lua;<span class="variable">$LUAROCKS_PREFIX</span>/share/lua/5.4/?/init.lua;;&quot;</span></span><br><span class="line"><span class="built_in">export</span> LUA_CPATH=<span class="string">&quot;<span class="variable">$LUAROCKS_PREFIX</span>/lib/lua/5.4/?.so;;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证luaposix安装</span></span><br><span class="line">lua -e <span class="string">&quot;require(&#x27;posix&#x27;); print(&#x27;luaposix installed successfully&#x27;)&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="1-4-安装Lmod"><a href="#1-4-安装Lmod" class="headerlink" title="1.4 安装Lmod"></a>1.4 安装Lmod</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载Lmod（如果网络受限，可以下载到本地后上传）</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/TACC/Lmod.git</span><br><span class="line"><span class="built_in">cd</span> Lmod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置和安装</span></span><br><span class="line">./configure --prefix=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/Lmod&quot;</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置Lmod环境变量</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/Lmod/lmod/lmod/libexec:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"><span class="built_in">export</span> LMOD_CMD=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/Lmod/lmod/lmod/libexec/lmod&quot;</span></span><br><span class="line"><span class="built_in">export</span> MODULEPATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/Lmod/lmod/lmod/modulefiles/Core:<span class="variable">$MODULEPATH</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化Lmod</span></span><br><span class="line"><span class="built_in">source</span> <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/Lmod/lmod/lmod/init/bash&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改bash初始化文件</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;BASH_ENV=<span class="variable">$INSTALL_DIR</span>/Lmod/lmod/lmod/init/bash; export BASH_ENV&quot;</span> &gt;&gt; ~/.bashrc</span><br></pre></td></tr></table></figure>

<h4 id="1-5-验证Lmod和luaposix安装"><a href="#1-5-验证Lmod和luaposix安装" class="headerlink" title="1.5 验证Lmod和luaposix安装"></a>1.5 验证Lmod和luaposix安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重新加载bash配置</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证Lmod安装</span></span><br><span class="line">module --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证luaposix安装</span></span><br><span class="line">lua -e <span class="string">&quot;require(&#x27;posix&#x27;); print(&#x27;luaposix is working correctly&#x27;)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查Lua模块路径</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;LUA_PATH: <span class="variable">$LUA_PATH</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;LUA_CPATH: <span class="variable">$LUA_CPATH</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="1-6-故障排除"><a href="#1-6-故障排除" class="headerlink" title="1.6 故障排除"></a>1.6 故障排除</h4><p><strong>Lmod相关问题：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查Lmod是否正确安装</span></span><br><span class="line">module --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查模块路径</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$MODULEPATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新初始化Lmod</span></span><br><span class="line"><span class="built_in">source</span> <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/Lmod/lmod/lmod/init/bash&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>luaposix相关问题：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查luaposix是否正确安装</span></span><br><span class="line">lua -e <span class="string">&quot;require(&#x27;posix&#x27;); print(&#x27;luaposix found&#x27;)&quot;</span> 2&gt;/dev/null || <span class="built_in">echo</span> <span class="string">&quot;luaposix not found&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查Lua模块路径</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;LUA_PATH: <span class="variable">$LUA_PATH</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;LUA_CPATH: <span class="variable">$LUA_CPATH</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果luaposix找不到，重新安装</span></span><br><span class="line"><span class="built_in">cd</span> <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/luarocks/bin&quot;</span></span><br><span class="line">./luarocks install luaposix</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查LuaRocks安装的模块</span></span><br><span class="line">./luarocks list</span><br></pre></td></tr></table></figure>

<h3 id="第二步：安装HPC-Stack科学软件库"><a href="#第二步：安装HPC-Stack科学软件库" class="headerlink" title="第二步：安装HPC-Stack科学软件库"></a>第二步：安装HPC-Stack科学软件库</h3><p>HPC-Stack包含了科学计算所需的核心库。你可以选择使用HPC-Stack自动安装，或者手动安装各个组件。</p>
<p><strong>重要提示：</strong> 在开始HPC-Stack安装前，请确保已加载Lmod环境，以便后续使用<code>module load</code>命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重新加载bash配置以激活Lmod环境</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证Lmod是否可用</span></span><br><span class="line">module --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果Lmod不可用，手动初始化</span></span><br><span class="line"><span class="built_in">source</span> <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/Lmod/lmod/lmod/init/bash&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加HPC-Stack模块路径（重要！）</span></span><br><span class="line">module use <span class="variable">$INSTALL_DIR</span>/my_modules</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证模块路径是否添加成功</span></span><br><span class="line">module avail</span><br></pre></td></tr></table></figure>

<h4 id="2-1-使用HPC-Stack自动安装（推荐）"><a href="#2-1-使用HPC-Stack自动安装（推荐）" class="headerlink" title="2.1 使用HPC-Stack自动安装（推荐）"></a>2.1 使用HPC-Stack自动安装（推荐）</h4><p><strong>重要提示：</strong> 使用HPC-Stack自动安装需要系统已安装GNU编译器14.0以上版本和CMake 3.30以上版本。如果系统没有这些版本，请先手动安装。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查系统编译器版本</span></span><br><span class="line">gcc --version</span><br><span class="line">g++ --version</span><br><span class="line">gfortran --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查CMake版本</span></span><br><span class="line">cmake --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果版本不满足要求，请先安装所需版本</span></span><br></pre></td></tr></table></figure>

<p><strong>HPC-Stack安装步骤：</strong></p>
<p><strong>重要：</strong> HPC-Stack安装必须按照特定顺序进行，前面的组件安装失败会影响后续组件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载HPC-Stack</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/NOAA-EMC/hpc-stack.git</span><br><span class="line"><span class="built_in">cd</span> hpc-stack</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建模块目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$INSTALL_DIR</span>/my_modules</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建配置文件（根据你的需求修改）</span></span><br><span class="line"><span class="built_in">cat</span> &gt; config/config_metada.sh &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 平台配置</span></span><br><span class="line"><span class="built_in">export</span> MACHINE_ID=linux</span><br><span class="line"><span class="built_in">export</span> COMPILER=gnu</span><br><span class="line"><span class="built_in">export</span> MPICC=mpicc</span><br><span class="line"><span class="built_in">export</span> MPICXX=mpicxx</span><br><span class="line"><span class="built_in">export</span> MPIF90=mpifort</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装路径</span></span><br><span class="line"><span class="built_in">export</span> PREFIX=<span class="variable">$INSTALL_DIR</span>/hpc-stack</span><br><span class="line"><span class="built_in">export</span> MODULEPATH=<span class="variable">$INSTALL_DIR</span>/my_modules</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译器设置</span></span><br><span class="line"><span class="built_in">export</span> CC=gcc</span><br><span class="line"><span class="built_in">export</span> CXX=g++</span><br><span class="line"><span class="built_in">export</span> FC=gfortran</span><br><span class="line"><span class="built_in">export</span> F77=gfortran</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译选项</span></span><br><span class="line"><span class="built_in">export</span> CFLAGS=<span class="string">&quot;-O3 -march=native&quot;</span></span><br><span class="line"><span class="built_in">export</span> CXXFLAGS=<span class="string">&quot;-O3 -march=native&quot;</span></span><br><span class="line"><span class="built_in">export</span> FFLAGS=<span class="string">&quot;-O3 -march=native&quot;</span></span><br><span class="line"><span class="built_in">export</span> FCFLAGS=<span class="string">&quot;-O3 -march=native&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 并行编译</span></span><br><span class="line"><span class="built_in">export</span> MAKE_JOBS=$(<span class="built_in">nproc</span>)</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置模块环境</span></span><br><span class="line">./setup_modules.sh -p <span class="variable">$INSTALL_DIR</span>/my_modules -c config/config_metada.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加模块路径到当前会话</span></span><br><span class="line">module use <span class="variable">$INSTALL_DIR</span>/my_modules</span><br></pre></td></tr></table></figure>

<p><strong>分步安装（推荐）：</strong></p>
<p>由于HPC-Stack安装复杂，建议分步进行，每步验证成功后再进行下一步：</p>
<p><strong>步骤1：安装GNU编译器三件套</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建只包含编译器的yaml文件</span></span><br><span class="line"><span class="built_in">cat</span> &gt; stack/step1_compiler.yaml &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">stack:</span><br><span class="line">  gcc:</span><br><span class="line">    version: 14.2.0</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装编译器</span></span><br><span class="line">./build_stack.sh -p <span class="variable">$INSTALL_DIR</span>/my_modules -c config/config_metada.sh -y stack/step1_compiler.yaml -m</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证编译器安装</span></span><br><span class="line">module load gcc/14.2.0</span><br><span class="line">gcc --version</span><br><span class="line">g++ --version</span><br><span class="line">gfortran --version</span><br></pre></td></tr></table></figure>

<p><strong>步骤2：安装CMake</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建包含CMake的yaml文件</span></span><br><span class="line"><span class="built_in">cat</span> &gt; stack/step2_cmake.yaml &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">stack:</span><br><span class="line">  cmake:</span><br><span class="line">    version: 3.31.1</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装CMake</span></span><br><span class="line">./build_stack.sh -p <span class="variable">$INSTALL_DIR</span>/my_modules -c config/config_metada.sh -y stack/step2_cmake.yaml -m</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证CMake安装</span></span><br><span class="line">module load cmake/3.31.1</span><br><span class="line">cmake --version</span><br></pre></td></tr></table></figure>

<p><strong>步骤3：安装OpenMPI</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建包含OpenMPI的yaml文件</span></span><br><span class="line"><span class="built_in">cat</span> &gt; stack/step3_openmpi.yaml &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">stack:</span><br><span class="line">  openmpi:</span><br><span class="line">    version: 5.0.8</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装OpenMPI</span></span><br><span class="line">./build_stack.sh -p <span class="variable">$INSTALL_DIR</span>/my_modules -c config/config_metada.sh -y stack/step3_openmpi.yaml -m</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证OpenMPI安装</span></span><br><span class="line">module load openmpi/5.0.8</span><br><span class="line">mpicc --version</span><br><span class="line">mpirun --version</span><br></pre></td></tr></table></figure>

<p><strong>步骤4：安装其他科学计算库</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建完整的yaml文件</span></span><br><span class="line"><span class="built_in">cat</span> &gt; stack/step4_libraries.yaml &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">stack:</span><br><span class="line">  <span class="comment"># 基础库</span></span><br><span class="line">  zlib:</span><br><span class="line">    version: 1.2.11</span><br><span class="line">  szip:</span><br><span class="line">    version: 2.1.1</span><br><span class="line">  hdf5:</span><br><span class="line">    version: 1_10_9</span><br><span class="line">    depends: [zlib, szip]</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># NetCDF</span></span><br><span class="line">  netcdf-c:</span><br><span class="line">    version: 4.9.2</span><br><span class="line">    depends: [hdf5, openmpi]</span><br><span class="line">  netcdf-fortran:</span><br><span class="line">    version: 4.5.3</span><br><span class="line">    depends: [netcdf-c]</span><br><span class="line">  netcdf-cxx4:</span><br><span class="line">    version: 4.3.1</span><br><span class="line">    depends: [netcdf-c]</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 可选：并行NetCDF</span></span><br><span class="line">  pnetcdf:</span><br><span class="line">    version: 1.12.1</span><br><span class="line">    depends: [openmpi]</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装其他库</span></span><br><span class="line">./build_stack.sh -p <span class="variable">$INSTALL_DIR</span>/my_modules -c config/config_metada.sh -y stack/step4_libraries.yaml -m</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证安装</span></span><br><span class="line">module avail</span><br><span class="line">module load netcdf</span><br><span class="line">module load hdf5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证模块加载是否成功</span></span><br><span class="line">module list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果看不到HPC-Stack模块，请检查模块路径</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;当前模块路径: <span class="variable">$MODULEPATH</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;HPC-Stack模块目录: <span class="variable">$INSTALL_DIR</span>/my_modules&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 手动添加模块路径（如果需要）</span></span><br><span class="line">module use <span class="variable">$INSTALL_DIR</span>/my_modules</span><br><span class="line">module avail</span><br></pre></td></tr></table></figure>

<p><strong>一键安装（如果系统环境稳定）：</strong></p>
<p>如果前面的分步安装都成功，可以尝试一键安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建完整的stack配置文件</span></span><br><span class="line"><span class="built_in">cat</span> &gt; stack/stack_metada.yaml &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">stack:</span><br><span class="line">  <span class="comment"># 编译器</span></span><br><span class="line">  gcc:</span><br><span class="line">    version: 14.2.0</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 构建工具</span></span><br><span class="line">  cmake:</span><br><span class="line">    version: 3.31.1</span><br><span class="line"></span><br><span class="line">  <span class="comment"># MPI</span></span><br><span class="line">  openmpi:</span><br><span class="line">    version: 5.0.8  </span><br><span class="line"></span><br><span class="line">  <span class="comment"># 基础库</span></span><br><span class="line">  zlib:</span><br><span class="line">    version: 1.2.11</span><br><span class="line">  szip:</span><br><span class="line">    version: 2.1.1</span><br><span class="line">  hdf5:</span><br><span class="line">    version: 1_10_9</span><br><span class="line">    depends: [zlib, szip]</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># NetCDF</span></span><br><span class="line">  netcdf-c:</span><br><span class="line">    version: 4.9.2</span><br><span class="line">    depends: [hdf5, openmpi]</span><br><span class="line">  netcdf-fortran:</span><br><span class="line">    version: 4.5.3</span><br><span class="line">    depends: [netcdf-c]</span><br><span class="line">  netcdf-cxx4:</span><br><span class="line">    version: 4.3.1</span><br><span class="line">    depends: [netcdf-c]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 可选：并行NetCDF</span></span><br><span class="line">  pnetcdf:</span><br><span class="line">    version: 1.12.1</span><br><span class="line">    depends: [openmpi]</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建HPC-Stack</span></span><br><span class="line">./build_stack.sh -p <span class="variable">$INSTALL_DIR</span>/my_modules -c config/config_metada.sh -y stack/stack_metada.yaml -m</span><br></pre></td></tr></table></figure>

<p><strong>使用示例（基于你的配置）：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果你有现成的配置文件，可以直接使用</span></span><br><span class="line">./setup_modules.sh -p /work/home/accewcmji2/my_modules -c /work/home/accewcmji2/down_soft/hpc-stack/config/config_wuzhen.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建stack</span></span><br><span class="line">./build_stack.sh -p /work/home/accewcmji2/my_modules -c /work/home/accewcmji2/down_soft/hpc-stack/config/config_wuzhen.sh -y stack/stack_hafs_build.yaml -m</span><br></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<ul>
<li><code>-p</code>: 指定模块安装路径</li>
<li><code>-c</code>: 指定配置文件路径</li>
<li><code>-y</code>: 指定stack配置文件</li>
<li><code>-m</code>: 启用模块系统</li>
</ul>
<h4 id="2-2-手动安装各个组件"><a href="#2-2-手动安装各个组件" class="headerlink" title="2.2 手动安装各个组件"></a>2.2 手动安装各个组件</h4><p>如果选择手动安装，按以下顺序安装：</p>
<h5 id="2-2-1-安装GCC-14-2-0（如果需要）"><a href="#2-2-1-安装GCC-14-2-0（如果需要）" class="headerlink" title="2.2.1 安装GCC 14.2.0（如果需要）"></a>2.2.1 安装GCC 14.2.0（如果需要）</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line">wget https://ftp.gnu.org/gnu/gcc/gcc-14.2.0/gcc-14.2.0.tar.gz</span><br><span class="line">tar zxf gcc-14.2.0.tar.gz</span><br><span class="line"><span class="built_in">cd</span> gcc-14.2.0</span><br><span class="line">./contrib/download_prerequisites</span><br><span class="line"><span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build</span><br><span class="line">../configure --prefix=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/gcc-14.2.0&quot;</span> --enable-languages=c,c++,fortran --disable-multilib</span><br><span class="line">make -j$(<span class="built_in">nproc</span>) &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<h5 id="2-2-2-安装CMake-3-31-1"><a href="#2-2-2-安装CMake-3-31-1" class="headerlink" title="2.2.2 安装CMake 3.31.1"></a>2.2.2 安装CMake 3.31.1</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line">wget https://github.com/Kitware/CMake/releases/download/v3.31.1/cmake-3.31.1.tar.gz</span><br><span class="line">tar zxf cmake-3.31.1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> cmake-3.31.1</span><br><span class="line">./bootstrap --prefix=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/cmake&quot;</span></span><br><span class="line">make -j$(<span class="built_in">nproc</span>) &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<h5 id="2-2-3-安装OpenMPI"><a href="#2-2-3-安装OpenMPI" class="headerlink" title="2.2.3 安装OpenMPI"></a>2.2.3 安装OpenMPI</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line">wget https://download.open-mpi.org/release/open-mpi/v5.0/openmpi-5.0.8.tar.gz</span><br><span class="line">tar zxf openmpi-5.0.8.tar.gz</span><br><span class="line"><span class="built_in">cd</span> openmpi-5.0.8</span><br><span class="line">./configure --prefix=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/openmpi&quot;</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<h5 id="2-2-4-安装zlib"><a href="#2-2-4-安装zlib" class="headerlink" title="2.2.4 安装zlib"></a>2.2.4 安装zlib</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line">wget https://zlib.net/zlib-1.2.11.tar.gz</span><br><span class="line">tar zxf zlib-1.2.11.tar.gz</span><br><span class="line"><span class="built_in">cd</span> zlib-1.2.11</span><br><span class="line">./configure --prefix=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/zlib&quot;</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<h5 id="2-2-5-安装szip"><a href="#2-2-5-安装szip" class="headerlink" title="2.2.5 安装szip"></a>2.2.5 安装szip</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line">wget https://support.hdfgroup.org/ftp/lib-external/szip/src/szip-2.1.1.tar.gz</span><br><span class="line">tar zxf szip-2.1.1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> szip-2.1.1</span><br><span class="line">./configure --prefix=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/szip&quot;</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<h5 id="2-2-6-安装HDF5"><a href="#2-2-6-安装HDF5" class="headerlink" title="2.2.6 安装HDF5"></a>2.2.6 安装HDF5</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line">wget https://support.hdfgroup.org/ftp/HDF5/releases/hdf5-1.10/hdf5-1.10.9/src/hdf5-1.10.9.tar.gz</span><br><span class="line">tar zxf hdf5-1.10.9.tar.gz</span><br><span class="line"><span class="built_in">cd</span> hdf5-1.10.9</span><br><span class="line"><span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build</span><br><span class="line">cmake .. -DCMAKE_INSTALL_PREFIX=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/hdf5&quot;</span> -DHDF5_ENABLE_PARALLEL=ON</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<h5 id="2-2-7-安装NetCDF-C"><a href="#2-2-7-安装NetCDF-C" class="headerlink" title="2.2.7 安装NetCDF-C"></a>2.2.7 安装NetCDF-C</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line">wget https://github.com/Unidata/netcdf-c/archive/refs/tags/v4.9.2.tar.gz</span><br><span class="line">tar zxf v4.9.2.tar.gz</span><br><span class="line"><span class="built_in">cd</span> netcdf-c-4.9.2</span><br><span class="line"><span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build</span><br><span class="line">cmake .. -DCMAKE_INSTALL_PREFIX=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/netcdf-c&quot;</span> -DENABLE_DAP=OFF -DENABLE_NETCDF_4=ON</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<h5 id="2-2-8-安装NetCDF-Fortran"><a href="#2-2-8-安装NetCDF-Fortran" class="headerlink" title="2.2.8 安装NetCDF-Fortran"></a>2.2.8 安装NetCDF-Fortran</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line">wget https://github.com/Unidata/netcdf-fortran/archive/refs/tags/v4.5.3.tar.gz</span><br><span class="line">tar zxf v4.5.3.tar.gz</span><br><span class="line"><span class="built_in">cd</span> netcdf-fortran-4.5.3</span><br><span class="line"><span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build</span><br><span class="line">cmake .. -DCMAKE_INSTALL_PREFIX=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/netcdf-fortran&quot;</span> -DnetCDF_DIR=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/netcdf-c/lib/cmake/netCDF&quot;</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<h5 id="2-2-9-安装NetCDF-CXX4"><a href="#2-2-9-安装NetCDF-CXX4" class="headerlink" title="2.2.9 安装NetCDF-CXX4"></a>2.2.9 安装NetCDF-CXX4</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line">wget https://github.com/Unidata/netcdf-cxx4/archive/refs/tags/v4.3.1.tar.gz</span><br><span class="line">tar zxf v4.3.1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> netcdf-cxx4-4.3.1</span><br><span class="line"><span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build</span><br><span class="line">cmake .. -DCMAKE_INSTALL_PREFIX=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/netcdf-cxx4&quot;</span> -DnetCDF_DIR=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/netcdf-c/lib/cmake/netCDF&quot;</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<h4 id="2-3-故障排除"><a href="#2-3-故障排除" class="headerlink" title="2.3 故障排除"></a>2.3 故障排除</h4><p><strong>HPC-Stack相关问题：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查HPC-Stack安装状态</span></span><br><span class="line">module avail</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果某个组件安装失败，可以单独重新安装</span></span><br><span class="line"><span class="comment"># 例如重新安装OpenMPI：</span></span><br><span class="line">./build_stack.sh -p <span class="variable">$INSTALL_DIR</span>/my_modules -c config/config_metada.sh -y stack/step3_openmpi.yaml -m</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查模块加载</span></span><br><span class="line">module load gcc/14.2.0</span><br><span class="line">module load cmake/3.31.1</span><br><span class="line">module load openmpi/5.0.8</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理失败的构建</span></span><br><span class="line"><span class="built_in">rm</span> -rf <span class="variable">$INSTALL_DIR</span>/hpc-stack/build/*</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查依赖关系</span></span><br><span class="line">./build_stack.sh -p <span class="variable">$INSTALL_DIR</span>/my_modules -c config/config_metada.sh -y stack/step4_libraries.yaml -m --dry-run</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果编译器安装失败，检查系统要求</span></span><br><span class="line">gcc --version</span><br><span class="line">cmake --version</span><br></pre></td></tr></table></figure>

<p><strong>Lmod环境检查：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查Lmod是否可用</span></span><br><span class="line">module --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查模块路径</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$MODULEPATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果module命令不可用，重新初始化Lmod</span></span><br><span class="line"><span class="built_in">source</span> <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/Lmod/lmod/lmod/init/bash&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查已加载的模块</span></span><br><span class="line">module list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清除所有已加载的模块（如果需要重新开始）</span></span><br><span class="line">module purge</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查HPC-Stack模块是否可用</span></span><br><span class="line">module avail</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果看不到HPC-Stack模块，手动添加模块路径</span></span><br><span class="line">module use <span class="variable">$INSTALL_DIR</span>/my_modules</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证模块路径添加成功</span></span><br><span class="line">module avail | grep -E <span class="string">&quot;(gcc|cmake|openmpi|netcdf)&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>版本要求检查：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查系统编译器版本</span></span><br><span class="line">gcc --version</span><br><span class="line">g++ --version</span><br><span class="line">gfortran --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查CMake版本</span></span><br><span class="line">cmake --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果版本不满足要求，请先安装所需版本</span></span><br></pre></td></tr></table></figure>

<p><strong>网络下载问题：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果无法直接下载，可以手动下载后上传</span></span><br><span class="line"><span class="comment"># 在本地机器上下载所需文件，然后上传到超算平台</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用wget的断点续传功能</span></span><br><span class="line">wget -c https://example.com/file.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者使用curl</span></span><br><span class="line">curl -C - -O https://example.com/file.tar.gz</span><br></pre></td></tr></table></figure>

<h3 id="第三步：安装Python环境"><a href="#第三步：安装Python环境" class="headerlink" title="第三步：安装Python环境"></a>第三步：安装Python环境</h3><p>METADA的某些组件可能需要Python环境支持，建议安装miniconda和必要的Python包。</p>
<h4 id="3-1-安装Miniconda"><a href="#3-1-安装Miniconda" class="headerlink" title="3.1 安装Miniconda"></a>3.1 安装Miniconda</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line">wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh</span><br><span class="line">bash Miniconda3-latest-Linux-x86_64.sh -b -p <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/miniconda3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化conda</span></span><br><span class="line"><span class="built_in">source</span> <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/miniconda3/bin/activate&quot;</span></span><br><span class="line">conda init bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新加载bash配置</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>

<h4 id="3-2-安装必要的Python包"><a href="#3-2-安装必要的Python包" class="headerlink" title="3.2 安装必要的Python包"></a>3.2 安装必要的Python包</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 激活conda环境</span></span><br><span class="line"><span class="built_in">source</span> <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/miniconda3/bin/activate&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装基础科学计算包</span></span><br><span class="line">conda install -y numpy scipy matplotlib pandas</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者使用pip安装（如果conda安装失败）</span></span><br><span class="line">pip install numpy scipy matplotlib pandas</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证安装</span></span><br><span class="line">python -c <span class="string">&quot;import numpy; print(&#x27;NumPy version:&#x27;, numpy.__version__)&quot;</span></span><br><span class="line">python -c <span class="string">&quot;import scipy; print(&#x27;SciPy version:&#x27;, scipy.__version__)&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：</p>
<ul>
<li>如果系统已有Python环境，可以跳过miniconda安装</li>
<li>确保Python版本兼容（建议Python 3.8+）</li>
<li>某些METADA组件可能需要特定的Python包，请根据具体需求安装</li>
</ul>
<h3 id="第四步：安装其他依赖库"><a href="#第四步：安装其他依赖库" class="headerlink" title="第四步：安装其他依赖库"></a>第四步：安装其他依赖库</h3><h4 id="4-1-安装Eigen3"><a href="#4-1-安装Eigen3" class="headerlink" title="4.1 安装Eigen3"></a>4.1 安装Eigen3</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line">wget https://gitlab.com/libeigen/eigen/-/archive/3.4.0/eigen-3.4.0.tar.gz</span><br><span class="line">tar zxf eigen-3.4.0.tar.gz</span><br><span class="line"><span class="built_in">cd</span> eigen-3.4.0</span><br><span class="line"><span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build</span><br><span class="line">cmake .. -DCMAKE_INSTALL_PREFIX=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/eigen3&quot;</span></span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h4 id="4-2-安装glog（可选，如果使用glog日志系统）"><a href="#4-2-安装glog（可选，如果使用glog日志系统）" class="headerlink" title="4.2 安装glog（可选，如果使用glog日志系统）"></a>4.2 安装glog（可选，如果使用glog日志系统）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line">wget https://github.com/google/glog/archive/refs/tags/v0.3.5.tar.gz</span><br><span class="line">tar zxf v0.3.5.tar.gz</span><br><span class="line"><span class="built_in">cd</span> glog-0.3.5</span><br><span class="line"><span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build</span><br><span class="line">cmake .. -DCMAKE_INSTALL_PREFIX=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/glog&quot;</span></span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h4 id="4-3-安装ng-log（推荐，METADA默认日志系统）"><a href="#4-3-安装ng-log（推荐，METADA默认日志系统）" class="headerlink" title="4.3 安装ng-log（推荐，METADA默认日志系统）"></a>4.3 安装ng-log（推荐，METADA默认日志系统）</h4><p><strong>重要提示：</strong> ng-log依赖于gflags，必须先安装gflags（见4.4节）。</p>
<h1 id="可能要增加动态库环境变量"><a href="#可能要增加动态库环境变量" class="headerlink" title="可能要增加动态库环境变量"></a>可能要增加动态库环境变量</h1><h1 id="在LD-LIBRARY-PATH中添加ng-log"><a href="#在LD-LIBRARY-PATH中添加ng-log" class="headerlink" title="在LD_LIBRARY_PATH中添加ng-log"></a>在LD_LIBRARY_PATH中添加ng-log</h1><h1 id="export-LD-LIBRARY-PATH-x3D-”-INSTALL-DIR-x2F-ng-log-x2F-lib-LD-LIBRARY-PATH”"><a href="#export-LD-LIBRARY-PATH-x3D-”-INSTALL-DIR-x2F-ng-log-x2F-lib-LD-LIBRARY-PATH”" class="headerlink" title="export LD_LIBRARY_PATH&#x3D;”$INSTALL_DIR&#x2F;ng-log&#x2F;lib:$LD_LIBRARY_PATH”"></a>export LD_LIBRARY_PATH&#x3D;”$INSTALL_DIR&#x2F;ng-log&#x2F;lib:$LD_LIBRARY_PATH”</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载ng-log</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/ng-log/ng-log.git</span><br><span class="line"><span class="built_in">cd</span> ng-log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建构建目录</span></span><br><span class="line"><span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置CMake，指定gflags路径</span></span><br><span class="line">cmake .. \</span><br><span class="line">  -DCMAKE_INSTALL_PREFIX=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/ng-log&quot;</span> \</span><br><span class="line">  -Dgflags_DIR=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/gflags/lib/cmake/gflags&quot;</span> \</span><br><span class="line">  -DCMAKE_PREFIX_PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/gflags&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译和安装</span></span><br><span class="line">make -j$(<span class="built_in">nproc</span>)</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证安装</span></span><br><span class="line"><span class="built_in">ls</span> -la <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/ng-log/lib/&quot;</span></span><br><span class="line"><span class="built_in">ls</span> -la <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/ng-log/include/&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>Linux编译后的重要配置修改：</strong></p>
<p>在Linux系统上编译ng-log后，需要手动修改CMake配置文件以确保METADA能正确找到ng-log：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑ng-log的CMake配置文件</span></span><br><span class="line">vim <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/ng-log/lib/cmake/ng-log/ng-log-config.cmake&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在文件末尾添加以下行：</span></span><br><span class="line"><span class="comment"># set(ng-log_FOUND TRUE)</span></span><br></pre></td></tr></table></figure>

<p><strong>具体操作步骤：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方法1：使用sed命令自动添加</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;set(ng-log_FOUND TRUE)&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/ng-log/lib/cmake/ng-log/ng-log-config.cmake&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法2：手动编辑文件</span></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/ng-log/lib/cmake/ng-log/ng-log-config.cmake&quot;</span> &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 确保METADA能找到ng-log</span></span><br><span class="line"><span class="built_in">set</span>(ng-log_FOUND TRUE)</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证修改是否成功</span></span><br><span class="line">grep -n <span class="string">&quot;ng-log_FOUND&quot;</span> <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/ng-log/lib/cmake/ng-log/ng-log-config.cmake&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>故障排除：</strong></p>
<p>如果CMake找不到ng-log，请检查：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查ng-log是否正确安装</span></span><br><span class="line"><span class="built_in">ls</span> -la <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/ng-log/lib/cmake/ng-log/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查配置文件是否存在</span></span><br><span class="line"><span class="built_in">cat</span> <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/ng-log/lib/cmake/ng-log/ng-log-config.cmake&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证gflags依赖</span></span><br><span class="line"><span class="built_in">ls</span> -la <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/gflags/lib/cmake/gflags/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果ng-log编译失败，检查gflags是否正确安装</span></span><br><span class="line">pkg-config --exists gflags &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;gflags found&quot;</span> || <span class="built_in">echo</span> <span class="string">&quot;gflags not found&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-4-安装gflags"><a href="#4-4-安装gflags" class="headerlink" title="4.4 安装gflags"></a>4.4 安装gflags</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line">wget https://github.com/gflags/gflags/archive/refs/tags/v2.2.2.tar.gz</span><br><span class="line">tar zxf v2.2.2.tar.gz</span><br><span class="line"><span class="built_in">cd</span> gflags-2.2.2</span><br><span class="line"><span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build</span><br><span class="line">cmake .. -DCMAKE_INSTALL_PREFIX=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/gflags&quot;</span></span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h4 id="4-5-安装yaml-cpp"><a href="#4-5-安装yaml-cpp" class="headerlink" title="4.5 安装yaml-cpp"></a>4.5 安装yaml-cpp</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line">wget https://github.com/jbeder/yaml-cpp/archive/refs/tags/yaml-cpp-0.8.0.tar.gz</span><br><span class="line">tar zxf yaml-cpp-0.8.0.tar.gz</span><br><span class="line"><span class="built_in">cd</span> yaml-cpp-yaml-cpp-0.8.0</span><br><span class="line"><span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build</span><br><span class="line">cmake .. -DCMAKE_INSTALL_PREFIX=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/yaml-cpp&quot;</span> -DYAML_CPP_BUILD_TESTS=OFF</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：在某些Linux系统上，yaml-cpp的CMakeLists.txt可能需要修改。如果编译METADA时遇到<code>yaml-cpp::yaml-cpp</code>相关的错误，可能需要将CMakeLists.txt中的<code>yaml-cpp::yaml-cpp</code>改为<code>yaml::yaml</code>。</p>
<h4 id="4-6-安装nlohmann-json"><a href="#4-6-安装nlohmann-json" class="headerlink" title="4.6 安装nlohmann-json"></a>4.6 安装nlohmann-json</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line">wget https://github.com/nlohmann/json/releases/download/v3.11.3/json.tar.xz</span><br><span class="line">tar xf json.tar.xz</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/nlohmann-json/include&quot;</span></span><br><span class="line"><span class="built_in">cp</span> -r include/nlohmann <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/nlohmann-json/include/&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-7-安装Google-Test"><a href="#4-7-安装Google-Test" class="headerlink" title="4.7 安装Google Test"></a>4.7 安装Google Test</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line">wget https://github.com/google/googletest/archive/refs/tags/v1.14.0.tar.gz</span><br><span class="line">tar zxf v1.14.0.tar.gz</span><br><span class="line"><span class="built_in">cd</span> googletest-1.14.0</span><br><span class="line"><span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build</span><br><span class="line">cmake .. -DCMAKE_INSTALL_PREFIX=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/googletest&quot;</span></span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h4 id="4-8-安装xtensor"><a href="#4-8-安装xtensor" class="headerlink" title="4.8 安装xtensor"></a>4.8 安装xtensor</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line">wget https://github.com/xtensor-stack/xtensor/archive/refs/tags/0.24.6.tar.gz</span><br><span class="line">tar zxf 0.24.6.tar.gz</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/xtensor/include&quot;</span></span><br><span class="line"><span class="built_in">cp</span> -r xtensor-0.24.6/include/xtensor <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/xtensor/include/&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-9-安装xtl"><a href="#4-9-安装xtl" class="headerlink" title="4.9 安装xtl"></a>4.9 安装xtl</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line">wget https://github.com/xtensor-stack/xtl/archive/refs/tags/0.7.6.tar.gz</span><br><span class="line">tar zxf 0.7.6.tar.gz</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/xtl/include&quot;</span></span><br><span class="line"><span class="built_in">cp</span> -r xtl-0.7.6/include/xtl <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/xtl/include/&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-10-安装nanoflann"><a href="#4-10-安装nanoflann" class="headerlink" title="4.10 安装nanoflann"></a>4.10 安装nanoflann</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line">wget https://github.com/jlblancoc/nanoflann/archive/refs/tags/v1.5.3.tar.gz</span><br><span class="line">tar zxf v1.5.3.tar.gz</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/nanoflann/include&quot;</span></span><br><span class="line"><span class="built_in">cp</span> -r nanoflann-1.5.3/include/nanoflann <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/nanoflann/include/&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-11-安装lcov"><a href="#4-11-安装lcov" class="headerlink" title="4.11 安装lcov"></a>4.11 安装lcov</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line">wget https://github.com/linux-test-project/lcov/releases/download/v2.0/lcov-2.0.tar.gz</span><br><span class="line">tar zxf lcov-2.0.tar.gz</span><br><span class="line"><span class="built_in">cd</span> lcov-2.0</span><br><span class="line">make PREFIX=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/lcov&quot;</span> install</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：在无法联网的环境下，lcov可能会有时间不同步的警告，这不会影响编译和功能，可以忽略。</p>
<h4 id="4-12-安装LLVM-x2F-Clang（可选，建议安装）"><a href="#4-12-安装LLVM-x2F-Clang（可选，建议安装）" class="headerlink" title="4.12 安装LLVM&#x2F;Clang（可选，建议安装）"></a>4.12 安装LLVM&#x2F;Clang（可选，建议安装）</h4><p>如果需要使用Clang编译器，可以安装LLVM：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line"><span class="comment"># 下载LLVM预编译包（注意：需要glibc 2.35+）</span></span><br><span class="line">wget https://github.com/llvm/llvm-project/releases/download/llvmorg-20.1.6/LLVM-20.1.6-Linux-ARM64.tar.xz</span><br><span class="line">tar xf LLVM-20.1.6-Linux-ARM64.tar.xz</span><br><span class="line"><span class="built_in">mv</span> LLVM-20.1.6-Linux-ARM64 <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/llvm-20.1.6&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置环境变量</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/llvm-20.1.6/bin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/llvm-20.1.6/lib:<span class="variable">$LD_LIBRARY_PATH</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证安装</span></span><br><span class="line">clang --version</span><br><span class="line">clang++ --version</span><br></pre></td></tr></table></figure>

<p><strong>重要提示</strong>：</p>
<ul>
<li>LLVM 20.1.6需要系统glibc版本至少为2.35</li>
<li>可以通过<code>ldd --version</code>检查当前glibc版本</li>
<li>如果glibc版本过低，建议使用较低版本的LLVM或联系系统管理员升级</li>
</ul>
<p><strong>非管理员用户的glibc解决方案</strong>：</p>
<p>如果系统glibc版本低于2.35且没有管理员权限，可以创建包装脚本来使用更高版本的glibc：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建clang-format包装脚本</span></span><br><span class="line"><span class="built_in">cat</span> &gt; <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/clang-format-wrapper.sh&quot;</span> &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动用 glibc-2.35 启动 clang-format</span></span><br><span class="line"><span class="variable">$HOME</span>/install_soft/glibc-2.35/lib/ld-linux-aarch64.so.1 \</span><br><span class="line">  --library-path <span class="variable">$HOME</span>/install_soft/glibc-2.35/lib:<span class="variable">$HOME</span>/my_modules/gnu-14.2.0/zlib/1.2.11/lib \</span><br><span class="line">  <span class="variable">$HOME</span>/install_soft/LLVM-20.1.6-Linux-ARM64/bin/clang-format <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置执行权限</span></span><br><span class="line"><span class="built_in">chmod</span> +x <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/clang-format-wrapper.sh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建符号链接或别名</span></span><br><span class="line"><span class="built_in">ln</span> -sf <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/clang-format-wrapper.sh&quot;</span> <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/bin/clang-format&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：需要根据你的实际安装路径调整上述脚本中的路径。</p>
<h4 id="4-13-安装Ninja（可选，推荐安装）"><a href="#4-13-安装Ninja（可选，推荐安装）" class="headerlink" title="4.13 安装Ninja（可选，推荐安装）"></a>4.13 安装Ninja（可选，推荐安装）</h4><p>如果后续编译METADA时使用Ninja构建系统，需要安装Ninja：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span></span><br><span class="line">wget https://github.com/ninja-build/ninja/releases/download/v1.11.1/ninja-linux.zip</span><br><span class="line">unzip ninja-linux.zip</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/ninja/bin&quot;</span></span><br><span class="line"><span class="built_in">mv</span> ninja <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/ninja/bin/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置环境变量</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/ninja/bin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证安装</span></span><br><span class="line">ninja --version</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：Ninja可以显著提高编译速度，特别是在大型项目中。如果系统已有Ninja或不需要，可以跳过此步骤。</p>
<h4 id="4-14-故障排除"><a href="#4-14-故障排除" class="headerlink" title="4.14 故障排除"></a>4.14 故障排除</h4><p><strong>依赖库安装问题：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查依赖库是否正确安装</span></span><br><span class="line"><span class="built_in">ls</span> -la <span class="variable">$INSTALL_DIR</span>/*/lib/</span><br><span class="line"><span class="built_in">ls</span> -la <span class="variable">$INSTALL_DIR</span>/*/include/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查CMake是否能找到库</span></span><br><span class="line">cmake --find-package -DNAME=Eigen3 -DCOMPILER_ID=GNU -DLANGUAGE=CXX -DMODE=EXIST</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果某个库安装失败，可以单独重新安装</span></span><br><span class="line"><span class="comment"># 例如重新安装Eigen3：</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$DOWNLOAD_DIR</span>/eigen-3.4.0</span><br><span class="line"><span class="built_in">rm</span> -rf build</span><br><span class="line"><span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build</span><br><span class="line">cmake .. -DCMAKE_INSTALL_PREFIX=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/eigen3&quot;</span></span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p><strong>权限问题：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查目录权限</span></span><br><span class="line"><span class="built_in">ls</span> -la <span class="variable">$INSTALL_DIR</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 确保有写入权限</span></span><br><span class="line"><span class="built_in">chmod</span> -R u+w <span class="variable">$INSTALL_DIR</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果空间不足，检查磁盘使用情况</span></span><br><span class="line"><span class="built_in">df</span> -h <span class="variable">$INSTALL_DIR</span></span><br></pre></td></tr></table></figure>

<p><strong>内存不足：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 减少并行编译任务数</span></span><br><span class="line">make -j2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查可用内存</span></span><br><span class="line">free -h</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在超算平台上，可以申请更多资源</span></span><br><span class="line"><span class="comment"># srun --mem=8G --cpus-per-task=4 make -j4</span></span><br></pre></td></tr></table></figure>

<h3 id="第五步：配置环境变量"><a href="#第五步：配置环境变量" class="headerlink" title="第五步：配置环境变量"></a>第五步：配置环境变量</h3><p>安装完所有依赖后，需要设置环境变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置CMAKE_PREFIX_PATH</span></span><br><span class="line"><span class="built_in">export</span> CMAKE_PREFIX_PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/eigen3:<span class="variable">$INSTALL_DIR</span>/glog:<span class="variable">$INSTALL_DIR</span>/gflags:<span class="variable">$INSTALL_DIR</span>/yaml-cpp:<span class="variable">$INSTALL_DIR</span>/nlohmann-json:<span class="variable">$INSTALL_DIR</span>/googletest:<span class="variable">$INSTALL_DIR</span>/xtensor:<span class="variable">$INSTALL_DIR</span>/xtl:<span class="variable">$INSTALL_DIR</span>/nanoflann:<span class="variable">$INSTALL_DIR</span>/hdf5:<span class="variable">$INSTALL_DIR</span>/netcdf-c:<span class="variable">$INSTALL_DIR</span>/netcdf-fortran:<span class="variable">$INSTALL_DIR</span>/openmpi:<span class="variable">$CMAKE_PREFIX_PATH</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置库路径</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/eigen3/lib:<span class="variable">$INSTALL_DIR</span>/glog/lib:<span class="variable">$INSTALL_DIR</span>/gflags/lib:<span class="variable">$INSTALL_DIR</span>/yaml-cpp/lib:<span class="variable">$INSTALL_DIR</span>/hdf5/lib:<span class="variable">$INSTALL_DIR</span>/netcdf-c/lib:<span class="variable">$INSTALL_DIR</span>/netcdf-fortran/lib:<span class="variable">$INSTALL_DIR</span>/openmpi/lib:<span class="variable">$LD_LIBRARY_PATH</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置头文件路径</span></span><br><span class="line"><span class="built_in">export</span> CPATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/eigen3/include:<span class="variable">$INSTALL_DIR</span>/glog/include:<span class="variable">$INSTALL_DIR</span>/gflags/include:<span class="variable">$INSTALL_DIR</span>/yaml-cpp/include:<span class="variable">$INSTALL_DIR</span>/nlohmann-json/include:<span class="variable">$INSTALL_DIR</span>/xtensor/include:<span class="variable">$INSTALL_DIR</span>/xtl/include:<span class="variable">$INSTALL_DIR</span>/nanoflann/include:<span class="variable">$INSTALL_DIR</span>/hdf5/include:<span class="variable">$INSTALL_DIR</span>/netcdf-c/include:<span class="variable">$INSTALL_DIR</span>/netcdf-fortran/include:<span class="variable">$INSTALL_DIR</span>/openmpi/include:<span class="variable">$CPATH</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置PATH</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/cmake/bin:<span class="variable">$INSTALL_DIR</span>/openmpi/bin:<span class="variable">$INSTALL_DIR</span>/lcov/bin:<span class="variable">$INSTALL_DIR</span>/llvm-20.1.6/bin:<span class="variable">$INSTALL_DIR</span>/ninja/bin:<span class="variable">$INSTALL_DIR</span>/miniconda3/bin:<span class="variable">$PATH</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="5-2-故障排除"><a href="#5-2-故障排除" class="headerlink" title="5.2 故障排除"></a>5.2 故障排除</h4><p><strong>环境变量问题：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查环境变量设置</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$CMAKE_PREFIX_PATH</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$LD_LIBRARY_PATH</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$CPATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证库是否能被找到</span></span><br><span class="line">pkg-config --exists yaml-cpp &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;yaml-cpp found&quot;</span> || <span class="built_in">echo</span> <span class="string">&quot;yaml-cpp not found&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 手动检查库文件</span></span><br><span class="line"><span class="built_in">ls</span> -la <span class="variable">$INSTALL_DIR</span>/*/lib/</span><br></pre></td></tr></table></figure>

<p><strong>路径问题：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查所有路径是否存在</span></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">dir</span> <span class="keyword">in</span> <span class="variable">$INSTALL_DIR</span>/*; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$dir</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Checking <span class="variable">$dir</span>:&quot;</span></span><br><span class="line">        <span class="built_in">ls</span> -la <span class="string">&quot;<span class="variable">$dir</span>&quot;</span>/lib/ 2&gt;/dev/null || <span class="built_in">echo</span> <span class="string">&quot;  No lib directory&quot;</span></span><br><span class="line">        <span class="built_in">ls</span> -la <span class="string">&quot;<span class="variable">$dir</span>&quot;</span>/include/ 2&gt;/dev/null || <span class="built_in">echo</span> <span class="string">&quot;  No include directory&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="第六步：编译METADA"><a href="#第六步：编译METADA" class="headerlink" title="第六步：编译METADA"></a>第六步：编译METADA</h3><h4 id="6-1-克隆METADA项目"><a href="#6-1-克隆METADA项目" class="headerlink" title="6.1 克隆METADA项目"></a>6.1 克隆METADA项目</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/open-x-da/metada.git</span><br><span class="line"><span class="built_in">cd</span> metada</span><br></pre></td></tr></table></figure>

<p><strong>重要提醒：对于具体模型的后端配置</strong></p>
<p>如果使用特定的模型后端（如MACOM、WRF等），可能需要手动修改相应的CMakeLists.txt文件：</p>
<ol>
<li><p><strong>库路径调整</strong>：</p>
<ul>
<li>某些库（如netcdf）可能加载不顺利</li>
<li>需要手动修改<code>link_directories()</code>和<code>target_link_libraries()</code></li>
<li>确保库路径指向正确的安装位置</li>
</ul>
</li>
<li><p><strong>模型源码位置</strong>：</p>
<ul>
<li>某些模型需要定义源码的具体位置</li>
<li>检查模型后端的CMakeLists.txt中的路径设置</li>
</ul>
</li>
<li><p><strong>常见需要修改的文件</strong>：</p>
<ul>
<li><code>src/backends/macom/CMakeLists.txt</code></li>
<li><code>src/backends/wrf/CMakeLists.txt</code></li>
<li>其他具体模型后端的CMakeLists.txt</li>
</ul>
</li>
</ol>
<p><strong>建议</strong>：在开始编译前，先检查你要使用的模型后端的CMakeLists.txt文件，确保所有路径都正确配置。</p>
<p><strong>glibc版本兼容性检查</strong>：</p>
<p>如果使用LLVM&#x2F;Clang编译，请确保glibc版本兼容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查当前glibc版本</span></span><br><span class="line">ldd --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果版本低于2.35，可能需要使用包装脚本</span></span><br><span class="line"><span class="comment"># 参考LLVM安装部分的glibc解决方案</span></span><br></pre></td></tr></table></figure>

<h4 id="6-2-创建构建脚本"><a href="#6-2-创建构建脚本" class="headerlink" title="6.2 创建构建脚本"></a>6.2 创建构建脚本</h4><p>创建一个构建脚本 <code>build_metada.sh</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置环境变量</span></span><br><span class="line"><span class="built_in">export</span> INSTALL_DIR=<span class="string">&quot;<span class="variable">$HOME</span>/install_soft&quot;</span></span><br><span class="line"><span class="built_in">export</span> CMAKE_PREFIX_PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/eigen3:<span class="variable">$INSTALL_DIR</span>/glog:<span class="variable">$INSTALL_DIR</span>/gflags:<span class="variable">$INSTALL_DIR</span>/yaml-cpp:<span class="variable">$INSTALL_DIR</span>/nlohmann-json:<span class="variable">$INSTALL_DIR</span>/googletest:<span class="variable">$INSTALL_DIR</span>/xtensor:<span class="variable">$INSTALL_DIR</span>/xtl:<span class="variable">$INSTALL_DIR</span>/nanoflann:<span class="variable">$INSTALL_DIR</span>/hdf5:<span class="variable">$INSTALL_DIR</span>/netcdf-c:<span class="variable">$INSTALL_DIR</span>/netcdf-fortran:<span class="variable">$INSTALL_DIR</span>/openmpi:<span class="variable">$CMAKE_PREFIX_PATH</span>&quot;</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/eigen3/lib:<span class="variable">$INSTALL_DIR</span>/glog/lib:<span class="variable">$INSTALL_DIR</span>/gflags/lib:<span class="variable">$INSTALL_DIR</span>/yaml-cpp/lib:<span class="variable">$INSTALL_DIR</span>/hdf5/lib:<span class="variable">$INSTALL_DIR</span>/netcdf-c/lib:<span class="variable">$INSTALL_DIR</span>/netcdf-fortran/lib:<span class="variable">$INSTALL_DIR</span>/openmpi/lib:<span class="variable">$LD_LIBRARY_PATH</span>&quot;</span></span><br><span class="line"><span class="built_in">export</span> CPATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/eigen3/include:<span class="variable">$INSTALL_DIR</span>/glog/include:<span class="variable">$INSTALL_DIR</span>/gflags/include:<span class="variable">$INSTALL_DIR</span>/yaml-cpp/include:<span class="variable">$INSTALL_DIR</span>/nlohmann-json/include:<span class="variable">$INSTALL_DIR</span>/xtensor/include:<span class="variable">$INSTALL_DIR</span>/xtl/include:<span class="variable">$INSTALL_DIR</span>/nanoflann/include:<span class="variable">$INSTALL_DIR</span>/hdf5/include:<span class="variable">$INSTALL_DIR</span>/netcdf-c/include:<span class="variable">$INSTALL_DIR</span>/netcdf-fortran/include:<span class="variable">$INSTALL_DIR</span>/openmpi/include:<span class="variable">$CPATH</span>&quot;</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/cmake/bin:<span class="variable">$INSTALL_DIR</span>/openmpi/bin:<span class="variable">$INSTALL_DIR</span>/lcov/bin:<span class="variable">$INSTALL_DIR</span>/llvm-20.1.6/bin:<span class="variable">$INSTALL_DIR</span>/ninja/bin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查是否使用Ninja</span></span><br><span class="line">USE_NINJA=<span class="variable">$&#123;1:-&quot;yes&quot;&#125;</span>  <span class="comment"># 默认使用Ninja</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建构建目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$USE_NINJA</span>&quot;</span> = <span class="string">&quot;yes&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;使用Ninja构建系统...&quot;</span></span><br><span class="line">    <span class="comment"># 配置CMake（使用Ninja）</span></span><br><span class="line">    cmake -G Ninja \</span><br><span class="line">      -DCMAKE_BUILD_TYPE=Release \</span><br><span class="line">      -DUSE_MPI=ON \</span><br><span class="line">      -DCMAKE_Fortran_COMPILER=mpifort \</span><br><span class="line">      -DCMAKE_Fortran_FLAGS=<span class="string">&quot;-O3 -cpp -fno-tree-vectorize -fallow-argument-mismatch -Wno-missing-include-dirs -Wno-unused-variable -Wno-conversion&quot;</span> \</span><br><span class="line">      -DCMAKE_CXX_FLAGS=<span class="string">&quot;-Wno-unused-variable -Wno-unused-function -Wno-unused-but-set-variable -Wno-sign-compare -Wno-uninitialized&quot;</span> \</span><br><span class="line">      -DLOGGER_BACKEND=GLOG \</span><br><span class="line">      -DCONFIG_BACKEND=YAML \</span><br><span class="line">      ..</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 编译（使用Ninja）</span></span><br><span class="line">    ninja -j$(<span class="built_in">nproc</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;使用Make构建系统...&quot;</span></span><br><span class="line">    <span class="comment"># 配置CMake（使用Make）</span></span><br><span class="line">    cmake -G <span class="string">&quot;Unix Makefiles&quot;</span> \</span><br><span class="line">      -DCMAKE_BUILD_TYPE=Release \</span><br><span class="line">      -DUSE_MPI=ON \</span><br><span class="line">      -DCMAKE_Fortran_COMPILER=mpifort \</span><br><span class="line">      -DCMAKE_Fortran_FLAGS=<span class="string">&quot;-O3 -cpp -fno-tree-vectorize -fallow-argument-mismatch -Wno-missing-include-dirs -Wno-unused-variable -Wno-conversion&quot;</span> \</span><br><span class="line">      -DCMAKE_CXX_FLAGS=<span class="string">&quot;-Wno-unused-variable -Wno-unused-function -Wno-unused-but-set-variable -Wno-sign-compare -Wno-uninitialized&quot;</span> \</span><br><span class="line">      -DLOGGER_BACKEND=GLOG \</span><br><span class="line">      -DCONFIG_BACKEND=YAML \</span><br><span class="line">      ..</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 编译（使用Make）</span></span><br><span class="line">    make -j$(<span class="built_in">nproc</span>)</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h4 id="6-3-运行构建脚本"><a href="#6-3-运行构建脚本" class="headerlink" title="6.3 运行构建脚本"></a>6.3 运行构建脚本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x build_metada.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用Ninja构建（推荐，速度更快）</span></span><br><span class="line">./build_metada.sh <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者使用Make构建（如果系统没有Ninja或遇到问题）</span></span><br><span class="line">./build_metada.sh no</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认使用Ninja</span></span><br><span class="line">./build_metada.sh</span><br></pre></td></tr></table></figure>

<h4 id="6-4-运行测试"><a href="#6-4-运行测试" class="headerlink" title="6.4 运行测试"></a>6.4 运行测试</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">ctest --output-on-failure</span><br></pre></td></tr></table></figure>

<h4 id="6-5-故障排除"><a href="#6-5-故障排除" class="headerlink" title="6.5 故障排除"></a>6.5 故障排除</h4><p><strong>CMake配置失败：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清理构建目录重新开始</span></span><br><span class="line"><span class="built_in">rm</span> -rf build</span><br><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新配置，添加详细输出</span></span><br><span class="line">cmake -G Ninja \</span><br><span class="line">    -DCMAKE_BUILD_TYPE=Release \</span><br><span class="line">    -DUSE_MPI=ON \</span><br><span class="line">    -DCMAKE_Fortran_COMPILER=mpifort \</span><br><span class="line">    -DCMAKE_Fortran_FLAGS=<span class="string">&quot;-O3 -cpp -fno-tree-vectorize -fallow-argument-mismatch -Wno-missing-include-dirs -Wno-unused-variable -Wno-conversion&quot;</span> \</span><br><span class="line">    -DCMAKE_CXX_FLAGS=<span class="string">&quot;-Wno-unused-variable -Wno-unused-function -Wno-unused-but-set-variable -Wno-sign-compare -Wno-uninitialized&quot;</span> \</span><br><span class="line">    -DLOGGER_BACKEND=GLOG \</span><br><span class="line">    -DCONFIG_BACKEND=YAML \</span><br><span class="line">    -DCMAKE_PREFIX_PATH=<span class="string">&quot;<span class="variable">$CMAKE_PREFIX_PATH</span>&quot;</span> \</span><br><span class="line">    -DCMAKE_VERBOSE_MAKEFILE=ON \</span><br><span class="line">    ..</span><br></pre></td></tr></table></figure>

<p><strong>编译失败：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 减少并行编译任务数</span></span><br><span class="line">ninja -j4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查可用内存</span></span><br><span class="line">free -h</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在超算平台上，可以申请更多资源</span></span><br><span class="line"><span class="comment"># srun --mem=8G --cpus-per-task=4 ninja -j4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果Ninja有问题，尝试使用Make</span></span><br><span class="line">./build_metada.sh no</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者手动使用Make</span></span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">make -j4</span><br></pre></td></tr></table></figure>

<p><strong>MPI相关问题：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查MPI安装</span></span><br><span class="line"><span class="built_in">which</span> mpicc</span><br><span class="line"><span class="built_in">which</span> mpirun</span><br><span class="line">mpicc --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试MPI</span></span><br><span class="line">mpirun -np 2 hostname</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果MPI不可用，检查环境变量</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span> | grep openmpi</span><br></pre></td></tr></table></figure>

<p><strong>glibc版本问题：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查glibc版本</span></span><br><span class="line">ldd --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果LLVM/Clang因glibc版本过低无法运行</span></span><br><span class="line"><span class="comment"># 使用包装脚本（参考LLVM安装部分）</span></span><br><span class="line"><span class="variable">$INSTALL_DIR</span>/clang-format-wrapper.sh --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者设置LD_LIBRARY_PATH</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/glibc-2.35/lib:<span class="variable">$LD_LIBRARY_PATH</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>测试失败：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 运行特定测试</span></span><br><span class="line">ctest -R <span class="string">&quot;test_name&quot;</span> --output-on-failure</span><br><span class="line"></span><br><span class="line"><span class="comment"># 详细输出</span></span><br><span class="line">ctest --output-on-failure --verbose</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查测试日志</span></span><br><span class="line"><span class="built_in">cat</span> Testing/Temporary/LastTest.<span class="built_in">log</span></span><br></pre></td></tr></table></figure>

<h2 id="环境变量持久化"><a href="#环境变量持久化" class="headerlink" title="环境变量持久化"></a>环境变量持久化</h2><p>为了避免每次登录都需要重新设置环境变量，建议将环境变量添加到shell配置文件中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加到 ~/.bashrc 文件</span></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; ~/.bashrc &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># METADA 环境变量设置</span></span><br><span class="line"><span class="built_in">export</span> INSTALL_DIR=<span class="string">&quot;<span class="variable">$HOME</span>/install_soft&quot;</span></span><br><span class="line"><span class="built_in">export</span> DOWNLOAD_DIR=<span class="string">&quot;<span class="variable">$HOME</span>/down_soft&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 基础路径</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/cmake/bin:<span class="variable">$INSTALL_DIR</span>/openmpi/bin:<span class="variable">$INSTALL_DIR</span>/lcov/bin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 库路径</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/eigen3/lib:<span class="variable">$INSTALL_DIR</span>/glog/lib:<span class="variable">$INSTALL_DIR</span>/gflags/lib:<span class="variable">$INSTALL_DIR</span>/yaml-cpp/lib:<span class="variable">$INSTALL_DIR</span>/hdf5/lib:<span class="variable">$INSTALL_DIR</span>/netcdf-c/lib:<span class="variable">$INSTALL_DIR</span>/netcdf-fortran/lib:<span class="variable">$INSTALL_DIR</span>/openmpi/lib:<span class="variable">$LD_LIBRARY_PATH</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 头文件路径</span></span><br><span class="line"><span class="built_in">export</span> CPATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/eigen3/include:<span class="variable">$INSTALL_DIR</span>/glog/include:<span class="variable">$INSTALL_DIR</span>/gflags/include:<span class="variable">$INSTALL_DIR</span>/yaml-cpp/include:<span class="variable">$INSTALL_DIR</span>/nlohmann-json/include:<span class="variable">$INSTALL_DIR</span>/xtensor/include:<span class="variable">$INSTALL_DIR</span>/xtl/include:<span class="variable">$INSTALL_DIR</span>/nanoflann/include:<span class="variable">$INSTALL_DIR</span>/hdf5/include:<span class="variable">$INSTALL_DIR</span>/netcdf-c/include:<span class="variable">$INSTALL_DIR</span>/netcdf-fortran/include:<span class="variable">$INSTALL_DIR</span>/openmpi/include:<span class="variable">$CPATH</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CMake前缀路径</span></span><br><span class="line"><span class="built_in">export</span> CMAKE_PREFIX_PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/eigen3:<span class="variable">$INSTALL_DIR</span>/glog:<span class="variable">$INSTALL_DIR</span>/gflags:<span class="variable">$INSTALL_DIR</span>/yaml-cpp:<span class="variable">$INSTALL_DIR</span>/nlohmann-json:<span class="variable">$INSTALL_DIR</span>/googletest:<span class="variable">$INSTALL_DIR</span>/xtensor:<span class="variable">$INSTALL_DIR</span>/xtl:<span class="variable">$INSTALL_DIR</span>/nanoflann:<span class="variable">$INSTALL_DIR</span>/hdf5:<span class="variable">$INSTALL_DIR</span>/netcdf-c:<span class="variable">$INSTALL_DIR</span>/netcdf-fortran:<span class="variable">$INSTALL_DIR</span>/openmpi:<span class="variable">$CMAKE_PREFIX_PATH</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Lmod设置</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/Lmod/lmod/lmod/libexec:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"><span class="built_in">export</span> LMOD_CMD=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/Lmod/lmod/lmod/libexec/lmod&quot;</span></span><br><span class="line"><span class="built_in">export</span> MODULEPATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/Lmod/lmod/lmod/modulefiles/Core:<span class="variable">$INSTALL_DIR</span>/my_modules:<span class="variable">$MODULEPATH</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化Lmod环境</span></span><br><span class="line"><span class="built_in">source</span> <span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/Lmod/lmod/lmod/init/bash&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加HPC-Stack模块路径</span></span><br><span class="line">module use <span class="variable">$INSTALL_DIR</span>/my_modules</span><br><span class="line"></span><br><span class="line"><span class="comment"># Lua和LuaRocks设置</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/lua/bin:<span class="variable">$INSTALL_DIR</span>/luarocks/bin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/lua/lib:<span class="variable">$LD_LIBRARY_PATH</span>&quot;</span></span><br><span class="line"><span class="built_in">export</span> LUAROCKS_PREFIX=<span class="string">&quot;<span class="variable">$INSTALL_DIR</span>/luarocks&quot;</span></span><br><span class="line"><span class="built_in">export</span> LUA_PATH=<span class="string">&quot;<span class="variable">$LUAROCKS_PREFIX</span>/share/lua/5.4/?.lua;<span class="variable">$LUAROCKS_PREFIX</span>/share/lua/5.4/?/init.lua;;&quot;</span></span><br><span class="line"><span class="built_in">export</span> LUA_CPATH=<span class="string">&quot;<span class="variable">$LUAROCKS_PREFIX</span>/lib/lua/5.4/?.so;;&quot;</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新加载配置</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>

<h3 id="获取帮助"><a href="#获取帮助" class="headerlink" title="获取帮助"></a>获取帮助</h3><p>如果遇到其他问题：</p>
<ol>
<li>查看项目文档：<a target="_blank" rel="noopener" href="https://modern-data-assimilation-system-for-earth-sciences.readthedocs.io/">https://modern-data-assimilation-system-for-earth-sciences.readthedocs.io/</a></li>
<li>检查GitHub Issues：<a target="_blank" rel="noopener" href="https://github.com/open-x-da/metada/issues">https://github.com/open-x-da/metada/issues</a></li>
<li>查看CI配置：<code>.github/workflows/linux.yaml</code></li>
</ol>
<h2 id="验证安装"><a href="#验证安装" class="headerlink" title="验证安装"></a>验证安装</h2><p>安装完成后，运行以下命令验证：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查可执行文件</span></span><br><span class="line"><span class="built_in">ls</span> -la build/applications/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行示例程序（如果有）</span></span><br><span class="line"><span class="comment"># ./build/applications/your_app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查库文件</span></span><br><span class="line"><span class="built_in">ls</span> -la build/src/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行测试套件</span></span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">ctest --output-on-failure</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查MPI功能</span></span><br><span class="line">mpirun -np 2 ./build/applications/your_mpi_app</span><br></pre></td></tr></table></figure>

<h2 id="下一步"><a href="#下一步" class="headerlink" title="下一步"></a>下一步</h2><p>安装成功后，你可以：</p>
<ol>
<li>查看教程和示例：<code>tutorial/</code> 目录</li>
<li>阅读API文档：<code>docs/</code> 目录</li>
<li>运行基准测试</li>
<li>开始开发你的数据同化应用</li>
</ol>
<p>祝你使用愉快！</p>
<h2 id="运行MACOM模式"><a href="#运行MACOM模式" class="headerlink" title="运行MACOM模式"></a>运行MACOM模式</h2><p>编译完成后，你可以运行MACOM模式进行数值天气预报。以下是详细的使用说明：</p>
<h3 id="7-1-准备执行文件"><a href="#7-1-准备执行文件" class="headerlink" title="7.1 准备执行文件"></a>7.1 准备执行文件</h3><p>编译成功后，在<code>build/bin/</code>目录下会生成可执行文件，如<code>forecast</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查生成的可执行文件</span></span><br><span class="line"><span class="built_in">ls</span> -la build/bin/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制到工作目录</span></span><br><span class="line"><span class="built_in">cp</span> build/bin/forecast ./forecast</span><br><span class="line"><span class="built_in">chmod</span> +x ./forecast</span><br></pre></td></tr></table></figure>

<h3 id="7-2-准备配置文件"><a href="#7-2-准备配置文件" class="headerlink" title="7.2 准备配置文件"></a>7.2 准备配置文件</h3><p>METADA需要配置文件来指定运行参数。创建<code>macom_config.yaml</code>：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MACOM模式配置文件示例</span></span><br><span class="line"><span class="attr">model:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">&quot;MACOM&quot;</span></span><br><span class="line">  <span class="attr">backend:</span> <span class="string">&quot;macom&quot;</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">logger:</span></span><br><span class="line">  <span class="attr">app_name:</span> <span class="string">&quot;forecast&quot;</span></span><br><span class="line">  <span class="attr">level:</span> <span class="string">&quot;debug&quot;</span></span><br><span class="line">  <span class="attr">color:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">console:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Geometry for the forecast</span></span><br><span class="line"><span class="attr">geometry:</span></span><br><span class="line">  <span class="attr">file:</span> <span class="string">&quot;D:/macom/glo_1_6/exp/nmefc_macom_csp_grid_d01.nc&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Initial state</span></span><br><span class="line"><span class="attr">state:</span></span><br><span class="line">  <span class="attr">file:</span> <span class="string">&quot;D:/macom/glo_1_6/exp/nmefc_macom_csp_initinal_d01.nc&quot;</span></span><br><span class="line">  <span class="attr">timestamp:</span> <span class="string">&quot;2000-01-24T12:00:00Z&quot;</span></span><br><span class="line">  <span class="attr">variables:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;u&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;v&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;w&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;t&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;s&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Model configuration</span></span><br><span class="line"><span class="attr">model:</span></span><br><span class="line">  <span class="attr">time_control:</span></span><br><span class="line">    <span class="attr">start_datetime:</span> <span class="string">&quot;2000-01-24T12:00:00Z&quot;</span></span><br><span class="line">    <span class="attr">forecast_length:</span> <span class="string">&quot;24h&quot;</span></span><br><span class="line">    <span class="attr">end_datetime:</span> <span class="string">&quot;2000-01-25T12:00:00Z&quot;</span></span><br><span class="line">    <span class="attr">time_step:</span> <span class="string">&quot;360s&quot;</span></span><br><span class="line">    <span class="attr">output_history:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">history_file:</span> <span class="string">&quot;./forecast.nc&quot;</span></span><br><span class="line">    <span class="attr">history_frequency:</span> <span class="string">&quot;3600s&quot;</span></span><br><span class="line">  <span class="attr">dynamics:</span></span><br><span class="line">    <span class="attr">advection_scheme:</span> <span class="string">&quot;WENO&quot;</span></span><br><span class="line">    <span class="attr">diffusion:</span> <span class="number">0.0</span></span><br><span class="line">  <span class="attr">physics:</span></span><br><span class="line">    <span class="attr">microphysics:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">radiation:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">pbl:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">lsm:</span> <span class="literal">true</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="7-3-运行MACOM模式"><a href="#7-3-运行MACOM模式" class="headerlink" title="7.3 运行MACOM模式"></a>7.3 运行MACOM模式</h3><p>使用SLURM作业调度系统运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建作业脚本 submit_job.sh</span></span><br><span class="line"><span class="built_in">cat</span> &gt; submit_job.sh &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#SBATCH --job-name=macom_forecast</span></span><br><span class="line"><span class="comment">#SBATCH --nodes=1</span></span><br><span class="line"><span class="comment">#SBATCH --ntasks=6</span></span><br><span class="line"><span class="comment">#SBATCH --time=02:00:00</span></span><br><span class="line"><span class="comment">#SBATCH --output=forecast_%j.out</span></span><br><span class="line"><span class="comment">#SBATCH --error=forecast_%j.err</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载环境 需要根据具体情况调整</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line">module load openmpi/5.0.8</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行MACOM模式</span></span><br><span class="line">yhrun -n 6 ./forecast macom_config.yaml 2&gt;&amp;1 | <span class="built_in">tee</span> forecast.log</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交作业</span></span><br><span class="line">sbatch submit_job.sh</span><br></pre></td></tr></table></figure>

<h3 id="7-4-参考示例"><a href="#7-4-参考示例" class="headerlink" title="7.4 参考示例"></a>7.4 参考示例</h3><p>可以参考现有的MACOM测试配置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看参考配置</span></span><br><span class="line"><span class="built_in">ls</span> -la /thfs1/home/zj119/liq/test_macom/glo_1_6/exp/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看作业脚本示例</span></span><br><span class="line"><span class="built_in">cat</span> /thfs1/home/zj119/liq/test_macom/glo_1_6/exp/submit_job.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 该目录包含完整的初始数据配置</span></span><br></pre></td></tr></table></figure>

<h3 id="7-5-故障排除"><a href="#7-5-故障排除" class="headerlink" title="7.5 故障排除"></a>7.5 故障排除</h3><p><strong>常见问题：</strong></p>
<ol>
<li><p><strong>配置文件路径错误</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查配置文件是否存在</span></span><br><span class="line"><span class="built_in">ls</span> -la macom_config.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证YAML格式</span></span><br><span class="line">python -c <span class="string">&quot;import yaml; yaml.safe_load(open(&#x27;macom_config.yaml&#x27;))&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>MPI进程数不匹配</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 确保配置文件中的num_procs与yhrun的-n参数一致</span></span><br><span class="line"><span class="comment"># 例如：yhrun -n 6 对应配置文件中的 num_procs: 6</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>数据路径问题</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查输入数据是否存在</span></span><br><span class="line"><span class="built_in">ls</span> -la /path/to/input/data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 确保输出目录可写</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /path/to/output</span><br><span class="line"><span class="built_in">chmod</span> 755 /path/to/output</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>环境变量问题</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 确保所有必要的环境变量都已设置</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$LD_LIBRARY_PATH</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$CMAKE_PREFIX_PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查MPI环境</span></span><br><span class="line"><span class="built_in">which</span> mpirun</span><br><span class="line">mpirun --version</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="7-6-性能优化"><a href="#7-6-性能优化" class="headerlink" title="7.6 性能优化"></a>7.6 性能优化</h3><ul>
<li>根据系统资源调整MPI进程数</li>
<li>使用适当的输出频率减少I&#x2F;O开销</li>
<li>考虑使用并行I&#x2F;O提高性能</li>
<li>监控内存使用情况，避免OOM错误</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/05/15/Seminar/20250315-%E4%B8%8A%E6%B5%B7%E6%B0%94%E8%B1%A1%E5%AD%A6%E4%BC%9A%E5%AD%A6%E6%9C%AF%E5%B9%B4%E4%BC%9A/" rel="prev" title="上海气象学会学术年会">
      <i class="fa fa-chevron-left"></i> 上海气象学会学术年会
    </a></div>
      <div class="post-nav-item">
    <a href="/2050/01/01/Welcome/" rel="next" title="Welcome to my blog">
      Welcome to my blog <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#METADA-install"><span class="nav-number">1.</span> <span class="nav-text">METADA-install</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E7%AE%80%E4%BB%8B"><span class="nav-number">1.1.</span> <span class="nav-text">项目简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E7%8E%AF%E5%A2%83%E8%AF%B4%E6%98%8E"><span class="nav-number">1.2.</span> <span class="nav-text">安装环境说明</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E8%AE%BE%E7%BD%AE"><span class="nav-number">1.2.1.</span> <span class="nav-text">环境变量设置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E9%80%BB%E8%BE%91%E6%A6%82%E8%BF%B0"><span class="nav-number">1.3.</span> <span class="nav-text">安装逻辑概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4"><span class="nav-number">1.4.</span> <span class="nav-text">安装步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E5%AE%89%E8%A3%85Lmod%E6%A8%A1%E5%9D%97%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="nav-number">1.4.1.</span> <span class="nav-text">第一步：安装Lmod模块管理系统</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-%E5%AE%89%E8%A3%85Lua-5-4"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">1.1 安装Lua 5.4</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-%E5%AE%89%E8%A3%85LuaRocks"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">1.2 安装LuaRocks</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-%E5%AE%89%E8%A3%85luaposix"><span class="nav-number">1.4.1.3.</span> <span class="nav-text">1.3 安装luaposix</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-%E5%AE%89%E8%A3%85Lmod"><span class="nav-number">1.4.1.4.</span> <span class="nav-text">1.4 安装Lmod</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5-%E9%AA%8C%E8%AF%81Lmod%E5%92%8Cluaposix%E5%AE%89%E8%A3%85"><span class="nav-number">1.4.1.5.</span> <span class="nav-text">1.5 验证Lmod和luaposix安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-6-%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4"><span class="nav-number">1.4.1.6.</span> <span class="nav-text">1.6 故障排除</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E5%AE%89%E8%A3%85HPC-Stack%E7%A7%91%E5%AD%A6%E8%BD%AF%E4%BB%B6%E5%BA%93"><span class="nav-number">1.4.2.</span> <span class="nav-text">第二步：安装HPC-Stack科学软件库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-%E4%BD%BF%E7%94%A8HPC-Stack%E8%87%AA%E5%8A%A8%E5%AE%89%E8%A3%85%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%89"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">2.1 使用HPC-Stack自动安装（推荐）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-%E6%89%8B%E5%8A%A8%E5%AE%89%E8%A3%85%E5%90%84%E4%B8%AA%E7%BB%84%E4%BB%B6"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">2.2 手动安装各个组件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-1-%E5%AE%89%E8%A3%85GCC-14-2-0%EF%BC%88%E5%A6%82%E6%9E%9C%E9%9C%80%E8%A6%81%EF%BC%89"><span class="nav-number">1.4.2.2.1.</span> <span class="nav-text">2.2.1 安装GCC 14.2.0（如果需要）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-2-%E5%AE%89%E8%A3%85CMake-3-31-1"><span class="nav-number">1.4.2.2.2.</span> <span class="nav-text">2.2.2 安装CMake 3.31.1</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-3-%E5%AE%89%E8%A3%85OpenMPI"><span class="nav-number">1.4.2.2.3.</span> <span class="nav-text">2.2.3 安装OpenMPI</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-4-%E5%AE%89%E8%A3%85zlib"><span class="nav-number">1.4.2.2.4.</span> <span class="nav-text">2.2.4 安装zlib</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-5-%E5%AE%89%E8%A3%85szip"><span class="nav-number">1.4.2.2.5.</span> <span class="nav-text">2.2.5 安装szip</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-6-%E5%AE%89%E8%A3%85HDF5"><span class="nav-number">1.4.2.2.6.</span> <span class="nav-text">2.2.6 安装HDF5</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-7-%E5%AE%89%E8%A3%85NetCDF-C"><span class="nav-number">1.4.2.2.7.</span> <span class="nav-text">2.2.7 安装NetCDF-C</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-8-%E5%AE%89%E8%A3%85NetCDF-Fortran"><span class="nav-number">1.4.2.2.8.</span> <span class="nav-text">2.2.8 安装NetCDF-Fortran</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-9-%E5%AE%89%E8%A3%85NetCDF-CXX4"><span class="nav-number">1.4.2.2.9.</span> <span class="nav-text">2.2.9 安装NetCDF-CXX4</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4"><span class="nav-number">1.4.2.3.</span> <span class="nav-text">2.3 故障排除</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E5%AE%89%E8%A3%85Python%E7%8E%AF%E5%A2%83"><span class="nav-number">1.4.3.</span> <span class="nav-text">第三步：安装Python环境</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-%E5%AE%89%E8%A3%85Miniconda"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">3.1 安装Miniconda</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-%E5%AE%89%E8%A3%85%E5%BF%85%E8%A6%81%E7%9A%84Python%E5%8C%85"><span class="nav-number">1.4.3.2.</span> <span class="nav-text">3.2 安装必要的Python包</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E5%9B%9B%E6%AD%A5%EF%BC%9A%E5%AE%89%E8%A3%85%E5%85%B6%E4%BB%96%E4%BE%9D%E8%B5%96%E5%BA%93"><span class="nav-number">1.4.4.</span> <span class="nav-text">第四步：安装其他依赖库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-%E5%AE%89%E8%A3%85Eigen3"><span class="nav-number">1.4.4.1.</span> <span class="nav-text">4.1 安装Eigen3</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-%E5%AE%89%E8%A3%85glog%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%BD%BF%E7%94%A8glog%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%EF%BC%89"><span class="nav-number">1.4.4.2.</span> <span class="nav-text">4.2 安装glog（可选，如果使用glog日志系统）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-%E5%AE%89%E8%A3%85ng-log%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%8CMETADA%E9%BB%98%E8%AE%A4%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%EF%BC%89"><span class="nav-number">1.4.4.3.</span> <span class="nav-text">4.3 安装ng-log（推荐，METADA默认日志系统）</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%AF%E8%83%BD%E8%A6%81%E5%A2%9E%E5%8A%A0%E5%8A%A8%E6%80%81%E5%BA%93%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-number">2.</span> <span class="nav-text">可能要增加动态库环境变量</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9C%A8LD-LIBRARY-PATH%E4%B8%AD%E6%B7%BB%E5%8A%A0ng-log"><span class="nav-number">3.</span> <span class="nav-text">在LD_LIBRARY_PATH中添加ng-log</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#export-LD-LIBRARY-PATH-x3D-%E2%80%9D-INSTALL-DIR-x2F-ng-log-x2F-lib-LD-LIBRARY-PATH%E2%80%9D"><span class="nav-number">4.</span> <span class="nav-text">export LD_LIBRARY_PATH&#x3D;”$INSTALL_DIR&#x2F;ng-log&#x2F;lib:$LD_LIBRARY_PATH”</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-%E5%AE%89%E8%A3%85gflags"><span class="nav-number">4.0.0.1.</span> <span class="nav-text">4.4 安装gflags</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-%E5%AE%89%E8%A3%85yaml-cpp"><span class="nav-number">4.0.0.2.</span> <span class="nav-text">4.5 安装yaml-cpp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-6-%E5%AE%89%E8%A3%85nlohmann-json"><span class="nav-number">4.0.0.3.</span> <span class="nav-text">4.6 安装nlohmann-json</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-7-%E5%AE%89%E8%A3%85Google-Test"><span class="nav-number">4.0.0.4.</span> <span class="nav-text">4.7 安装Google Test</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-8-%E5%AE%89%E8%A3%85xtensor"><span class="nav-number">4.0.0.5.</span> <span class="nav-text">4.8 安装xtensor</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-9-%E5%AE%89%E8%A3%85xtl"><span class="nav-number">4.0.0.6.</span> <span class="nav-text">4.9 安装xtl</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-10-%E5%AE%89%E8%A3%85nanoflann"><span class="nav-number">4.0.0.7.</span> <span class="nav-text">4.10 安装nanoflann</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-11-%E5%AE%89%E8%A3%85lcov"><span class="nav-number">4.0.0.8.</span> <span class="nav-text">4.11 安装lcov</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-12-%E5%AE%89%E8%A3%85LLVM-x2F-Clang%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%8C%E5%BB%BA%E8%AE%AE%E5%AE%89%E8%A3%85%EF%BC%89"><span class="nav-number">4.0.0.9.</span> <span class="nav-text">4.12 安装LLVM&#x2F;Clang（可选，建议安装）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-13-%E5%AE%89%E8%A3%85Ninja%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%8C%E6%8E%A8%E8%8D%90%E5%AE%89%E8%A3%85%EF%BC%89"><span class="nav-number">4.0.0.10.</span> <span class="nav-text">4.13 安装Ninja（可选，推荐安装）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-14-%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4"><span class="nav-number">4.0.0.11.</span> <span class="nav-text">4.14 故障排除</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%BA%94%E6%AD%A5%EF%BC%9A%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-number">4.0.1.</span> <span class="nav-text">第五步：配置环境变量</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4"><span class="nav-number">4.0.1.1.</span> <span class="nav-text">5.2 故障排除</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E5%85%AD%E6%AD%A5%EF%BC%9A%E7%BC%96%E8%AF%91METADA"><span class="nav-number">4.0.2.</span> <span class="nav-text">第六步：编译METADA</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-1-%E5%85%8B%E9%9A%86METADA%E9%A1%B9%E7%9B%AE"><span class="nav-number">4.0.2.1.</span> <span class="nav-text">6.1 克隆METADA项目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-%E5%88%9B%E5%BB%BA%E6%9E%84%E5%BB%BA%E8%84%9A%E6%9C%AC"><span class="nav-number">4.0.2.2.</span> <span class="nav-text">6.2 创建构建脚本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-3-%E8%BF%90%E8%A1%8C%E6%9E%84%E5%BB%BA%E8%84%9A%E6%9C%AC"><span class="nav-number">4.0.2.3.</span> <span class="nav-text">6.3 运行构建脚本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-4-%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95"><span class="nav-number">4.0.2.4.</span> <span class="nav-text">6.4 运行测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4"><span class="nav-number">4.0.2.5.</span> <span class="nav-text">6.5 故障排除</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%8C%81%E4%B9%85%E5%8C%96"><span class="nav-number">4.1.</span> <span class="nav-text">环境变量持久化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%B8%AE%E5%8A%A9"><span class="nav-number">4.1.1.</span> <span class="nav-text">获取帮助</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E5%AE%89%E8%A3%85"><span class="nav-number">4.2.</span> <span class="nav-text">验证安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8B%E4%B8%80%E6%AD%A5"><span class="nav-number">4.3.</span> <span class="nav-text">下一步</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%90%E8%A1%8CMACOM%E6%A8%A1%E5%BC%8F"><span class="nav-number">4.4.</span> <span class="nav-text">运行MACOM模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-%E5%87%86%E5%A4%87%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6"><span class="nav-number">4.4.1.</span> <span class="nav-text">7.1 准备执行文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-%E5%87%86%E5%A4%87%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">4.4.2.</span> <span class="nav-text">7.2 准备配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-%E8%BF%90%E8%A1%8CMACOM%E6%A8%A1%E5%BC%8F"><span class="nav-number">4.4.3.</span> <span class="nav-text">7.3 运行MACOM模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-4-%E5%8F%82%E8%80%83%E7%A4%BA%E4%BE%8B"><span class="nav-number">4.4.4.</span> <span class="nav-text">7.4 参考示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-5-%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4"><span class="nav-number">4.4.5.</span> <span class="nav-text">7.5 故障排除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-6-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">4.4.6.</span> <span class="nav-text">7.6 性能优化</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ruyanc"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">ruyanc</p>
  <div class="site-description" itemprop="description">E-mail: ruyan1810@gmail.com</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">232</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>




      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ruyanc</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.3" zIndex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>




  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true,"scale":0.5},"log":false});</script></body>
</html>

