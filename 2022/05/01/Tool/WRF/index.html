<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/Egg_32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/Egg_16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Install WRF1. 安装spack，并配置环境变量1.1 克隆spack仓库到本地12# 将spack克隆到~&#x2F;spack文件夹。克隆位置可改git clone -c feature.manyFiles&#x3D;true https:&#x2F;&#x2F;github.com&#x2F;spack&#x2F;spack.git ~&#x2F;spack  如果你无法连接到互联网，可以在github网页上，下载仓库的zip文件，然后解压到你所需要">
<meta property="og:type" content="article">
<meta property="og:title" content="WRF">
<meta property="og:url" content="http://example.com/2022/05/01/Tool/WRF/index.html">
<meta property="og:site_name" content="ruyanc">
<meta property="og:description" content="Install WRF1. 安装spack，并配置环境变量1.1 克隆spack仓库到本地12# 将spack克隆到~&#x2F;spack文件夹。克隆位置可改git clone -c feature.manyFiles&#x3D;true https:&#x2F;&#x2F;github.com&#x2F;spack&#x2F;spack.git ~&#x2F;spack  如果你无法连接到互联网，可以在github网页上，下载仓库的zip文件，然后解压到你所需要">
<meta property="og:locale">
<meta property="og:image" content="https://p.ipic.vip/zcqc2e.gif">
<meta property="og:image" content="https://p.ipic.vip/e3i9qk.png">
<meta property="og:image" content="https://p.ipic.vip/f81f9z.png">
<meta property="og:image" content="https://p.ipic.vip/uxc9es.png">
<meta property="og:image" content="https://p.ipic.vip/oc4t0m.png">
<meta property="og:image" content="https://p.ipic.vip/slh6zj.png">
<meta property="og:image" content="https://p.ipic.vip/01pvfo.png">
<meta property="og:image" content="https://p.ipic.vip/mv27e1.png">
<meta property="og:image" content="https://p.ipic.vip/ppxmjx.png">
<meta property="og:image" content="https://p.ipic.vip/81ddfy.png">
<meta property="og:image" content="https://p.ipic.vip/4evafh.png">
<meta property="og:image" content="https://p.ipic.vip/p94isl.png">
<meta property="og:image" content="https://p.ipic.vip/u7ntww.png">
<meta property="og:image" content="https://p.ipic.vip/klsyyu.png">
<meta property="og:image" content="https://p.ipic.vip/k2h2so.png">
<meta property="og:image" content="https://p.ipic.vip/maweap.png">
<meta property="og:image" content="https://p.ipic.vip/unn0c2.png">
<meta property="og:image" content="https://p.ipic.vip/947sw3.png">
<meta property="og:image" content="https://p.ipic.vip/08b0qm.png">
<meta property="og:image" content="https://p.ipic.vip/i02t2x.png">
<meta property="og:image" content="https://p.ipic.vip/n9x4sh.png">
<meta property="og:image" content="https://p.ipic.vip/qcwten.png">
<meta property="og:image" content="https://p.ipic.vip/fpxz6g.png">
<meta property="og:image" content="https://p.ipic.vip/qp9ot3.png">
<meta property="og:image" content="https://p.ipic.vip/aawby3.png">
<meta property="og:image" content="https://p.ipic.vip/8ae471.png">
<meta property="article:published_time" content="2022-05-01T04:00:00.000Z">
<meta property="article:modified_time" content="2023-07-28T02:26:58.164Z">
<meta property="article:author" content="ruyanc">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p.ipic.vip/zcqc2e.gif">

<link rel="canonical" href="http://example.com/2022/05/01/Tool/WRF/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>WRF | ruyanc</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">ruyanc</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Acedemic Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-atmsci">

    <a href="/categories/AtmSci/" rel="section"><i class="fa fa-graduation-cap fa-fw"></i>AtmSci</a>

  </li>
        <li class="menu-item menu-item-ocnsci">

    <a href="/categories/OcnSci/" rel="section"><i class="fa fa-graduation-cap fa-fw"></i>OcnSci</a>

  </li>
        <li class="menu-item menu-item-seminar">

    <a href="/categories/Seminar/" rel="section"><i class="fa fa-users fa-fw"></i>Seminar</a>

  </li>
        <li class="menu-item menu-item-readcube">

    <a href="/categories/ReadCube/" rel="section"><i class="fa fa-archive fa-fw"></i>ReadCube</a>

  </li>
        <li class="menu-item menu-item-publication">

    <a href="/categories/Publication" rel="section"><i class="fa fa-archive fa-fw"></i>Publication</a>

  </li>
        <li class="menu-item menu-item-recharge">

    <a href="/categories/Recharge/" rel="section"><i class="fa fa-coffee fa-fw"></i>Recharge</a>

  </li>
        <li class="menu-item menu-item-tool">

    <a href="/categories/Tool/" rel="section"><i class="fa fa-wrench fa-fw"></i>Tool</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/01/Tool/WRF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ruyanc">
      <meta itemprop="description" content="E-mail: ruyan1810@gmail.com">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruyanc">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          WRF
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-05-01 12:00:00" itemprop="dateCreated datePublished" datetime="2022-05-01T12:00:00+08:00">2022-05-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-07-28 10:26:58" itemprop="dateModified" datetime="2023-07-28T10:26:58+08:00">2023-07-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tool/" itemprop="url" rel="index"><span itemprop="name">Tool</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Install-WRF"><a href="#Install-WRF" class="headerlink" title="Install WRF"></a>Install WRF</h2><h4 id="1-安装spack，并配置环境变量"><a href="#1-安装spack，并配置环境变量" class="headerlink" title="1. 安装spack，并配置环境变量"></a>1. 安装spack，并配置环境变量</h4><h5 id="1-1-克隆spack仓库到本地"><a href="#1-1-克隆spack仓库到本地" class="headerlink" title="1.1 克隆spack仓库到本地"></a>1.1 克隆spack仓库到本地</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将spack克隆到~/spack文件夹。克隆位置可改</span></span><br><span class="line">git clone -c feature.manyFiles=true https://github.com/spack/spack.git ~/spack</span><br></pre></td></tr></table></figure>

<p>如果你无法连接到互联网，可以在github网页上，下载仓库的zip文件，然后解压到你所需要的位置。</p>
<h5 id="1-2-将spack-setup环境命令加载到bashrc中"><a href="#1-2-将spack-setup环境命令加载到bashrc中" class="headerlink" title="1.2 将spack setup环境命令加载到bashrc中"></a>1.2 将spack setup环境命令加载到bashrc中</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;source ~/spack/share/spack/setup-env.sh&quot; &gt;&gt; ~/.bashrc</span><br><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure>

<h5 id="1-3-寻找编译器"><a href="#1-3-寻找编译器" class="headerlink" title="1.3 寻找编译器"></a>1.3 寻找编译器</h5><p>spack可以搜索你的环境变量<code>PATH</code>中所有编译器的可执行文件，并将其全路径保存到<code>~/.spack/linux/compilers.yaml</code>文件中。</p>
<p>假设你的超算上已使用module等方法管理编译器，你也可以先load你需要用到的编译器。总之，你需要保证你的编译器的可执行文件位于系统的<code>PATH</code>环境变量中。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spack compiler find</span><br></pre></td></tr></table></figure>

<p>当然你也可以打开<code>~/.spack/linux/compilers.yaml</code>文件，手动修改路径</p>
<h4 id="2-安装wrf"><a href="#2-安装wrf" class="headerlink" title="2. 安装wrf"></a>2. 安装wrf</h4><h5 id="2-1-如果可以连接互联网"><a href="#2-1-如果可以连接互联网" class="headerlink" title="2.1 如果可以连接互联网"></a>2.1 如果可以连接互联网</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spack install wrf</span><br></pre></td></tr></table></figure>

<p>这样就完成了！只需一步，立刻就可以完成！</p>
<h5 id="2-2-如果无法连接互联网"><a href="#2-2-如果无法连接互联网" class="headerlink" title="2.2 如果无法连接互联网"></a>2.2 如果无法连接互联网</h5><p>在一台可以连网的liux机器上安装spack；接着，执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spack info wrf </span><br></pre></td></tr></table></figure>

<p>查询wrf需要安装哪些依赖项。由输出信息可得知，wrf需要依赖</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdf5,jemalloc,libtirpc,m4,netcdf-c,parallel-netcdf,pkgconfig,time,jasper,libpng,libtool,mpi,netcdf-fortran,perl,tcsh和zlib；</span><br></pre></td></tr></table></figure>

<p>接着，执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spack mirror create hdf5 jemalloc libtirpc  m4 netcdf-c parallel-netcdf pkgconfig time jasper libpng libtool mpi netcdf-fortran  perl tcsh zlib wrf</span><br></pre></td></tr></table></figure>

<p>spack会提示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Successfully updated mirror in file:/[某路径]</span><br></pre></td></tr></table></figure>

<p>将该路径的文件全部打包，移动到你无法联网的那台机器上。然后再执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spack install wrf</span><br></pre></td></tr></table></figure>

<p>即可！</p>
<h2 id="WRF-run-with-CFS"><a href="#WRF-run-with-CFS" class="headerlink" title="WRF run with CFS"></a>WRF run with CFS</h2><p>数据介绍：</p>
<p>Saha, S., Moorthi, S., Wu, X., et al. (2014). The NCEP climate forecast system version 2. Journal of Climate, 27(6), 2185–2208. <a target="_blank" rel="noopener" href="https://doi.org/10.1175/JCLI-D-12-00823.1">https://doi.org/10.1175/JCLI-D-12-00823.1</a></p>
<p>实时预报数据下载地址：</p>
<p><a target="_blank" rel="noopener" href="https://nomads.ncep.noaa.gov/pub/data/nccf/com/cfs/prod/cfs/">https://nomads.ncep.noaa.gov/pub/data/nccf/com/cfs/prod/cfs/</a></p>
<p>历史预报数据下载地址：</p>
<p><a target="_blank" rel="noopener" href="https://www.ncei.noaa.gov/data/climate-forecast-system/access/operational-9-month-forecast/">https://www.ncei.noaa.gov/data/climate-forecast-system/access/operational-9-month-forecast/</a></p>
<p>数据下载脚本：</p>
<p>In [1]:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">@ 气象备忘录</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">@ meteo_notebook@163.com</span></span><br><span class="line"></span><br><span class="line">import os,sys</span><br><span class="line">from datetime import datetime,timedelta</span><br><span class="line">import bisect</span><br><span class="line">import pandas as pd </span><br><span class="line"></span><br><span class="line">def str2time(timestr, format = &quot;%Y%m%d%H&quot;):</span><br><span class="line">    return datetime.strptime(timestr, format)</span><br><span class="line"></span><br><span class="line">def time2str(time, format = &quot;%Y%m%d%H&quot;):</span><br><span class="line">    return datetime.strftime(time, format)</span><br><span class="line"></span><br><span class="line">def download_cfs():</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    下载实时预报数据</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    dt_init  = str2time(init)</span><br><span class="line">    </span><br><span class="line">    HH       = time2str(dt_init, &quot;%H&quot;)</span><br><span class="line">    YYYY     = time2str(dt_init, &quot;%Y&quot;)</span><br><span class="line">    YYYYMM   = time2str(dt_init, &quot;%Y%m&quot;)</span><br><span class="line">    YYYYMMDD = time2str(dt_init, &quot;%Y%m%d&quot;)</span><br><span class="line">    </span><br><span class="line">    url_root = &quot;https://nomads.ncep.noaa.gov/pub/data/nccf/com/cfs/prod/cfs&quot;</span><br><span class="line">    url      = f&quot;&#123;url_root&#125;/cfs.&#123;YYYYMMDD&#125;/&#123;HH&#125;/6hrly_grib_01&quot;</span><br><span class="line">    </span><br><span class="line">    valid = time2str(dt_valid)</span><br><span class="line">    # 等压面数据</span><br><span class="line">    os.system(f&quot;axel &#123;url&#125;/pgbf&#123;valid&#125;.01.&#123;init&#125;.grb2&quot;)</span><br><span class="line">    # 地表数据</span><br><span class="line">    os.system(f&quot;axel &#123;url&#125;/flxf&#123;valid&#125;.01.&#123;init&#125;.grb2&quot;)</span><br><span class="line">    </span><br><span class="line">def download_cfs_his():</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    下载历史数据</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    dt_init  = str2time(init)</span><br><span class="line">    YYYY     = dt_init.strftime(&quot;%Y&quot;)</span><br><span class="line">    YYYYMM   = dt_init.strftime(&quot;%Y%m&quot;)</span><br><span class="line">    YYYYMMDD = dt_init.strftime(&quot;%Y%m%d&quot;)</span><br><span class="line">    </span><br><span class="line">    url_root = &quot;https://www.ncei.noaa.gov/data/climate-forecast-system/access/operational-9-month-forecast&quot;</span><br><span class="line">    url_pres = f&quot;&#123;url_root&#125;/6-hourly-by-pressure/&#123;YYYY&#125;/&#123;YYYYMM&#125;/&#123;YYYYMMDD&#125;/&#123;init&#125;&quot;</span><br><span class="line">    url_sfc  = f&quot;&#123;url_root&#125;/6-hourly-flux/&#123;YYYY&#125;/&#123;YYYYMM&#125;/&#123;YYYYMMDD&#125;/&#123;init&#125;&quot;</span><br><span class="line">    </span><br><span class="line">    valid = time2str(dt_valid)</span><br><span class="line">    # 等压面数据</span><br><span class="line">    os.system(f&quot;axel &#123;url_pres&#125;/pgbf&#123;valid&#125;.01.&#123;init&#125;.grb2&quot;)</span><br><span class="line">    # 地表数据</span><br><span class="line">    os.system(f&quot;axel &#123;url_sfc&#125;/flxf&#123;valid&#125;.01.&#123;init&#125;.grb2&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    </span><br><span class="line">    init  = &quot;2022040600&quot;  # 模式起报时间</span><br><span class="line">    </span><br><span class="line">    # 预报时段很长，仅下载其中的一部分</span><br><span class="line">    start = &quot;2022040600&quot;  # 下载数据开始时间</span><br><span class="line">    end   = &quot;2022040700&quot;  # 下载数据结束时间</span><br><span class="line"></span><br><span class="line">    # 下载目录设置</span><br><span class="line">    wrk_dir = f&quot;/home/data/cfs/&#123;init&#125;&quot;</span><br><span class="line">    if not os.path.exists(wrk_dir): os.makedirs(wrk_dir)</span><br><span class="line">    os.chdir(wrk_dir)</span><br><span class="line"></span><br><span class="line">    idx = pd.date_range(str2time(start), str2time(end), freq=&#x27;6H&#x27;)</span><br><span class="line">    for dt_valid in idx:</span><br><span class="line">        print(dt_valid)</span><br><span class="line">        download_cfs()</span><br><span class="line">2022-04-06 00:00:00</span><br><span class="line">2022-04-06 06:00:00</span><br><span class="line">2022-04-06 12:00:00</span><br><span class="line">2022-04-06 18:00:00</span><br><span class="line">2022-04-07 00:00:00</span><br></pre></td></tr></table></figure>

<p>驱动WRF</p>
<p>In [ ]:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -sf ungrib/Variable_Tables/Vtable.CFSR Vtable</span><br><span class="line">./link_grib.csh $&#123;DATA_PATH&#125;/*  # 可以同时链接等压面和地表数据</span><br></pre></td></tr></table></figure>



<h2 id="WRF-notes"><a href="#WRF-notes" class="headerlink" title="WRF notes"></a>WRF notes</h2><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/TkQfZJlnbiOd2_9XFnAehw">https://mp.weixin.qq.com/s/TkQfZJlnbiOd2_9XFnAehw</a></p>
<p>WPS只是WRF运用实际数据模拟的准备过程，这就好比开车要先上车。讲完前处理过程之后 <a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzIyOTc5NjE4MQ==&mid=2247484195&idx=1&sn=8bbaab8961f31fdcfd7be91edac58480&chksm=e8bc7319dfcbfa0f4128114c2a2745f16d660260b2dbda5f4431beff76b526db341211834642&scene=21#wechat_redirect">WRF模式之WPS的配置运行</a>，就要开始模拟了。</p>
<p>模拟之前同样需要设置参数，这里的参数通过 namelist.input 文件控制，常规的 namelist.input 文件内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">&amp;time_control</span><br><span class="line"> run_days                            = 1,</span><br><span class="line"> run_hours                           = 0,</span><br><span class="line"> run_minutes                         = 0,</span><br><span class="line"> run_seconds                         = 0,</span><br><span class="line"> start_year                          = 2015, 2015,</span><br><span class="line"> start_month                         = 10, 10,</span><br><span class="line"> start_day                           = 04, 04,</span><br><span class="line"> start_hour                          = 00, 00,</span><br><span class="line"> start_minute                        = 00, 00,</span><br><span class="line"> start_second                        = 00, 00,</span><br><span class="line"> end_year                            = 2015, 2015,</span><br><span class="line"> end_month                           = 10, 10,</span><br><span class="line"> end_day                             = 05, 05,</span><br><span class="line"> end_hour                            = 00, 00,</span><br><span class="line"> end_minute                          = 00, 00,</span><br><span class="line"> end_second                          = 00, 00,</span><br><span class="line"> interval_seconds                    = 21600</span><br><span class="line"> input_from_file                     = .true.,.true.,</span><br><span class="line"> history_interval                    = 10,   5,  # 表示多长时间输出一次结果</span><br><span class="line"> frames_per_outfile                  = 36,  36,  # 表示多少个结果输出到一个文件</span><br><span class="line"> restart                             = .false.,</span><br><span class="line"> restart_interval                    = 360,</span><br><span class="line"> io_form_history                     = 2</span><br><span class="line"> io_form_restart                     = 2</span><br><span class="line"> io_form_input                       = 2</span><br><span class="line"> io_form_boundary                    = 2</span><br><span class="line"> debug_level                         = 10</span><br><span class="line"> /</span><br><span class="line"></span><br><span class="line"> &amp;domains</span><br><span class="line"> time_step                           = 45,</span><br><span class="line"> time_step_fract_num                 = 0,</span><br><span class="line"> time_step_fract_den                 = 1,</span><br><span class="line"> max_dom                             = 2,</span><br><span class="line"> s_we                                = 1,     1,</span><br><span class="line"> e_we                                = 241,   424,</span><br><span class="line"> s_sn                                = 1,     1,</span><br><span class="line"> e_sn                                = 220,   421,</span><br><span class="line"> s_vert                              = 1,     1,</span><br><span class="line"> e_vert                              =  48,    48,</span><br><span class="line"> sfcp_to_sfcp                        = .false.</span><br><span class="line"> dx                                  = 9000,   3000,</span><br><span class="line"> dy                                  = 9000,   3000,</span><br><span class="line"> grid_id                             = 1,     2,</span><br><span class="line"> parent_id                           = 0,     1,</span><br><span class="line"> i_parent_start                      = 0,    50,</span><br><span class="line"> j_parent_start                      = 0,    40,</span><br><span class="line"> parent_grid_ratio                   = 1,    3,</span><br><span class="line"> parent_time_step_ratio              = 1,    3,</span><br><span class="line"> feedback                            = 0,</span><br><span class="line"> smooth_option                       = 1,</span><br><span class="line"> num_metgrid_levels                  = 27,</span><br><span class="line"> num_metgrid_soil_levels             = 4,</span><br><span class="line"> p_top_requested                     = 5000,</span><br><span class="line"> /</span><br><span class="line"></span><br><span class="line"> &amp;physics</span><br><span class="line"> mp_physics                          = 17,     17,</span><br><span class="line"> gsfcgce_hail                        = 0,    </span><br><span class="line"> gsfcgce_2ice                        = 0,    </span><br><span class="line"> ra_lw_physics                       = 1,     1,</span><br><span class="line"> ra_sw_physics                       = 1,     1,</span><br><span class="line"> radt                                = 9,     9,</span><br><span class="line"> sf_sfclay_physics                   = 1,     1,</span><br><span class="line"> sf_surface_physics                  = 2,     2,</span><br><span class="line"> bl_pbl_physics                      = 1,     1,</span><br><span class="line"> bldt                                = 0,     0,</span><br><span class="line"> cu_physics                          = 1,     0,</span><br><span class="line"> cudt                                = 5,     0,</span><br><span class="line"> surface_input_source                = 1,</span><br><span class="line"> num_soil_layers                     = 4,</span><br><span class="line"> maxiens                             = 1,</span><br><span class="line"> maxens                              = 3,</span><br><span class="line"> maxens2                             = 3,</span><br><span class="line"> maxens3                             = 16,</span><br><span class="line"> ensdim                              = 144,</span><br><span class="line"> /</span><br><span class="line"></span><br><span class="line"> &amp;fdda</span><br><span class="line"> /</span><br><span class="line"></span><br><span class="line"> &amp;dynamics</span><br><span class="line"> w_damping                           = 1,</span><br><span class="line"> diff_opt                            = 2,</span><br><span class="line"> km_opt                              = 4,</span><br><span class="line"> diff_6th_opt                        = 2,</span><br><span class="line"> diff_6th_factor                     = 0.12,</span><br><span class="line"> damp_opt                            = 0,</span><br><span class="line"> base_temp                           = 290.</span><br><span class="line"> zdamp                               = 5000.,  5000.,</span><br><span class="line"> dampcoef                            = 0.2,    0.2,</span><br><span class="line"> khdif                               =   0,     0,  </span><br><span class="line"> kvdif                               =   0,     0,  </span><br><span class="line"> non_hydrostatic                     = .true., .true.,</span><br><span class="line"> time_step_sound                     = 6,      6,  </span><br><span class="line"> h_mom_adv_order                     = 5,      5,  </span><br><span class="line"> v_mom_adv_order                     = 5,      5,  </span><br><span class="line"> h_sca_adv_order                     = 5,      5,  </span><br><span class="line"> v_sca_adv_order                     = 5,      5,  </span><br><span class="line"> moist_adv_opt                       = 3,</span><br><span class="line"> scalar_adv_opt                      = 3,</span><br><span class="line"> momentum_adv_opt                    = 3,</span><br><span class="line"> chem_adv_opt                        = 3,</span><br><span class="line"> tke_adv_opt                         = 3,</span><br><span class="line"> /</span><br><span class="line"></span><br><span class="line"> &amp;bdy_control</span><br><span class="line"> spec_bdy_width                      = 5,</span><br><span class="line"> spec_zone                           = 1,</span><br><span class="line"> relax_zone                          = 4,</span><br><span class="line"> specified                           = .true.,</span><br><span class="line"> nested                              = .false., .true.,</span><br><span class="line"> /</span><br><span class="line"></span><br><span class="line"> &amp;grib2</span><br><span class="line"> /</span><br><span class="line"></span><br><span class="line"> &amp;namelist_quilt</span><br><span class="line"> nio_tasks_per_group = 0,</span><br><span class="line"> nio_groups = 1,</span><br><span class="line"> /</span><br></pre></td></tr></table></figure>



<p>一般情况下，在模拟时需要关心的是 &amp;time_control， &amp;domains，&amp;physics部分的参数设置。</p>
<p>&amp;time_control 部分主要控制的是模拟的时间范围，debug 信息输出，输出格式等信息。</p>
<p><strong>注意</strong>：</p>
<p>&amp;domains 部分的参数设置要和所用初始场以及WPS namelist.wps的一些参数设置相同，否则会出错。 </p>
<p>&amp;physics 部分主要控制的是微物理方案，辐射方案以及积云对流参数化等的选择。</p>
<p>&amp;dynamics 部分控制的是动力参数的设置。</p>
<p>&amp;fdda 主要应用于资料同化参数的设置。</p>
<p>还有一些其它部分的参数设置，通常这些部分的参数不需要更改。</p>
<p>大概了解了一下namelist.input的参数设置之后，就可以运行了。再运行之前，先把WPS过程中运行 metgrid.exe 的时候生成了一些 met_em*文件<strong>拷贝</strong>或是<strong>链接</strong>到 WRFV3&#x2F;run下，当然也可以链接到 WRFV3&#x2F;test&#x2F;em_real&#x2F; 下。（关于链接和拷贝的命令看这里 <a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzIyOTc5NjE4MQ==&mid=2247483970&idx=1&sn=c5c10f9190cb1bfd7a06d830441e927e&chksm=e8bc7278dfcbfb6ec76c6b31b96030a51849ca7a4d643a0323e41046957a47736f8ba9371bfe&scene=21#wechat_redirect">linux常用命令之进阶</a>）</p>
<p>开始之前先进入 WRFV3&#x2F;run 目录下：</p>
<ul>
<li><p>链接 met_em* 文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -sf ../../WPS/met_em.d0* .</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>注意</strong>： 命令后的 . 不能省，这里的 . 表示当前路径。</p>
<ul>
<li><p>初始化气象要素</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./real.exe</span><br></pre></td></tr></table></figure>

<p>运行成功后会生成一些文件，wrfbdy_d01，wrfinput_d*</p>
</li>
<li><p>模拟积分——开始模拟</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./wrf.exe</span><br></pre></td></tr></table></figure>

<p>上述方式为串行运行，如果编译支持并行运算的话，可以执行以下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mpirun -np 4 ./wrf.exe</span><br></pre></td></tr></table></figure>

<p>表示使用4个处理器进行运算。当然， real.exe 也支持并行运算。</p>
</li>
</ul>
<p>然后就等模拟结束就行了。耗时长短与模拟个例时间长短，嵌套层数多少，模拟域范围大小等因素有关。当然，如果出错了的话就另说了&#x3D;&#x3D;</p>
<p>模拟结束之后会生成一系列输出文件，比如：wrfout_d01_2015-10-04_00:00:00 等文件。可能没有后缀，但是默认的输出文件格式为 nc。模拟结束之后就是后处理过程了。</p>
<p>关于模式后处理，之前也提到过一些：</p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzIyOTc5NjE4MQ==&mid=2247483979&idx=1&sn=25876476b164990b9baefd8556b437e7&chksm=e8bc7271dfcbfb67d42b57bdf6549b814db47875cb8e003388709a032e788559554874f3350f&scene=21#wechat_redirect">真・WRF模式后处理之Python版</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzIyOTc5NjE4MQ==&mid=2247483947&idx=1&sn=1545c8f3592dcd4a26e39c9d79a4675c&chksm=e8bc7211dfcbfb07404bd16146c3255514dd3e718f3e8c54bf497e3a30f9b949e813279a0ef1&scene=21#wechat_redirect">WRF模式后处理</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzIyOTc5NjE4MQ==&mid=2247484134&idx=1&sn=3d28deab9516aa94e8c37394731845a1&chksm=e8bc72dcdfcbfbca73cbf44fc143b5524f21d907447d1a58c5389e813e513b7fde617be98497&scene=21#wechat_redirect">高维数据可视化</a></p>
<p>后处理过程其实就是处理数据的过程。使用什么工具或是编程语言都可以，没有限制。只要你能得到想要的结果就行了。</p>
<h2 id="Weather-Research-and-Forecasting-WRF"><a href="#Weather-Research-and-Forecasting-WRF" class="headerlink" title="Weather Research and Forecasting | WRF"></a>Weather Research and Forecasting | WRF</h2><p>来源：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/VN3tvMMPRKSPJu7O9hwyiA">https://mp.weixin.qq.com/s/VN3tvMMPRKSPJu7O9hwyiA</a></p>
<p> Weather Research and Forecasting（WRF）是一种由国家大气研究中心（NCAR）、国家海洋和大气管理局（NOAA）及其合作伙伴共同开发的广泛使用的数值天气预测和大气研究工具。它用于模拟短期天气预报、大气过程和长期气候模拟。WRF的精度高于传统的数值天气预报模型，并具有更高的时空分辨率，是气象和大气研究社区的重要工具。</p>
<p>WRF用户手册可通过两种方法获取：</p>
<ol>
<li>下载网址自行下载：</li>
</ol>
<blockquote>
<p>WRF Users’ Guide (ucar.edu)</p>
</blockquote>
<ol start="2">
<li>后台回复 *<strong>WRF用户手册*</strong> 获取。</li>
</ol>
<p><img src="https://p.ipic.vip/zcqc2e.gif" alt="Image">### WRF的基本结构</p>
<p><img src="https://p.ipic.vip/e3i9qk.png" alt="Image"></p>
<p>WRF模式包含预处理系统WPS、ARW动态求解器及后处理模块。WPS主要用来定义模拟区域及网格，将外部数据源获得的地面静态数据（如地形、土地利用类型、土壤参数等）插值到模拟域，并将气象数据水平插值到WRF模拟域网格中，为WRF主程序程序提供所需数据。ARW动态求解器是整个WRF模式的核心组成部分，将WPS前处理系统插值处理好的数据转化为指定格式的初始场和边界条件，并进行模式的积分运算。后处理一般采用NCL或者python。</p>
<h3 id="WRF的基本原理"><a href="#WRF的基本原理" class="headerlink" title="WRF的基本原理"></a>WRF的基本原理</h3><p>  WRF模式运用F90语言编写，采用完全可压缩及非静力的平衡模型，在水平方向采用ArakawaC（荒川C）网格点，垂直方向采用eta（地形跟随质量）坐标，时间积分上采用三阶或者四阶的Runge-Kutta算法。基础方程式由运动方程、连续方程、状态方程、热力学方程、水汽方程等组成，通过将势能、位温导入基础的N-S方程并进行地形坐标变换后得到。</p>
<p>  WRF基于用户定义的计算域上这些方程的有限差分或谱离散法，该计算域可以是曲线或伸展的，并且边界条件设置为静态、恒定或时间变化。这使得WRF能够模拟各种天气和气候条件，包括对流和非对流过程、降水、辐射和地表过程。</p>
<h3 id="WRF的参数化方案"><a href="#WRF的参数化方案" class="headerlink" title="WRF的参数化方案"></a>WRF的参数化方案</h3><p>WRF还包括多个物理参数化方案，使用户能够将未在计算域中明确解析的子网格过程纳入模拟。在WRF中使用的物理参数化取决于多种因素，如所模拟的物理进程类型、该进程的尺度以及数值模型的分辨率。这些参数化包括：</p>
<h4 id="微物理过程方案"><a href="#微物理过程方案" class="headerlink" title="微物理过程方案"></a>微物理过程方案</h4><p>微物理过程可以通过调整温湿场结构及过程中水汽相变潜热的释放、降水粒子的拖拽作用，影响积云对流发生的条件，进而影响积云降水的预报。因此，以积云降水为主要因素的研究中微物理过程方案的选择非常重要。</p>
<h4 id="积云对流方案"><a href="#积云对流方案" class="headerlink" title="积云对流方案"></a>积云对流方案</h4><p>积云对流过程在暴雨等强降水天气的模拟预报中比较重要。  </p>
<h4 id="陆面过程方案"><a href="#陆面过程方案" class="headerlink" title="陆面过程方案"></a>陆面过程方案</h4><p>中尺度模拟中需要考虑下垫面的非均匀性，且很难对复杂下垫面进行准确描述，即中尺度模式中能否将下垫面复杂性这一因素较为真实的加入到陆-气相互作用的物理过程中。</p>
<h4 id="行星边界层方案"><a href="#行星边界层方案" class="headerlink" title="行星边界层方案"></a>行星边界层方案</h4><p>行星边界层(PBL)是垂直网格尺度通量的发生地点，它在大气模式中的地位十分重要，不仅能影响低层大气要素，通过边界层的垂直输送也能对高层大气产生影响。</p>
<h4 id="大气辐射方案"><a href="#大气辐射方案" class="headerlink" title="大气辐射方案"></a>大气辐射方案</h4><p>大气辐射传输方案对于模式模拟非常重要，辐射传输计算的准确度将直接影响到大气热力和动力状况，所以提高辐射传输方案的精确性，能够显著提高模拟降水分布和季节变化特征的能力。</p>
<h3 id="WRF输入和输出数据"><a href="#WRF输入和输出数据" class="headerlink" title="WRF输入和输出数据"></a>WRF输入和输出数据</h3><p>  为初始化WRF模拟，用户必须提供初始条件来定义模型运行开始时的大气状态。这些初始条件可能包括大气压力、温度、湿度和风速和方向，以及地表条件，如土壤湿度和植被覆盖。WRF模型可以从各种来源获取数据，包括全球和区域再分析数据、卫星数据以及气象站和探空的观测数据。</p>
<p>  WRF还需要模型边界处的气象数据，称为边界条件，以保持模拟的大气状态和模型域之外的大气状态之间的一致性。这些数据通常从全球模型，如全球预报系统GFS或欧洲中期天气预报中心ECMWF获取。</p>
<p>  WRF模拟的输出数据可以采用许多形式，包括大气变量的格网化数据，例如空气温度、风速和风向以及降水，以及大气变量的垂直剖面。WRF输出可以保存在多种文件格式中，与其他建模和分析工具兼容，包括网络常用数据格式NetCDF和GRIB。</p>
<h3 id="WRF的应用"><a href="#WRF的应用" class="headerlink" title="WRF的应用"></a>WRF的应用</h3><p>  WRF广泛用于许多气象和大气研究应用，包括短期天气预测、季节性和气候预测以及空气质量和大气化学建模。它的高分辨率输出和灵活性使其成为中尺度气象研究、大气边界层过程和边界层相互作用分析以及城市气象研究的重要工具。</p>
<p>​    WRF被全球的操作预报中心和研究机构广泛使用，包括用于日常天气预报以及有关气候变化和环境政策的研究。它已用于广泛的研究，包括：</p>
<p>热带气象和飓风预测：WRF已广泛用于研究热带风暴和飓风，包括预测风暴强度和路径，估计降水和潜在风暴潮，以及分析气候变化对热带气旋的影响。</p>
<p>空气污染建模：WRF用于模拟大气化学输运，分析空气污染物的时间和空间模式，以及预测排放减少政策和其他干预措施对空气质量的影响。</p>
<p>可再生能源预测：WRF用于模拟风能和太阳能资源，并为可再生能源的功率输出开发概率预测。</p>
<p>气候变化和适应规划：WRF可以用于基于不同温室气体排放情景调查区域气候的响应。</p>
<h2 id="WRF-库的安装"><a href="#WRF-库的安装" class="headerlink" title="WRF 库的安装"></a>WRF 库的安装</h2><p>WRF安装之前需要安装编译器和库，本次安装选择的编译器和库的版本如下：</p>
<p><strong>Linux系统</strong>：CentOS 7</p>
<p><strong>编译器版本</strong>：gun(gcc-4.8.5)</p>
<p>注意：gfortran的版本最好不要高于7，因为fortran大于7的版本中iand函数的定义变了，可能会报intmath的错。</p>
<p><strong>库版本:</strong> mpich-3.0.4 | zlib-1.2.7 | libpng-1.2.50 | jasper-1.900.1 hdf5-1.10.5 | netcdf-c-4.8.1 | netcdf-cxx4-4.3.1 | openmpi-3.0.0 | netcdf-fortran-4.5.4</p>
<p>本文章所用的全部文件可后台回复<em><strong>WRF库的安装</strong></em>获取。</p>
<h3 id="环境测试"><a href="#环境测试" class="headerlink" title="环境测试"></a>环境测试</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">gfortran是Fortran 95 编译器，支持Fortran95和一部分Fortran2003的功能</span></span><br><span class="line">which gfortran</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出：/usr/bin/gcc</span></span><br><span class="line">which cpp</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出：/usr/bin/cpp</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">gcc是GCC中的GUN C Compiler（C 编译器）</span></span><br><span class="line">which gcc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出：/usr/bin/gcc</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看gcc版本</span></span><br><span class="line">gcc --version</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出：gcc (GCC) 4.8.5 20150623 (Red Hat 4.8.5-44)</span></span><br></pre></td></tr></table></figure>

<p>若环境测试未成功，则运行下列程序：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc</span><br><span class="line">yum install cpp gcc-c++</span><br><span class="line">yum install gcc-gfortran</span><br><span class="line">yum install unzip bzip2 time nfs-utils perl tcsh wget m4 mlocate.x86_64 libX11-devel.x86_64 libXext-devel.x86_64 libXrender-devel.x86_64 fontconfig-devel.x86_64 curl-devel cmake subversion</span><br></pre></td></tr></table></figure>



<h3 id="库文件的路径"><a href="#库文件的路径" class="headerlink" title="库文件的路径"></a>库文件的路径</h3><p>以往库文件的安装，都是安装一个库加入一个库的路径，然后手输安装下一个库，但这样不断输入路径过于麻烦，此处我们先建立库文件路径文件<em><strong>libraries.sh</strong></em>，然后把下面内容复制粘贴到库文件路径文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##-------此处路径需要根据自己修改--------</span></span></span><br><span class="line">export DIR=/home/daimu/Desktop/LIBRARIES</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##-------------------------------------</span></span></span><br><span class="line">export CC=gcc</span><br><span class="line">export CXX=g++</span><br><span class="line">export FC=gfortran</span><br><span class="line">export CFLAGS=-m64</span><br><span class="line">export F77=gfortran</span><br><span class="line">export FFLAGS=-m64</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##mpich</span></span></span><br><span class="line">export PATH=$DIR/mpich/bin:$PATH</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##zlib libpng jasper</span></span></span><br><span class="line">export LDFLAGS=-L$DIR/grib2/lib</span><br><span class="line">export CPPFLAGS=-I$DIR/grib2/include</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## zlib</span></span></span><br><span class="line">export LD_LIBRARY_PATH=$DIR/hdf5/lib:$LD_LIBRARY_PATH</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## hdf5</span></span></span><br><span class="line">export PATH=$DIR/hdf5/bin:$PATH</span><br><span class="line">export LD_LIBRARY_PATH=$DIR/hdf5/lib:$LD_LIBRARY_PATH</span><br><span class="line">export HDF5_HOME=$DIR/hdf5</span><br><span class="line">export HDF5_INCDIR=$HDF5_HOME/include</span><br><span class="line">export HDF5_LIBDIR=$HDF5_HOME/lib</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## netcdf</span></span></span><br><span class="line">export PATH=$DIR/netcdf/bin:$PATH</span><br><span class="line">export LD_LIBRARY_PATH=$DIR/netcdf/lib:$LD_LIBRARY_PATH</span><br><span class="line">export NETCDF=$DIR/netcdf</span><br><span class="line">export NETCDF_INC=$NETCDF/include</span><br><span class="line">export NETCDF_LIB=$NETCDF/lib</span><br><span class="line">export NETCDF_INCDIR=$NETCDF/include</span><br><span class="line">export NETCDF_LIBDIR=$NETCDF/lib</span><br><span class="line">export NETCDFPATH=$NETCDF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## openmpi</span></span></span><br><span class="line">MPI_HOME=$DIR/openmpi3.0.0</span><br><span class="line">export PATH=$&#123;MPI_HOME&#125;/bin:$PATH</span><br><span class="line">export LD_LIBRARY_PATH=$&#123;MPI_HOME&#125;/lib:$LD_LIBRARY_PATH</span><br><span class="line">export MANPATH=$&#123;MPI_HOME&#125;/share/man:$MANPATH</span><br></pre></td></tr></table></figure>



<h3 id="库文件的安装"><a href="#库文件的安装" class="headerlink" title="库文件的安装"></a>库文件的安装</h3><p><strong>方法一</strong>：将<em><strong>库文件</strong></em>和<em><strong>libraries.sh</strong></em>放到同一个文件夹下，打开终端，依次输入以下命令（此方法有点在于可以发现每一步运行的对错，可以及时纠正）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">source libraries.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mpich-3.0.4</span></span><br><span class="line">tar xzvf mpich-3.0.4.tar.gz</span><br><span class="line">cd mpich-3.0.4</span><br><span class="line">./configure --prefix=$DIR/mpich</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">cd ..</span><br><span class="line">rm -rf mpich-3.0.4</span><br><span class="line">source libraries.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">zlib-1.2.7</span></span><br><span class="line">tar xzvf zlib-1.2.7.tar.gz</span><br><span class="line">cd zlib-1.2.7</span><br><span class="line">./configure --prefix=$DIR/grib2</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">cd ..</span><br><span class="line">rm -rf zlib-1.2.7</span><br><span class="line">source libraries.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">libpng-1.2.50</span></span><br><span class="line">tar xzvf libpng-1.2.50.tar.gz</span><br><span class="line">cd libpng-1.2.50</span><br><span class="line">./configure --prefix=$DIR/grib2</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">cd ..</span><br><span class="line">rm -rf libpng-1.2.50</span><br><span class="line">source libraries.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">jasper-1.900.1</span></span><br><span class="line">tar xzvf jasper-1.900.1.tar.gz</span><br><span class="line">cd jasper-1.900.1</span><br><span class="line">./configure --prefix=$DIR/grib2</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">cd ..</span><br><span class="line">rm -rf jasper-1.900.1</span><br><span class="line">source libraries.sh</span><br><span class="line"></span><br><span class="line">tar xzvf zlib-1.2.7.tar.gz</span><br><span class="line">cd zlib-1.2.7</span><br><span class="line">./configure --prefix=$DIR/hdf5</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">cd ..</span><br><span class="line">rm -rf zlib-1.2.7</span><br><span class="line">source libraries.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hdf5-1.10.5</span></span><br><span class="line">tar xzvf hdf5-1.10.5.tar.gz</span><br><span class="line">cd hdf5-1.10.5/</span><br><span class="line">./configure --prefix=$DIR/hdf5 --with-zlib=$DIR/hdf5</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">cd ..</span><br><span class="line">rm -rf hdf5-1.10.5</span><br><span class="line">source libraries.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">netcdf-c-4.8.1</span></span><br><span class="line">unzip netcdf-c-4.8.1.zip</span><br><span class="line">cd netcdf-c-4.8.1/</span><br><span class="line">CPPFLAGS=&quot;-I$DIR/hdf5/include&quot; LDFLAGS=&quot;-L$DIR/hdf5/lib&quot; ./configure --prefix=$DIR/netcdf --enable-netcdf-4 --enable-netcdf4 --enable-shared --disable-dap</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">cd ..</span><br><span class="line">rm -rf netcdf-c-4.8.1</span><br><span class="line">source libraries.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">netcdf-fortran-4.5.4</span></span><br><span class="line">unzip netcdf-fortran-4.5.4.zip</span><br><span class="line">cd netcdf-fortran-4.5.4/</span><br><span class="line">CPPFLAGS=&quot;-I$DIR/netcdf/include&quot; LDFLAGS=&quot;-L$DIR/netcdf/lib&quot; ./configure --prefix=$DIR/netcdf</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">cd ..</span><br><span class="line">rm -rf netcdf-fortran-4.5.4</span><br><span class="line">source libraries.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">netcdf-cxx4-4.3.1</span></span><br><span class="line">unzip netcdf-cxx4-4.3.1.zip</span><br><span class="line">cd netcdf-cxx4-4.3.1/</span><br><span class="line">CPPFLAGS=&quot;-I$DIR/hdf5/include -I$DIR/netcdf/include&quot; LDFLAGS=&quot;-L$DIR/hdf5/lib -L$DIR/netcdf/lib&quot; ./configure --prefix=$DIR/netcdf</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">cd ..</span><br><span class="line">rm -rf netcdf-cxx4-4.3.1</span><br><span class="line">source libraries.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">openmpi-3.0.0</span></span><br><span class="line">tar xzvf openmpi-3.0.0.tar.tar</span><br><span class="line">cd openmpi-3.0.0</span><br><span class="line">./configure --prefix=$DIR/openmpi3.0.0</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">cd ..</span><br><span class="line">rm -rf openmpi-3.0.0</span><br><span class="line">source libraries.sh</span><br></pre></td></tr></table></figure>

<p><strong>方法二</strong>：将<em><strong>库文件</strong></em>和<em><strong>libraries.sh</strong></em>放到同一个文件夹下，然后创建文件</p>
<p><em><strong>libararies_pack.sh</strong></em>，将上面的代码复制粘贴到该文件，然后终端输入（此方法优点在于方便快捷，但不容易发现内部错误）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source libararies_pack.sh</span><br></pre></td></tr></table></figure>

<p>&#x2F; To Continue &#x2F;</p>
<p><strong>库安装完成后，可参考官方网站</strong> <strong>Compiling WRF (ucar.edu)</strong> <strong>进行库安装测试。</strong></p>
<h2 id="WRF的安装"><a href="#WRF的安装" class="headerlink" title="WRF的安装"></a>WRF的安装</h2><p>上一篇文章中，我们对编译WRF需要的库进行了安装编译，这次我们就开始正式编译WRF。<br><strong>WRF版本</strong>：WRF4.0  WPS4.0</p>
<h3 id="环境加载"><a href="#环境加载" class="headerlink" title="环境加载"></a>环境加载</h3><p>此处需要用到上文创建的libraries.sh文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source libraries.sh</span><br></pre></td></tr></table></figure>

<p>此处的需要注意的是路径的设置，上面的命令表示和libraries.sh文件在同一文件夹下，如果不在，则类似命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /home/usr/libraries.sh</span><br></pre></td></tr></table></figure>

<h3 id="WRF的编译"><a href="#WRF的编译" class="headerlink" title="WRF的编译"></a>WRF的编译</h3><p>命令位置：WRF压缩包所在文件夹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译WRF</span></span><br><span class="line">tar xzvf WRFV4.0.TAR.gz</span><br><span class="line">cd WRF</span><br><span class="line">./configure</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这里我是在集群计算机上安装所以选的34，在这里需要注意的是编译器和是否多线程</span></span><br><span class="line">34</span><br><span class="line">1</span><br><span class="line">./compile em_real &gt;&amp; log.compile</span><br><span class="line">ls -ls main/*.exe</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">出现4个exe安装成功</span></span><br></pre></td></tr></table></figure>

<h3 id="WPS的编译"><a href="#WPS的编译" class="headerlink" title="WPS的编译"></a>WPS的编译</h3><p>命令位置：WPS压缩包所在文件夹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译WPS</span></span><br><span class="line">tar xzvf WPSV4.0.TAR.gz</span><br><span class="line">./configure</span><br><span class="line">1 # 和编译WRF一致</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注意 configure，wps 的 COMPRESSION_LIBS 和 COMPRESSION_INC的路径是否正确，不正确需修改</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">详情看下方的注意事项</span></span><br><span class="line">./compile &gt;&amp; log.compile</span><br><span class="line">ls -ls *.exe</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">出现3个exe即为成功</span></span><br></pre></td></tr></table></figure>

<p>注意事项：<br>WPS使用configure命令后，会出现configure.wps文件，使用compile命令之前，图片内容须保持一致，路径libraries.sh文件中grib2文件夹路径。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">configure.wps  Line:68</span></span><br><span class="line">COMPRESSION_LIBS    = -L/home/daimu/Desktop/LIBRARIES/grib2/lib -ljasper -lpng -lz</span><br><span class="line">COMPRESSION_INC     = -I/home/daimu/Desktop/LIBRARIES/grib2/include</span><br><span class="line">FDEFS               = -DUSE_JPEG2000 -DUSE_PNG</span><br><span class="line">SFC                 = gfortran</span><br><span class="line">SCC                 = gcc</span><br><span class="line">DM_FC               = mpif90</span><br><span class="line">DM_CC               = mpicc</span><br><span class="line">FC                  = $(DM_FC) </span><br><span class="line">CC                  = $(DM_CC)</span><br><span class="line">LD                  = $(FC)</span><br></pre></td></tr></table></figure>



<h2 id="WRF-3DVar的安装"><a href="#WRF-3DVar的安装" class="headerlink" title="WRF 3DVar的安装"></a>WRF 3DVar的安装</h2><p>WRF的同化方法包括三维同化(3DVAR)和四维同化(4DVAR)，选择不同的方法取决于问题的性质和需求，相比较而言，四维同化对服务器性能比三维同化有着更高的要求，本文章我们对3DVAR的编译和安装进行简单介绍。</p>
<p>在WRF4.0版本中，WRFDA被放进了WRF文件夹中，所用的库文件和编译器可参考<a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzI2NTk2MzU3NA==&mid=2247484087&idx=1&sn=696b2cdb78e45fdc71e78ef0503dc6d2&chksm=ea9413eedde39af8124d2c6970a4024a62d5c62ff62354b77a934a8eeded2db3cbee072f224f&scene=21#wechat_redirect">WRF | WRF库的安装</a>，编译WRFDA只需要把WRF源文件文件解压缩，并重命名为WRFDA，然后编译安装即可。</p>
<p>WRF源文件可后台回复WRF源文件获取。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd WRFDA</span><br><span class="line">./configure wrfda</span><br><span class="line">34 # 与WRF的安装中选择相同</span><br><span class="line">./compile all_wrfvar &gt;&amp; compile.out</span><br><span class="line">ls -l var/build/*exe var/obsproc/src/obsproc.exe</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生成4个.exe文件表示成功```</span></span><br></pre></td></tr></table></figure>



<h2 id="WRF的运行"><a href="#WRF的运行" class="headerlink" title="WRF的运行"></a>WRF的运行</h2><p><img src="https://p.ipic.vip/f81f9z.png" alt="Image">WRF运行流程</p>
<h3 id="数据准备"><a href="#数据准备" class="headerlink" title="数据准备"></a>数据准备</h3><p>WRF模式的运行，所需要的数据主要有两种：静态地形数据和网格化气象数据。</p>
<h4 id="1-1-静态地形数据"><a href="#1-1-静态地形数据" class="headerlink" title="1.1 静态地形数据"></a>1.1 静态地形数据</h4><p>静态地形数据可在WRF官方网站下载，或是后台回复<strong>WRF地形数据</strong>获取。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www2.mmm.ucar.edu/wrf/users/download/get_sources_wps_geog.html">https://www2.mmm.ucar.edu/wrf/users/download/get_sources_wps_geog.html</a></p>
</blockquote>
<h4 id="1-2-网格化气象数据"><a href="#1-2-网格化气象数据" class="headerlink" title="1.2 网格化气象数据"></a>1.2 网格化气象数据</h4><p>（1）网格化气象数据经常用的是FNL数据，FNL数据可在官方网站（需要注册）下载，或后台回复<strong>WRF_fnl</strong>使用python脚本下载。*(<strong>注意</strong>：由于官方网站python脚本更新较快，如python下载不成功，请移至官网手动下载，或联系作者更新)*</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://rda.ucar.edu/datasets/ds083.2/">https://rda.ucar.edu/datasets/ds083.2/</a></p>
</blockquote>
<p>（2）由于所选用网格化气象数据格式的不同，ungrib程序需要相对应的变量表解译。由于我们选用的是FNL数据，因此一般用的是Vtable.GFS，该文件在WPS文件夹里，路径为：WPS&#x2F;ungrib&#x2F;Variable_Tables&#x2F;，复制该文件到WPS文件下并改名为Vtable。</p>
<h3 id="WRF运行"><a href="#WRF运行" class="headerlink" title="WRF运行"></a>WRF运行</h3><p>运行之前需要更改两份文件的内容，一个是namelist.wps，另一个是namelist.input。主要是对时间，区域，网格以及参数化方案等内容的修改。<br>（1）namelist.wps 位于WPS&#x2F;namelist.wps，详细信息可参考namelist.wps介绍。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www2.mmm.ucar.edu/wrf/users/namelist_best_prac_wps.html">https://www2.mmm.ucar.edu/wrf/users/namelist_best_prac_wps.html</a></p>
</blockquote>
<p>（2）namelist.input位于WRF&#x2F;test&#x2F;em_real&#x2F;namelist.input，详细信息可参考namelist.input介绍。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www2.mmm.ucar.edu/wrf/users/namelist_best_prac_wrf.html">https://www2.mmm.ucar.edu/wrf/users/namelist_best_prac_wrf.html</a></p>
</blockquote>
<h4 id="WPS运行"><a href="#WPS运行" class="headerlink" title="WPS运行"></a>WPS运行</h4><p><strong>WPS和WRF文件夹应该在同一级目录下</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cd WPS</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入作业目录</span></span><br><span class="line">./geogrid.exe</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">定义模拟域，并将各种地面数据集插入模型网格</span></span><br><span class="line">./link_grib.csh path_to_data</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">链接FNL数据 例如：./link_grib.csh /home/FNL/*</span></span><br><span class="line">./ungrib.exe</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">读取 GRIB 文件，“degribs”数据，并以称为中间格式的简单格式写入数据</span></span><br><span class="line">./metgrid.exe</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将 ungrib 程序提取的中间格式气象数据水平插值到 geogrid 程序定义的模拟域中</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-WRF运行"><a href="#2-2-WRF运行" class="headerlink" title="2.2 WRF运行"></a>2.2 WRF运行</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd ../WRF/test/em_real</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入作业目录</span></span><br><span class="line">ln -sf ../../../WPS/met_em.d* .</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">链接WPS处理的文件</span></span><br><span class="line">./real.exe</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">产生初始场文件和边界场文件</span></span><br><span class="line">./wrf.exe</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注意：这里使用的是单核运行，如有需要可多核多线程</span></span><br></pre></td></tr></table></figure>



<h2 id="WRFDA的运行"><a href="#WRFDA的运行" class="headerlink" title="WRFDA的运行"></a>WRFDA的运行</h2><p> <a href="javascript:void(0);">沐室</a> <em>2023-07-10 22:07</em> <em>Posted on 江苏</em></p>
<p><img src="https://p.ipic.vip/uxc9es.png" alt="Image">WRFDA运行流程</p>
<h3 id="运行准备"><a href="#运行准备" class="headerlink" title="运行准备"></a>运行准备</h3><p>（1）区分<strong>冷启动</strong>和<strong>暖启动</strong>：通俗的来讲，冷启动指的是不使用上一次模式跑出的数据；暖启动指的是使用上一次模式跑出的数据。<br>（2）区分各变量含义：</p>
<p><img src="https://p.ipic.vip/oc4t0m.png" alt="Image"><img src="https://p.ipic.vip/slh6zj.png" alt="Image"></p>
<h3 id="具体步骤分解"><a href="#具体步骤分解" class="headerlink" title="具体步骤分解"></a>具体步骤分解</h3><h4 id="2-1-背景误差协方差矩阵B0"><a href="#2-1-背景误差协方差矩阵B0" class="headerlink" title="2.1 背景误差协方差矩阵B0"></a>2.1 背景误差协方差矩阵B0</h4><p><strong>简单介绍：</strong>背景误差协方差矩阵算的是模式跑的同一个时间点所用不同时间的误差，举个例子就是从0点跑到24点和从12点跑到24点的误差。<br><strong>代码位置</strong>：WRFDA&#x2F;var&#x2F;scripts&#x2F;gen_be&#x2F;gen_be_wrapper.ksh<br><strong>使用方法：</strong>gen_be 的输入数据是 WRF 预测，用于生成模型扰动，用作预测误差估计的代理。对于 NMC 方法，模型扰动是同时有效的预测之间的差异（例如，T+24 减去 T+12 是区域应用的典型值，T+48 减去 T+24 是全球应用的典型值）。然后可以通过对一段时间（例如一个月）内的这些预报差异进行平均来获得背景误差的气候估计。给定来自集合预测系统 (EPS) 的输入，输入是集合预报，创建的模型扰动是转换后的集合扰动。gen_be 代码旨在处理预测差异或基于集合的扰动。<br><strong>运行结果示例：</strong>注意文件名以及文件所在的文件夹名</p>
<p><img src="https://p.ipic.vip/01pvfo.png" alt="Image"></p>
<h4 id="观测数据文件y0，R"><a href="#观测数据文件y0，R" class="headerlink" title="观测数据文件y0，R"></a>观测数据文件y0，R</h4><p><strong>简单介绍：</strong>主要是为了生成同化可用的观测数据文件，处理为ASCII 或PREPBUFR 格式。外来的观测数据需要改写成LITTLE_R格式，由于本次示例是从下面网站获得。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www2.mmm.ucar.edu/wrf/users/wrfda/download/free_data.html">https://www2.mmm.ucar.edu/wrf/users/wrfda/download/free_data.html</a></p>
</blockquote>
<p><strong>代码和程序位置：</strong>WRFDA&#x2F;var&#x2F;obsproc&#x2F;obserr.txt        WRFDA&#x2F;var&#x2F;obsproc&#x2F;obsproc.exe<br>WRFDA&#x2F;var&#x2F;obsproc&#x2F;prepbufr_table_filename（当OUTPUT_OB_FORMAT&#x3D;1或3时需要链接）</p>
<h3 id="运行流程"><a href="#运行流程" class="headerlink" title="运行流程"></a>运行流程</h3><p>背景误差协方差矩阵B0可在运行同化之前先生成背景误差协方差文件，同化时直接使用。</p>
<h4 id="冷启动"><a href="#冷启动" class="headerlink" title="冷启动"></a>冷启动</h4><p><strong>流程：</strong>WRF-real—-obsproc—更新初始场—更新边界场—WRF-wrf<br><strong>示例脚本：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">DATE=2011092800</span><br><span class="line">RUN_TYPE=cycle #coldorcycle</span><br><span class="line">DOMAIN_ID=01</span><br><span class="line">NPROC=6</span><br><span class="line">DATDIR=/home//WRF/Data</span><br><span class="line">run_dir=/home/WRF/Project/</span><br><span class="line">DA_SRCDIR=/home/WRF/WRF4.0v2/WRFDA</span><br><span class="line">project_name=test_WRF</span><br><span class="line">TIMEWINDOW1=-1h30m</span><br><span class="line">TIMEWINDOW2=1h30m</span><br><span class="line">CYCLE_PERIOD=06</span><br><span class="line">lon_e=105</span><br><span class="line">lon_w=125</span><br><span class="line">lat_n=24</span><br><span class="line">lat_s=12</span><br><span class="line">VERTICAL_GRID_NUMBER=33</span><br><span class="line">GRID_DISTANCE=9000</span><br><span class="line"></span><br><span class="line">WRFDIR=$&#123;run_dir&#125;$&#123;project_name&#125;/WRF</span><br><span class="line">RUN_BASEDIR=$&#123;run_dir&#125;$&#123;project_name&#125;/run</span><br><span class="line">BIN_DIR=$&#123;DA_SRCDIR&#125;/var/build</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">WEST_EAST_GRID_NUMBER=$[(lon_w-lon_e)*111000/GRID_DISTANCE+10]</span><br><span class="line">SOUTH_NORTH_GRID_NUMBER=$[(lat_n-lat_s)*111000/GRID_DISTANCE+10]</span><br><span class="line">lat_ns=$[(lat_n+lat_s)/2]</span><br><span class="line">lon_we=$[(lon_w+lon_e)/2]</span><br><span class="line"></span><br><span class="line">DATE_MIN=$($&#123;BIN_DIR&#125;/da_advance_time.exe $&#123;DATE&#125; $&#123;TIMEWINDOW1&#125; -w)</span><br><span class="line">DATE_MAX=$($&#123;BIN_DIR&#125;/da_advance_time.exe $&#123;DATE&#125; $&#123;TIMEWINDOW2&#125; -w)</span><br><span class="line">PREV_DATE=$($&#123;BIN_DIR&#125;/da_advance_time.exe $&#123;DATE&#125; -$&#123;CYCLE_PERIOD&#125;)</span><br><span class="line">VARBC_PREV_DATE=$($&#123;BIN_DIR&#125;/da_advance_time.exe $&#123;DATE&#125; -24)</span><br><span class="line"></span><br><span class="line">if [ ! -d &quot;$&#123;RUN_BASEDIR&#125;&quot; ];then</span><br><span class="line">  mkdir $&#123;RUN_BASEDIR&#125;</span><br><span class="line">else</span><br><span class="line">  rm -rf $&#123;RUN_BASEDIR&#125;</span><br><span class="line">  mkdir $&#123;RUN_BASEDIR&#125;</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">cd $&#123;DA_SRCDIR&#125;</span><br><span class="line">source ../libraries.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">-----------------------------------------------------------ob-------------------------------------------</span></span><br><span class="line">echo &quot;处理观测数据ob&quot;</span><br><span class="line">mkdir $&#123;RUN_BASEDIR&#125;/ob</span><br><span class="line">cd $&#123;RUN_BASEDIR&#125;/ob</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">-----链接一些必要的文件</span></span><br><span class="line">cp $&#123;DATDIR&#125;/&#x27;OBS_&#x27;$&#123;DATE&#125; ./</span><br><span class="line"></span><br><span class="line">ln -fs $&#123;DA_SRCDIR&#125;/var/obsproc/obserr.txt ./obserr.txt</span><br><span class="line"></span><br><span class="line">ln -fs $&#123;DA_SRCDIR&#125;/var/obsproc/prepbufr_table_filename ./prepbufr_table_filename</span><br><span class="line"></span><br><span class="line">ln -fs $&#123;DA_SRCDIR&#125;/var/obsproc/obsproc.exe .</span><br><span class="line"></span><br><span class="line">touch namelist.obsproc</span><br><span class="line">cat &gt; namelist.obsproc &lt;&lt; EOF</span><br><span class="line">&amp;record1</span><br><span class="line"> obs_gts_filename = &#x27;OBS_$&#123;DATE&#125;&#x27;,</span><br><span class="line"> obs_err_filename = &#x27;obserr.txt&#x27;,</span><br><span class="line"> gts_from_mmm_archive = .true.,</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;record2</span><br><span class="line"> time_window_min  = $&#123;DATE_MIN&#125;,</span><br><span class="line"> time_analysis    = $&#123;DATE:0:4&#125;-$&#123;DATE:4:2&#125;-$&#123;DATE:6:2&#125;_$&#123;DATE:8:2&#125;:00:00,</span><br><span class="line"> time_window_max  = $&#123;DATE_MAX&#125;,</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;record3</span><br><span class="line"> max_number_of_obs        = 400000,</span><br><span class="line"> fatal_if_exceed_max_obs  = .TRUE.,</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;record4</span><br><span class="line"> qc_test_vert_consistency = .TRUE.,</span><br><span class="line"> qc_test_convective_adj   = .TRUE.,</span><br><span class="line"> qc_test_above_lid        = .TRUE.,</span><br><span class="line"> remove_above_lid         = .false.,</span><br><span class="line"> domain_check_h           = .true.,</span><br><span class="line"> Thining_SATOB            = .false.,</span><br><span class="line"> Thining_SSMI             = .false.,</span><br><span class="line"> Thining_QSCAT            = .false.,</span><br><span class="line"> calc_psfc_from_qnh       = .true.,</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;record5</span><br><span class="line"> print_gts_read           = .TRUE.,</span><br><span class="line"> print_gpspw_read         = .TRUE.,</span><br><span class="line"> print_recoverp           = .TRUE.,</span><br><span class="line"> print_duplicate_loc      = .TRUE.,</span><br><span class="line"> print_duplicate_time     = .TRUE.,</span><br><span class="line"> print_recoverh           = .TRUE.,</span><br><span class="line"> print_qc_vert            = .TRUE.,</span><br><span class="line"> print_qc_conv            = .TRUE.,</span><br><span class="line"> print_qc_lid             = .TRUE.,</span><br><span class="line"> print_uncomplete         = .TRUE.,</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;record6</span><br><span class="line"> ptop =  1000.0,</span><br><span class="line"> base_pres       = 100000.0,</span><br><span class="line"> base_temp       = 290.0,</span><br><span class="line"> base_lapse      = 50.0,</span><br><span class="line"> base_strat_temp = 215.0,</span><br><span class="line"> base_tropo_pres = 20000.0</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;record7</span><br><span class="line"> IPROJ = 1,</span><br><span class="line"> PHIC  = $&#123;lat_ns&#125;,</span><br><span class="line"> XLONC = $&#123;lon_we&#125;,</span><br><span class="line"> TRUELAT1= $&#123;lat_s&#125;,</span><br><span class="line"> TRUELAT2= $&#123;lat_n&#125;,</span><br><span class="line"> MOAD_CEN_LAT = $&#123;lat_ns&#125;,</span><br><span class="line"> STANDARD_LON = $&#123;lon_we&#125;,</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;record8</span><br><span class="line"> IDD    =   1,</span><br><span class="line"> MAXNES =   1,</span><br><span class="line"> NESTIX =  256,  200,  136,  181,  211,</span><br><span class="line"> NESTJX =  158,  200,  181,  196,  211,</span><br><span class="line"> DIS    =  9,  10.,  3.3,  1.1,  1.1,</span><br><span class="line"> NUMC   =    1,    1,   2,     3,    4,</span><br><span class="line"> NESTI  =    1,   40,  28,    35,   45,</span><br><span class="line"> NESTJ  =    1,   60,  25,    65,   55,</span><br><span class="line"> / </span><br><span class="line"></span><br><span class="line">&amp;record9</span><br><span class="line"> PREPBUFR_OUTPUT_FILENAME = &#x27;prepbufr_output&#x27;,</span><br><span class="line"> PREPBUFR_TABLE_FILENAME = &#x27;prepbufr_table_filename&#x27;,</span><br><span class="line"> OUTPUT_OB_FORMAT = 3</span><br><span class="line"> use_for          = &#x27;3DVAR&#x27;,</span><br><span class="line"> num_slots_past   = 3,</span><br><span class="line"> num_slots_ahead  = 3,</span><br><span class="line"> write_synop = .true., </span><br><span class="line"> write_ship  = .true.,</span><br><span class="line"> write_metar = .true.,</span><br><span class="line"> write_buoy  = .true., </span><br><span class="line"> write_pilot = .true.,</span><br><span class="line"> write_sound = .true.,</span><br><span class="line"> write_amdar = .true.,</span><br><span class="line"> write_satem = .true.,</span><br><span class="line"> write_satob = .true.,</span><br><span class="line"> write_airep = .true.,</span><br><span class="line"> write_gpspw = .true.,</span><br><span class="line"> write_gpsztd= .true.,</span><br><span class="line"> write_gpsref= .true.,</span><br><span class="line"> write_gpseph= .true.,</span><br><span class="line"> write_ssmt1 = .true.,</span><br><span class="line"> write_ssmt2 = .true.,</span><br><span class="line"> write_ssmi  = .true.,</span><br><span class="line"> write_tovs  = .true.,</span><br><span class="line"> write_qscat = .true.,</span><br><span class="line"> write_profl = .true.,</span><br><span class="line"> write_bogus = .true.,</span><br><span class="line"> write_airs  = .true.,</span><br><span class="line"> /</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">./obsproc.exe</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">-----------------------------------------------------ini-----------------------------------------</span></span><br><span class="line">echo &quot;更新初始场&quot;</span><br><span class="line">rm -rf $&#123;RUN_BASEDIR&#125;/ini</span><br><span class="line">mkdir $&#123;RUN_BASEDIR&#125;/ini</span><br><span class="line">cd $&#123;RUN_BASEDIR&#125;/ini</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">-----链接一些必要的文件</span></span><br><span class="line">ln -fs $&#123;DA_SRCDIR&#125;/run/LANDUSE.TBL ./LANDUSE.TBL</span><br><span class="line"></span><br><span class="line">ln -fs $&#123;RUN_BASEDIR&#125;/ob/obs_gts_$&#123;DATE:0:4&#125;-$&#123;DATE:4:2&#125;-$&#123;DATE:6:2&#125;_$&#123;DATE:8:2&#125;:00:00.3DVAR ./ob.ascii</span><br><span class="line"></span><br><span class="line">ln -fs $&#123;DATDIR&#125;/be.dat ./be.dat</span><br><span class="line"></span><br><span class="line">cp -p $&#123;WRFDIR&#125;/wrfinput_d01 ./fg</span><br><span class="line"></span><br><span class="line">touch namelist.input</span><br><span class="line">cat &gt; namelist.input &lt;&lt; EOF</span><br><span class="line">&amp;wrfvar1</span><br><span class="line">var4d=false,</span><br><span class="line">print_detail_grad=false,</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar2</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar3</span><br><span class="line">ob_format=2,</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar4</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar5</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar6</span><br><span class="line">max_ext_its=1,</span><br><span class="line">ntmax=50,</span><br><span class="line">orthonorm_gradient=true,</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar7</span><br><span class="line">cv_options=5,</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar8</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar9</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar10</span><br><span class="line">test_transforms=false,</span><br><span class="line">test_gradient=false,</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar11</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar12</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar13</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar14</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar15</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar16</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar17</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar18</span><br><span class="line">analysis_date=$&#123;DATE:0:4&#125;-$&#123;DATE:4:2&#125;-$&#123;DATE:6:2&#125;_$&#123;DATE:8:2&#125;:00:00,</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar19</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar20</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar21</span><br><span class="line">time_window_min=$&#123;DATE_MIN&#125;,</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar22</span><br><span class="line">time_window_max=$&#123;DATE_MAX&#125;,</span><br><span class="line">/</span><br><span class="line">&amp;time_control</span><br><span class="line">start_year=$&#123;DATE:0:4&#125;,</span><br><span class="line">start_month=$&#123;DATE:4:2&#125;,</span><br><span class="line">start_day=$&#123;DATE:6:2&#125;,</span><br><span class="line">start_hour=$&#123;DATE:8:2&#125;,</span><br><span class="line">end_year=$&#123;DATE:0:4&#125;,</span><br><span class="line">end_month=$&#123;DATE:4:2&#125;,</span><br><span class="line">end_day=$&#123;DATE:6:2&#125;,</span><br><span class="line">end_hour=$&#123;DATE:8:2&#125;,</span><br><span class="line">/</span><br><span class="line">&amp;fdda</span><br><span class="line">/</span><br><span class="line">&amp;domains</span><br><span class="line">e_we=$&#123;WEST_EAST_GRID_NUMBER&#125;,</span><br><span class="line">e_sn=$&#123;SOUTH_NORTH_GRID_NUMBER&#125;,</span><br><span class="line">e_vert=$&#123;VERTICAL_GRID_NUMBER&#125;,</span><br><span class="line">dx=$&#123;GRID_DISTANCE&#125;,</span><br><span class="line">dy=$&#123;GRID_DISTANCE&#125;,</span><br><span class="line">/</span><br><span class="line">&amp;dfi_control</span><br><span class="line">/</span><br><span class="line">&amp;tc</span><br><span class="line">/</span><br><span class="line">&amp;physics</span><br><span class="line"> mp_physics                          = 3,     </span><br><span class="line"> ra_lw_physics                       = 1,     </span><br><span class="line"> ra_sw_physics                       = 1,     </span><br><span class="line"> radt                                = 30,    </span><br><span class="line"> sf_sfclay_physics                   = 1,     </span><br><span class="line"> sf_surface_physics                  = 2,    </span><br><span class="line"> bl_pbl_physics                      = 1,    </span><br><span class="line"> bldt                                = 0,    </span><br><span class="line"> cu_physics                          = 1,     </span><br><span class="line"> cudt                                = 5,     </span><br><span class="line"> isfflx                              = 1,</span><br><span class="line"> ifsnow                              = 1,</span><br><span class="line"> icloud                              = 1,</span><br><span class="line"> surface_input_source                = 1,</span><br><span class="line"> num_soil_layers                     = 4,</span><br><span class="line"> sf_urban_physics                    = 0,    </span><br><span class="line">/</span><br><span class="line">&amp;scm</span><br><span class="line">/</span><br><span class="line">&amp;dynamics</span><br><span class="line">/</span><br><span class="line">&amp;bdy_control</span><br><span class="line">/</span><br><span class="line">&amp;grib2</span><br><span class="line">/</span><br><span class="line">&amp;fire</span><br><span class="line">/</span><br><span class="line">&amp;namelist_quilt</span><br><span class="line">/</span><br><span class="line">&amp;perturbation</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">ln -sf $&#123;DA_SRCDIR&#125;/var/build/da_wrfvar.exe ./da_wrfvar.exe</span><br><span class="line">mpirun -np 6 ./da_wrfvar.exe</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">-----------------------------------------------------bdy-----------------------------------------</span></span><br><span class="line">echo &quot;更新边界场&quot;</span><br><span class="line"></span><br><span class="line">mkdir $&#123;RUN_BASEDIR&#125;/bdy</span><br><span class="line">cd $&#123;RUN_BASEDIR&#125;/bdy</span><br><span class="line"></span><br><span class="line">cp $&#123;WRFDIR&#125;/wrfbdy_d01 ./wrfbdy_d01</span><br><span class="line"></span><br><span class="line">touch parame.in</span><br><span class="line">cat &gt; parame.in &lt;&lt; EOF</span><br><span class="line">&amp;control_param</span><br><span class="line">da_file            = &#x27;$&#123;RUN_BASEDIR&#125;/ini/wrfvar_output&#x27;,</span><br><span class="line">wrf_bdy_file       = &#x27;./wrfbdy_d01&#x27;</span><br><span class="line">wrf_input          = &#x27;$&#123;WRFDIR&#125;/wrfinput_d01&#x27;,</span><br><span class="line">domain_id          = 1</span><br><span class="line">cycling = .false. </span><br><span class="line">debug   = .true.</span><br><span class="line">low_bdy_only = .false.             </span><br><span class="line">update_lsm = .true. </span><br><span class="line">var4d_lbc = .false.</span><br><span class="line">/</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">ln -sf $&#123;DA_SRCDIR&#125;/var/build/da_update_bc.exe ./da_update_bc.exe</span><br><span class="line">./da_update_bc.exe</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">----------------------------------------------------wrf-------------------------------------------</span></span><br><span class="line">cd $&#123;WRFDIR&#125;</span><br><span class="line">ln -fs $&#123;RUN_BASEDIR&#125;/bdy/wrfbdy_d01    ./wrfbdy_d01</span><br><span class="line">ln -fs $&#123;RUN_BASEDIR&#125;/ini/wrfvar_output ./wrfinput_d01</span><br><span class="line">mpirun -np 20 ./wrf.exe</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">---------------------------------------------------result-----------------------------------------</span></span><br><span class="line">mkdir $&#123;run_dir&#125;/result</span><br><span class="line">cd $&#123;run_dir&#125;/result</span><br><span class="line">cp $&#123;WRFDIR&#125;/wrfout* ./</span><br><span class="line">cd $&#123;run_dir&#125;</span><br></pre></td></tr></table></figure>



<h4 id="3-2-热启动"><a href="#3-2-热启动" class="headerlink" title="3.2 热启动"></a>3.2 热启动</h4><p><strong>流程：</strong>WRF-wrf—-obsproc—更新底边界—更新初始场—更新边界场—WRF-wrf<br><strong>示例脚本</strong>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">DATE=2011092806</span><br><span class="line">RUN_TYPE=cycle </span><br><span class="line">DOMAIN_ID=01</span><br><span class="line">NPROC=6</span><br><span class="line">DATDIR=/home/WRF/Data</span><br><span class="line">run_dir=/home/WRF/Project/</span><br><span class="line">DA_SRCDIR=/home/WRF/WRF4.0v2/WRFDA</span><br><span class="line">project_name=test_WRF</span><br><span class="line">TIMEWINDOW1=-1h30m</span><br><span class="line">TIMEWINDOW2=1h30m</span><br><span class="line">CYCLE_PERIOD=06</span><br><span class="line">lon_e=105</span><br><span class="line">lon_w=125</span><br><span class="line">lat_n=24</span><br><span class="line">lat_s=12</span><br><span class="line">VERTICAL_GRID_NUMBER=33</span><br><span class="line">GRID_DISTANCE=9000</span><br><span class="line"></span><br><span class="line">WRFDIR=$&#123;run_dir&#125;$&#123;project_name&#125;/WRF</span><br><span class="line">RUN_BASEDIR=$&#123;run_dir&#125;$&#123;project_name&#125;/run</span><br><span class="line">BIN_DIR=$&#123;DA_SRCDIR&#125;/var/build</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">WEST_EAST_GRID_NUMBER=$[(lon_w-lon_e)*111000/GRID_DISTANCE+10]</span><br><span class="line">SOUTH_NORTH_GRID_NUMBER=$[(lat_n-lat_s)*111000/GRID_DISTANCE+10]</span><br><span class="line">lat_ns=$[(lat_n+lat_s)/2]</span><br><span class="line">lon_we=$[(lon_w+lon_e)/2]</span><br><span class="line"></span><br><span class="line">DATE_MIN=$($&#123;BIN_DIR&#125;/da_advance_time.exe $&#123;DATE&#125; $&#123;TIMEWINDOW1&#125; -w)</span><br><span class="line">DATE_MAX=$($&#123;BIN_DIR&#125;/da_advance_time.exe $&#123;DATE&#125; $&#123;TIMEWINDOW2&#125; -w)</span><br><span class="line">PREV_DATE=$($&#123;BIN_DIR&#125;/da_advance_time.exe $&#123;DATE&#125; -$&#123;CYCLE_PERIOD&#125;)</span><br><span class="line">VARBC_PREV_DATE=$($&#123;BIN_DIR&#125;/da_advance_time.exe $&#123;DATE&#125; -24)</span><br><span class="line"></span><br><span class="line">if [ ! -d &quot;$&#123;RUN_BASEDIR&#125;&quot; ];then</span><br><span class="line">  mkdir $&#123;RUN_BASEDIR&#125;</span><br><span class="line">else</span><br><span class="line">  rm -rf $&#123;RUN_BASEDIR&#125;</span><br><span class="line">  mkdir $&#123;RUN_BASEDIR&#125;</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">cd $&#123;DA_SRCDIR&#125;</span><br><span class="line">source ../libraries.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">-----------------------------------------------------------ob-------------------------------------------</span></span><br><span class="line">echo &quot;处理观测数据ob&quot;</span><br><span class="line">mkdir $&#123;RUN_BASEDIR&#125;/ob</span><br><span class="line">cd $&#123;RUN_BASEDIR&#125;/ob</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">-----链接一些必要的文件</span></span><br><span class="line">cp $&#123;DATDIR&#125;/&#x27;OBS_&#x27;$&#123;DATE&#125; ./</span><br><span class="line"></span><br><span class="line">ln -fs $&#123;DA_SRCDIR&#125;/var/obsproc/obserr.txt ./obserr.txt</span><br><span class="line"></span><br><span class="line">ln -fs $&#123;DA_SRCDIR&#125;/var/obsproc/prepbufr_table_filename ./prepbufr_table_filename</span><br><span class="line"></span><br><span class="line">ln -fs $&#123;DA_SRCDIR&#125;/var/obsproc/obsproc.exe .</span><br><span class="line"></span><br><span class="line">touch namelist.obsproc</span><br><span class="line">cat &gt; namelist.obsproc &lt;&lt; EOF</span><br><span class="line">&amp;record1</span><br><span class="line"> obs_gts_filename = &#x27;OBS_$&#123;DATE&#125;&#x27;,</span><br><span class="line"> obs_err_filename = &#x27;obserr.txt&#x27;,</span><br><span class="line"> gts_from_mmm_archive = .true.,</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;record2</span><br><span class="line"> time_window_min  = $&#123;DATE_MIN&#125;,</span><br><span class="line"> time_analysis    = $&#123;DATE:0:4&#125;-$&#123;DATE:4:2&#125;-$&#123;DATE:6:2&#125;_$&#123;DATE:8:2&#125;:00:00,</span><br><span class="line"> time_window_max  = $&#123;DATE_MAX&#125;,</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;record3</span><br><span class="line"> max_number_of_obs        = 400000,</span><br><span class="line"> fatal_if_exceed_max_obs  = .TRUE.,</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;record4</span><br><span class="line"> qc_test_vert_consistency = .TRUE.,</span><br><span class="line"> qc_test_convective_adj   = .TRUE.,</span><br><span class="line"> qc_test_above_lid        = .TRUE.,</span><br><span class="line"> remove_above_lid         = .false.,</span><br><span class="line"> domain_check_h           = .true.,</span><br><span class="line"> Thining_SATOB            = .false.,</span><br><span class="line"> Thining_SSMI             = .false.,</span><br><span class="line"> Thining_QSCAT            = .false.,</span><br><span class="line"> calc_psfc_from_qnh       = .true.,</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;record5</span><br><span class="line"> print_gts_read           = .TRUE.,</span><br><span class="line"> print_gpspw_read         = .TRUE.,</span><br><span class="line"> print_recoverp           = .TRUE.,</span><br><span class="line"> print_duplicate_loc      = .TRUE.,</span><br><span class="line"> print_duplicate_time     = .TRUE.,</span><br><span class="line"> print_recoverh           = .TRUE.,</span><br><span class="line"> print_qc_vert            = .TRUE.,</span><br><span class="line"> print_qc_conv            = .TRUE.,</span><br><span class="line"> print_qc_lid             = .TRUE.,</span><br><span class="line"> print_uncomplete         = .TRUE.,</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;record6</span><br><span class="line"> ptop =  1000.0,</span><br><span class="line"> base_pres       = 100000.0,</span><br><span class="line"> base_temp       = 290.0,</span><br><span class="line"> base_lapse      = 50.0,</span><br><span class="line"> base_strat_temp = 215.0,</span><br><span class="line"> base_tropo_pres = 20000.0</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;record7</span><br><span class="line"> IPROJ = 1,</span><br><span class="line"> PHIC  = $&#123;lat_ns&#125;,</span><br><span class="line"> XLONC = $&#123;lon_we&#125;,</span><br><span class="line"> TRUELAT1= $&#123;lat_s&#125;,</span><br><span class="line"> TRUELAT2= $&#123;lat_n&#125;,</span><br><span class="line"> MOAD_CEN_LAT = $&#123;lat_ns&#125;,</span><br><span class="line"> STANDARD_LON = $&#123;lon_we&#125;,</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;record8</span><br><span class="line"> IDD    =   1,</span><br><span class="line"> MAXNES =   1,</span><br><span class="line"> NESTIX =  256,  200,  136,  181,  211,</span><br><span class="line"> NESTJX =  158,  200,  181,  196,  211,</span><br><span class="line"> DIS    =  9,  10.,  3.3,  1.1,  1.1,</span><br><span class="line"> NUMC   =    1,    1,   2,     3,    4,</span><br><span class="line"> NESTI  =    1,   40,  28,    35,   45,</span><br><span class="line"> NESTJ  =    1,   60,  25,    65,   55,</span><br><span class="line"> / </span><br><span class="line"></span><br><span class="line">&amp;record9</span><br><span class="line"> PREPBUFR_OUTPUT_FILENAME = &#x27;prepbufr_output&#x27;,</span><br><span class="line"> PREPBUFR_TABLE_FILENAME = &#x27;prepbufr_table_filename&#x27;,</span><br><span class="line"> OUTPUT_OB_FORMAT = 3</span><br><span class="line"> use_for          = &#x27;3DVAR&#x27;,</span><br><span class="line"> num_slots_past   = 3,</span><br><span class="line"> num_slots_ahead  = 3,</span><br><span class="line"> write_synop = .true., </span><br><span class="line"> write_ship  = .true.,</span><br><span class="line"> write_metar = .true.,</span><br><span class="line"> write_buoy  = .true., </span><br><span class="line"> write_pilot = .true.,</span><br><span class="line"> write_sound = .true.,</span><br><span class="line"> write_amdar = .true.,</span><br><span class="line"> write_satem = .true.,</span><br><span class="line"> write_satob = .true.,</span><br><span class="line"> write_airep = .true.,</span><br><span class="line"> write_gpspw = .true.,</span><br><span class="line"> write_gpsztd= .true.,</span><br><span class="line"> write_gpsref= .true.,</span><br><span class="line"> write_gpseph= .true.,</span><br><span class="line"> write_ssmt1 = .true.,</span><br><span class="line"> write_ssmt2 = .true.,</span><br><span class="line"> write_ssmi  = .true.,</span><br><span class="line"> write_tovs  = .true.,</span><br><span class="line"> write_qscat = .true.,</span><br><span class="line"> write_profl = .true.,</span><br><span class="line"> write_bogus = .true.,</span><br><span class="line"> write_airs  = .true.,</span><br><span class="line"> /</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">./obsproc.exe</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">-----------------------------------------------------low-----------------------------------------</span></span><br><span class="line">echo &quot;更新底边界&quot;</span><br><span class="line">mkdir $&#123;RUN_BASEDIR&#125;/low</span><br><span class="line">cd $&#123;RUN_BASEDIR&#125;/low</span><br><span class="line"></span><br><span class="line">cp -p $&#123;run_dir&#125;/result/wrfout_d$&#123;DOMAIN_ID&#125;_$&#123;DATE:0:4&#125;-$&#123;DATE:4:2&#125;-$&#123;DATE:6:2&#125;_$&#123;DATE:8:2&#125;:00:00 ./fg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">touch parame.in</span><br><span class="line">cat &gt; parame.in &lt;&lt; EOF</span><br><span class="line">&amp;control_param</span><br><span class="line"> da_file            = &#x27;./fg&#x27;</span><br><span class="line"> wrf_input          = &#x27;$&#123;WRFDIR&#125;/wrfinput_d01&#x27;</span><br><span class="line"> domain_id          = $&#123;DOMAIN_ID&#125;</span><br><span class="line"> debug              = .false.</span><br><span class="line"> update_lateral_bdy = .false.</span><br><span class="line"> update_low_bdy     = .true.</span><br><span class="line"> update_lsm         = .false.</span><br><span class="line"> iswater            = 16</span><br><span class="line">/</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">ln -sf $&#123;DA_SRCDIR&#125;/var/build/da_update_bc.exe ./da_update_bc.exe</span><br><span class="line">./da_update_bc.exe</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">-----------------------------------------------------ini-----------------------------------------</span></span><br><span class="line">echo &quot;更新初始场&quot;</span><br><span class="line">mkdir $&#123;RUN_BASEDIR&#125;/ini</span><br><span class="line">cd $&#123;RUN_BASEDIR&#125;/ini</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">-----链接一些必要的文件</span></span><br><span class="line">ln -fs $&#123;DA_SRCDIR&#125;/run/LANDUSE.TBL ./LANDUSE.TBL</span><br><span class="line"></span><br><span class="line">ln -fs $&#123;RUN_BASEDIR&#125;/ob/obs_gts_$&#123;DATE:0:4&#125;-$&#123;DATE:4:2&#125;-$&#123;DATE:6:2&#125;_$&#123;DATE:8:2&#125;:00:00.3DVAR ./ob.ascii</span><br><span class="line"></span><br><span class="line">ln -fs $&#123;DATDIR&#125;/be.dat ./be.dat</span><br><span class="line"></span><br><span class="line">cp -p $&#123;RUN_BASEDIR&#125;/low/fg ./fg</span><br><span class="line"></span><br><span class="line">touch namelist.input</span><br><span class="line">cat &gt; namelist.input &lt;&lt; EOF</span><br><span class="line">&amp;wrfvar1</span><br><span class="line">var4d=false,</span><br><span class="line">print_detail_grad=false,</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar2</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar3</span><br><span class="line">ob_format=2,</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar4</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar5</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar6</span><br><span class="line">max_ext_its=1,</span><br><span class="line">ntmax=50,</span><br><span class="line">orthonorm_gradient=true,</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar7</span><br><span class="line">cv_options=5,</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar8</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar9</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar10</span><br><span class="line">test_transforms=false,</span><br><span class="line">test_gradient=false,</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar11</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar12</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar13</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar14</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar15</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar16</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar17</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar18</span><br><span class="line">analysis_date=$&#123;DATE:0:4&#125;-$&#123;DATE:4:2&#125;-$&#123;DATE:6:2&#125;_$&#123;DATE:8:2&#125;:00:00,</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar19</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar20</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar21</span><br><span class="line">time_window_min=$&#123;DATE_MIN&#125;,</span><br><span class="line">/</span><br><span class="line">&amp;wrfvar22</span><br><span class="line">time_window_max=$&#123;DATE_MAX&#125;,</span><br><span class="line">/</span><br><span class="line">&amp;time_control</span><br><span class="line">start_year=$&#123;DATE:0:4&#125;,</span><br><span class="line">start_month=$&#123;DATE:4:2&#125;,</span><br><span class="line">start_day=$&#123;DATE:6:2&#125;,</span><br><span class="line">start_hour=$&#123;DATE:8:2&#125;,</span><br><span class="line">end_year=$&#123;DATE:0:4&#125;,</span><br><span class="line">end_month=$&#123;DATE:4:2&#125;,</span><br><span class="line">end_day=$&#123;DATE:6:2&#125;,</span><br><span class="line">end_hour=$&#123;DATE:8:2&#125;,</span><br><span class="line">/</span><br><span class="line">&amp;fdda</span><br><span class="line">/</span><br><span class="line">&amp;domains</span><br><span class="line">e_we=$&#123;WEST_EAST_GRID_NUMBER&#125;,</span><br><span class="line">e_sn=$&#123;SOUTH_NORTH_GRID_NUMBER&#125;,</span><br><span class="line">e_vert=$&#123;VERTICAL_GRID_NUMBER&#125;,</span><br><span class="line">dx=$&#123;GRID_DISTANCE&#125;,</span><br><span class="line">dy=$&#123;GRID_DISTANCE&#125;,</span><br><span class="line">/</span><br><span class="line">&amp;dfi_control</span><br><span class="line">/</span><br><span class="line">&amp;tc</span><br><span class="line">/</span><br><span class="line">&amp;physics</span><br><span class="line"> mp_physics                          = 3,     </span><br><span class="line"> ra_lw_physics                       = 1,     </span><br><span class="line"> ra_sw_physics                       = 1,     </span><br><span class="line"> radt                                = 30,    </span><br><span class="line"> sf_sfclay_physics                   = 1,     </span><br><span class="line"> sf_surface_physics                  = 2,    </span><br><span class="line"> bl_pbl_physics                      = 1,    </span><br><span class="line"> bldt                                = 0,    </span><br><span class="line"> cu_physics                          = 1,     </span><br><span class="line"> cudt                                = 5,     </span><br><span class="line"> isfflx                              = 1,</span><br><span class="line"> ifsnow                              = 1,</span><br><span class="line"> icloud                              = 1,</span><br><span class="line"> surface_input_source                = 1,</span><br><span class="line"> num_soil_layers                     = 4,</span><br><span class="line"> sf_urban_physics                    = 0,    </span><br><span class="line">/</span><br><span class="line">&amp;scm</span><br><span class="line">/</span><br><span class="line">&amp;dynamics</span><br><span class="line">/</span><br><span class="line">&amp;bdy_control</span><br><span class="line">/</span><br><span class="line">&amp;grib2</span><br><span class="line">/</span><br><span class="line">&amp;fire</span><br><span class="line">/</span><br><span class="line">&amp;namelist_quilt</span><br><span class="line">/</span><br><span class="line">&amp;perturbation</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">ln -sf $&#123;DA_SRCDIR&#125;/var/build/da_wrfvar.exe ./da_wrfvar.exe</span><br><span class="line">mpirun -np 6 ./da_wrfvar.exe</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">-----------------------------------------------------bdy-----------------------------------------</span></span><br><span class="line">echo &quot;更新边界场&quot;</span><br><span class="line"></span><br><span class="line">mkdir $&#123;RUN_BASEDIR&#125;/bdy</span><br><span class="line">cd $&#123;RUN_BASEDIR&#125;/bdy</span><br><span class="line"></span><br><span class="line">cp $&#123;WRFDIR&#125;/wrfbdy_d01 ./wrfbdy_d01</span><br><span class="line"></span><br><span class="line">touch parame.in</span><br><span class="line">cat &gt; parame.in &lt;&lt; EOF</span><br><span class="line">&amp;control_param</span><br><span class="line">da_file            = &#x27;$&#123;RUN_BASEDIR&#125;/ini/wrfvar_output&#x27;,</span><br><span class="line">wrf_bdy_file       = &#x27;./wrfbdy_d01&#x27;</span><br><span class="line">wrf_input          = &#x27;$&#123;WRFDIR&#125;/wrfinput_d01&#x27;,</span><br><span class="line">domain_id          = 1</span><br><span class="line">cycling = .false. </span><br><span class="line">debug   = .true.</span><br><span class="line">low_bdy_only = .false.             </span><br><span class="line">update_lsm = .true. </span><br><span class="line">var4d_lbc = .false.</span><br><span class="line">/</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">ln -sf $&#123;DA_SRCDIR&#125;/var/build/da_update_bc.exe ./da_update_bc.exe</span><br><span class="line">./da_update_bc.exe</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">----------------------------------------------------wrf-------------------------------------------</span></span><br><span class="line">cd $&#123;WRFDIR&#125;</span><br><span class="line">ln -fs $&#123;RUN_BASEDIR&#125;/bdy/wrfbdy_d01    ./wrfbdy_d01</span><br><span class="line">ln -fs $&#123;RUN_BASEDIR&#125;/ini/wrfvar_output ./wrfinput_d01</span><br><span class="line">mpirun -np 20 ./wrf.exe</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">---------------------------------------------------result-----------------------------------------</span></span><br><span class="line">if [ ! -d &quot;$&#123;run_dir&#125;result&quot; ];then</span><br><span class="line">  mkdir $&#123;run_dir&#125;result</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">cd $&#123;run_dir&#125;result</span><br><span class="line">cp $&#123;WRFDIR&#125;/wrfout* ./</span><br><span class="line">cd $&#123;run_dir&#125;</span><br></pre></td></tr></table></figure>



<h2 id="WRF-台风个例"><a href="#WRF-台风个例" class="headerlink" title="WRF 台风个例"></a>WRF 台风个例</h2><h3 id="台风介绍"><a href="#台风介绍" class="headerlink" title="台风介绍"></a>台风介绍</h3><p>2011年第17号强台风“纳沙”（英文名：NESAT，名字来源：柬埔寨，名字意义：渔夫）于2011年9月24日上午在西北太平洋洋面上生成，9月26日夜间和29日7时两度加强成为强台风，是2011年以来登陆中国强度最强的台风（以强台风级别登陆海南），也是6年来登陆海南的最强台风。<img src="https://p.ipic.vip/mv27e1.png" alt="Image"></p>
<h3 id="模拟范围"><a href="#模拟范围" class="headerlink" title="模拟范围"></a>模拟范围</h3><p>经度：105°E-125°E<br>纬度：12°N-24°N<br>时间：2011-09-28_06至2011-09-28_12<br>网格分辨率：9000 x 9000<br>本次模拟不涉及嵌套，作为示例时间只模拟6小时。</p>
<h3 id="文件准备"><a href="#文件准备" class="headerlink" title="文件准备"></a>文件准备</h3><h4 id="文件夹准备"><a href="#文件夹准备" class="headerlink" title="文件夹准备"></a>文件夹准备</h4><p><img src="https://p.ipic.vip/ppxmjx.png" alt="Image">FNL、WPS、WRF文件夹</p>
<h4 id="FNL文件"><a href="#FNL文件" class="headerlink" title="FNL文件"></a>FNL文件</h4><p>位置：&#x2F;FNL<img src="https://p.ipic.vip/81ddfy.png" alt="Image"></p>
<h4 id="namelist-wps-文件"><a href="#namelist-wps-文件" class="headerlink" title="namelist.wps 文件"></a>namelist.wps 文件</h4><p>位置：&#x2F;WPS</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"> &amp;share</span><br><span class="line"> wrf_core = &#x27;ARW&#x27;,</span><br><span class="line"> max_dom = 1,</span><br><span class="line"> start_date = 2011-09-28_06:00:00,&#x27;2006-08-16_12:00:00&#x27;,</span><br><span class="line"> end_date   = 2011-09-28_12:00:00,&#x27;2006-08-16_12:00:00&#x27;,</span><br><span class="line"> interval_seconds = 21600</span><br><span class="line"> io_form_geogrid = 2,</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;geogrid</span><br><span class="line"> parent_id         =   1,   1,</span><br><span class="line"> parent_grid_ratio =   1,   3,</span><br><span class="line"> i_parent_start    =   1,  31,</span><br><span class="line"> j_parent_start    =   1,  17,</span><br><span class="line"> e_we              =  256, 112,</span><br><span class="line"> e_sn              =  158,  97,</span><br><span class="line"> !</span><br><span class="line"> !!!!!!!!!!!!!!!!!!!!!!!!!!!! IMPORTANT NOTE !!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line"> ! The default datasets used to produce the MAXSNOALB and ALBEDO12M</span><br><span class="line"> ! fields have changed in WPS v4.0. These fields are now interpolated</span><br><span class="line"> ! from MODIS-based datasets.</span><br><span class="line"> !</span><br><span class="line"> ! To match the output given by the default namelist.wps in WPS v3.9.1,</span><br><span class="line"> ! the following setting for geog_data_res may be used:</span><br><span class="line"> !</span><br><span class="line"> ! geog_data_res = &#x27;maxsnowalb_ncep+albedo_ncep+default&#x27;, &#x27;maxsnowalb_ncep+albedo_ncep+default&#x27;, </span><br><span class="line"> !</span><br><span class="line"> !!!!!!!!!!!!!!!!!!!!!!!!!!!! IMPORTANT NOTE !!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line"> !</span><br><span class="line"> geog_data_res = &#x27;10m&#x27;,&#x27;2m&#x27;,</span><br><span class="line"> dx = 9000,</span><br><span class="line"> dy = 9000,</span><br><span class="line"> map_proj = &#x27;lambert&#x27;,</span><br><span class="line"> ref_lat   = 18,</span><br><span class="line"> ref_lon   = 115,</span><br><span class="line"> truelat1  = 12,</span><br><span class="line"> truelat2  = 24,</span><br><span class="line"> stand_lon = 115,</span><br><span class="line"> geog_data_path = &#x27;/home/daimu/Desktop/WRF/geog/geog&#x27;</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;ungrib</span><br><span class="line"> out_format = &#x27;WPS&#x27;,</span><br><span class="line"> prefix = &#x27;FILE&#x27;,</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;metgrid</span><br><span class="line"> fg_name = &#x27;FILE&#x27;</span><br><span class="line"> io_form_metgrid = 2, </span><br><span class="line">/</span><br></pre></td></tr></table></figure>

<h4 id="namelist-input-文件"><a href="#namelist-input-文件" class="headerlink" title="namelist.input 文件"></a>namelist.input 文件</h4><p>位置：&#x2F;WRF&#x2F;test&#x2F;em_real</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">&amp;time_control</span><br><span class="line">run_days                            = 0,</span><br><span class="line">run_hours                           = 3,</span><br><span class="line">run_minutes                         = 0,</span><br><span class="line">run_seconds                         = 0,</span><br><span class="line">start_year                          = 2011, 2000, 2000,</span><br><span class="line">start_month                         = 09,   01,   01,</span><br><span class="line">start_day                           = 28,   24,   24,</span><br><span class="line">start_hour                          = 06,   12,   12,</span><br><span class="line">end_year                            = 2011, 2000, 2000,</span><br><span class="line">end_month                           = 09,   01,   01,</span><br><span class="line">end_day                             = 28,   25,   25,</span><br><span class="line">end_hour                            = 12,   12,   12,</span><br><span class="line">interval_seconds                    = 21600</span><br><span class="line">input_from_file                     = .true.,.true.,.true.,</span><br><span class="line">history_interval                    = 180,  60,   60,</span><br><span class="line">frames_per_outfile                  = 1, 1000, 1000,</span><br><span class="line">restart                             = .false.,</span><br><span class="line">restart_interval                    = 180,</span><br><span class="line">io_form_history                     = 2</span><br><span class="line">io_form_restart                     = 2</span><br><span class="line">io_form_input                       = 2</span><br><span class="line">io_form_boundary                    = 2</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;domains</span><br><span class="line">time_step                           = 30,</span><br><span class="line">time_step_fract_num                 = 0,</span><br><span class="line">time_step_fract_den                 = 1,</span><br><span class="line">max_dom                             = 1,</span><br><span class="line">e_we                                = 256,    112,   94,</span><br><span class="line">e_sn                                = 158,    97,    91,</span><br><span class="line">e_vert                              = 33,    33,    33,</span><br><span class="line">p_top_requested                     = 5000,</span><br><span class="line">num_metgrid_levels                  = 27,</span><br><span class="line">num_metgrid_soil_levels             = 4,</span><br><span class="line">dx                                  = 9000, 10000,  3333.33,</span><br><span class="line">dy                                  = 9000, 10000,  3333.33,</span><br><span class="line">grid_id                             = 1,     2,     3,</span><br><span class="line">parent_id                           = 0,     1,     2,</span><br><span class="line">i_parent_start                      = 1,     31,    30,</span><br><span class="line">j_parent_start                      = 1,     17,    30,</span><br><span class="line">parent_grid_ratio                   = 1,     3,     3,</span><br><span class="line">parent_time_step_ratio              = 1,     3,     3,</span><br><span class="line">feedback                            = 1,</span><br><span class="line">smooth_option                       = 0</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;physics</span><br><span class="line">mp_physics                          = 3,     3,     3,</span><br><span class="line">ra_lw_physics                       = 1,     1,     1,</span><br><span class="line">ra_sw_physics                       = 1,     1,     1,</span><br><span class="line">radt                                = 30,    30,    30,</span><br><span class="line">sf_sfclay_physics                   = 1,     1,     1,</span><br><span class="line">sf_surface_physics                  = 2,     2,     2,</span><br><span class="line">bl_pbl_physics                      = 1,     1,     1,</span><br><span class="line">bldt                                = 0,     0,     0,</span><br><span class="line">cu_physics                          = 1,     1,     0,</span><br><span class="line">cudt                                = 5,     5,     5,</span><br><span class="line">isfflx                              = 1,</span><br><span class="line">ifsnow                              = 1,</span><br><span class="line">icloud                              = 1,</span><br><span class="line">surface_input_source                = 1,</span><br><span class="line">num_soil_layers                     = 4,</span><br><span class="line">sf_urban_physics                    = 0,     0,     0,</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;fdda</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;dynamics</span><br><span class="line">hybrid_opt                          = 2, </span><br><span class="line">w_damping                           = 0,</span><br><span class="line">diff_opt                            = 1,      1,      1,</span><br><span class="line">km_opt                              = 4,      4,      4,</span><br><span class="line">diff_6th_opt                        = 0,      0,      0,</span><br><span class="line">diff_6th_factor                     = 0.12,   0.12,   0.12,</span><br><span class="line">base_temp                           = 290.</span><br><span class="line">damp_opt                            = 3,</span><br><span class="line">zdamp                               = 5000.,  5000.,  5000.,</span><br><span class="line">dampcoef                            = 0.2,    0.2,    0.2</span><br><span class="line">khdif                               = 0,      0,      0,</span><br><span class="line">kvdif                               = 0,      0,      0,</span><br><span class="line">non_hydrostatic                     = .true., .true., .true.,</span><br><span class="line">moist_adv_opt                       = 1,      1,      1,     </span><br><span class="line">scalar_adv_opt                      = 1,      1,      1,     </span><br><span class="line">gwd_opt                             = 1,</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;bdy_control</span><br><span class="line">spec_bdy_width                      = 5,</span><br><span class="line">specified                           = .true.</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;grib2</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;namelist_quilt</span><br><span class="line">nio_tasks_per_group = 0,</span><br><span class="line">nio_groups = 1,</span><br><span class="line">/</span><br></pre></td></tr></table></figure>

<h3 id="运行流程-1"><a href="#运行流程-1" class="headerlink" title="运行流程"></a>运行流程</h3><h4 id="WPS文件夹"><a href="#WPS文件夹" class="headerlink" title="WPS文件夹"></a>WPS文件夹</h4><h5 id="step-1-x2F-geogrid-exe"><a href="#step-1-x2F-geogrid-exe" class="headerlink" title="step 1 : .&#x2F;geogrid.exe"></a>step 1 : .&#x2F;geogrid.exe</h5><p>终端：<img src="https://p.ipic.vip/4evafh.png" alt="Image"></p>
<p>WPS文件夹-增加的文件：<img src="https://p.ipic.vip/p94isl.png" alt="Image"></p>
<h5 id="step-2-x2F-link-grib-csh-x2F-FNL-x2F-fnl"><a href="#step-2-x2F-link-grib-csh-x2F-FNL-x2F-fnl" class="headerlink" title="step 2 : .&#x2F;link_grib.csh ..&#x2F;FNL&#x2F;fnl*"></a>step 2 : .&#x2F;link_grib.csh ..&#x2F;FNL&#x2F;fnl*</h5><p>终端：<img src="https://p.ipic.vip/u7ntww.png" alt="Image"></p>
<p>WPS文件夹-增加的文件：<img src="https://p.ipic.vip/klsyyu.png" alt="Image"></p>
<h5 id="step-3-x2F-ungrib-exe"><a href="#step-3-x2F-ungrib-exe" class="headerlink" title="step 3 : .&#x2F;ungrib.exe"></a>step 3 : .&#x2F;ungrib.exe</h5><p>终端：<img src="https://p.ipic.vip/k2h2so.png" alt="Image"><img src="https://p.ipic.vip/maweap.png" alt="Image"></p>
<p>WPS文件夹-增加的文件：<img src="https://p.ipic.vip/unn0c2.png" alt="Image"></p>
<h5 id="step-4-x2F-metgrid-exe"><a href="#step-4-x2F-metgrid-exe" class="headerlink" title="step 4 : .&#x2F;metgrid.exe"></a>step 4 : .&#x2F;metgrid.exe</h5><p>终端：<img src="https://p.ipic.vip/947sw3.png" alt="Image"></p>
<p>WPS文件夹-增加的文件：<img src="https://p.ipic.vip/08b0qm.png" alt="Image"></p>
<h4 id="WRF-test-em-real文件夹"><a href="#WRF-test-em-real文件夹" class="headerlink" title="WRF-test-em_real文件夹"></a>WRF-test-em_real文件夹</h4><h5 id="step-1-ln-sf-x2F-x2F-x2F-WPS-x2F-met-em-d"><a href="#step-1-ln-sf-x2F-x2F-x2F-WPS-x2F-met-em-d" class="headerlink" title="step 1 : ln -sf ..&#x2F;..&#x2F;..&#x2F;WPS&#x2F;met_em.d* ."></a>step 1 : ln -sf ..&#x2F;..&#x2F;..&#x2F;WPS&#x2F;met_em.d* .</h5><p>终端：<img src="https://p.ipic.vip/i02t2x.png" alt="Image"></p>
<p>WRF文件夹-增加的文件：<img src="https://p.ipic.vip/n9x4sh.png" alt="Image"></p>
<h5 id="step-2-x2F-real-exe"><a href="#step-2-x2F-real-exe" class="headerlink" title="step 2 : .&#x2F;real.exe"></a>step 2 : .&#x2F;real.exe</h5><p>终端：<img src="https://p.ipic.vip/qcwten.png" alt="Image"></p>
<p>WRF文件夹-增加的文件：<img src="https://p.ipic.vip/fpxz6g.png" alt="Image"></p>
<h5 id="step-3-x2F-wrf-exe"><a href="#step-3-x2F-wrf-exe" class="headerlink" title="step 3 : .&#x2F;wrf.exe"></a>step 3 : .&#x2F;wrf.exe</h5><p>终端：<img src="https://p.ipic.vip/qp9ot3.png" alt="Image"></p>
<p>WRF文件夹-增加的文件：<img src="https://p.ipic.vip/aawby3.png" alt="Image"></p>
<p><strong>注意：如有问题，请查阅（用几个核就会出现几个文件）：</strong><img src="https://p.ipic.vip/8ae471.png" alt="Image"></p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/05/01/Tool/iPic/" rel="prev" title="iPic">
      <i class="fa fa-chevron-left"></i> iPic
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/05/01/Tool/Wget/" rel="next" title="Wget">
      Wget <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Install-WRF"><span class="nav-number">1.</span> <span class="nav-text">Install WRF</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%AE%89%E8%A3%85spack%EF%BC%8C%E5%B9%B6%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-number">1.0.1.</span> <span class="nav-text">1. 安装spack，并配置环境变量</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-1-%E5%85%8B%E9%9A%86spack%E4%BB%93%E5%BA%93%E5%88%B0%E6%9C%AC%E5%9C%B0"><span class="nav-number">1.0.1.1.</span> <span class="nav-text">1.1 克隆spack仓库到本地</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-%E5%B0%86spack-setup%E7%8E%AF%E5%A2%83%E5%91%BD%E4%BB%A4%E5%8A%A0%E8%BD%BD%E5%88%B0bashrc%E4%B8%AD"><span class="nav-number">1.0.1.2.</span> <span class="nav-text">1.2 将spack setup环境命令加载到bashrc中</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-3-%E5%AF%BB%E6%89%BE%E7%BC%96%E8%AF%91%E5%99%A8"><span class="nav-number">1.0.1.3.</span> <span class="nav-text">1.3 寻找编译器</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%AE%89%E8%A3%85wrf"><span class="nav-number">1.0.2.</span> <span class="nav-text">2. 安装wrf</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-%E5%A6%82%E6%9E%9C%E5%8F%AF%E4%BB%A5%E8%BF%9E%E6%8E%A5%E4%BA%92%E8%81%94%E7%BD%91"><span class="nav-number">1.0.2.1.</span> <span class="nav-text">2.1 如果可以连接互联网</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-%E5%A6%82%E6%9E%9C%E6%97%A0%E6%B3%95%E8%BF%9E%E6%8E%A5%E4%BA%92%E8%81%94%E7%BD%91"><span class="nav-number">1.0.2.2.</span> <span class="nav-text">2.2 如果无法连接互联网</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WRF-run-with-CFS"><span class="nav-number">2.</span> <span class="nav-text">WRF run with CFS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WRF-notes"><span class="nav-number">3.</span> <span class="nav-text">WRF notes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Weather-Research-and-Forecasting-WRF"><span class="nav-number">4.</span> <span class="nav-text">Weather Research and Forecasting | WRF</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#WRF%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="nav-number">4.1.</span> <span class="nav-text">WRF的基本原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WRF%E7%9A%84%E5%8F%82%E6%95%B0%E5%8C%96%E6%96%B9%E6%A1%88"><span class="nav-number">4.2.</span> <span class="nav-text">WRF的参数化方案</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BE%AE%E7%89%A9%E7%90%86%E8%BF%87%E7%A8%8B%E6%96%B9%E6%A1%88"><span class="nav-number">4.2.1.</span> <span class="nav-text">微物理过程方案</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A7%AF%E4%BA%91%E5%AF%B9%E6%B5%81%E6%96%B9%E6%A1%88"><span class="nav-number">4.2.2.</span> <span class="nav-text">积云对流方案</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%99%86%E9%9D%A2%E8%BF%87%E7%A8%8B%E6%96%B9%E6%A1%88"><span class="nav-number">4.2.3.</span> <span class="nav-text">陆面过程方案</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%8C%E6%98%9F%E8%BE%B9%E7%95%8C%E5%B1%82%E6%96%B9%E6%A1%88"><span class="nav-number">4.2.4.</span> <span class="nav-text">行星边界层方案</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%A7%E6%B0%94%E8%BE%90%E5%B0%84%E6%96%B9%E6%A1%88"><span class="nav-number">4.2.5.</span> <span class="nav-text">大气辐射方案</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WRF%E8%BE%93%E5%85%A5%E5%92%8C%E8%BE%93%E5%87%BA%E6%95%B0%E6%8D%AE"><span class="nav-number">4.3.</span> <span class="nav-text">WRF输入和输出数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WRF%E7%9A%84%E5%BA%94%E7%94%A8"><span class="nav-number">4.4.</span> <span class="nav-text">WRF的应用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WRF-%E5%BA%93%E7%9A%84%E5%AE%89%E8%A3%85"><span class="nav-number">5.</span> <span class="nav-text">WRF 库的安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E6%B5%8B%E8%AF%95"><span class="nav-number">5.1.</span> <span class="nav-text">环境测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%93%E6%96%87%E4%BB%B6%E7%9A%84%E8%B7%AF%E5%BE%84"><span class="nav-number">5.2.</span> <span class="nav-text">库文件的路径</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%93%E6%96%87%E4%BB%B6%E7%9A%84%E5%AE%89%E8%A3%85"><span class="nav-number">5.3.</span> <span class="nav-text">库文件的安装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WRF%E7%9A%84%E5%AE%89%E8%A3%85"><span class="nav-number">6.</span> <span class="nav-text">WRF的安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%8A%A0%E8%BD%BD"><span class="nav-number">6.1.</span> <span class="nav-text">环境加载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WRF%E7%9A%84%E7%BC%96%E8%AF%91"><span class="nav-number">6.2.</span> <span class="nav-text">WRF的编译</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WPS%E7%9A%84%E7%BC%96%E8%AF%91"><span class="nav-number">6.3.</span> <span class="nav-text">WPS的编译</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WRF-3DVar%E7%9A%84%E5%AE%89%E8%A3%85"><span class="nav-number">7.</span> <span class="nav-text">WRF 3DVar的安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WRF%E7%9A%84%E8%BF%90%E8%A1%8C"><span class="nav-number">8.</span> <span class="nav-text">WRF的运行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87"><span class="nav-number">8.1.</span> <span class="nav-text">数据准备</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-%E9%9D%99%E6%80%81%E5%9C%B0%E5%BD%A2%E6%95%B0%E6%8D%AE"><span class="nav-number">8.1.1.</span> <span class="nav-text">1.1 静态地形数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-%E7%BD%91%E6%A0%BC%E5%8C%96%E6%B0%94%E8%B1%A1%E6%95%B0%E6%8D%AE"><span class="nav-number">8.1.2.</span> <span class="nav-text">1.2 网格化气象数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WRF%E8%BF%90%E8%A1%8C"><span class="nav-number">8.2.</span> <span class="nav-text">WRF运行</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#WPS%E8%BF%90%E8%A1%8C"><span class="nav-number">8.2.1.</span> <span class="nav-text">WPS运行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-WRF%E8%BF%90%E8%A1%8C"><span class="nav-number">8.2.2.</span> <span class="nav-text">2.2 WRF运行</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WRFDA%E7%9A%84%E8%BF%90%E8%A1%8C"><span class="nav-number">9.</span> <span class="nav-text">WRFDA的运行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E5%87%86%E5%A4%87"><span class="nav-number">9.1.</span> <span class="nav-text">运行准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E6%AD%A5%E9%AA%A4%E5%88%86%E8%A7%A3"><span class="nav-number">9.2.</span> <span class="nav-text">具体步骤分解</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-%E8%83%8C%E6%99%AF%E8%AF%AF%E5%B7%AE%E5%8D%8F%E6%96%B9%E5%B7%AE%E7%9F%A9%E9%98%B5B0"><span class="nav-number">9.2.1.</span> <span class="nav-text">2.1 背景误差协方差矩阵B0</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%82%E6%B5%8B%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6y0%EF%BC%8CR"><span class="nav-number">9.2.2.</span> <span class="nav-text">观测数据文件y0，R</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="nav-number">9.3.</span> <span class="nav-text">运行流程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%B7%E5%90%AF%E5%8A%A8"><span class="nav-number">9.3.1.</span> <span class="nav-text">冷启动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-%E7%83%AD%E5%90%AF%E5%8A%A8"><span class="nav-number">9.3.2.</span> <span class="nav-text">3.2 热启动</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WRF-%E5%8F%B0%E9%A3%8E%E4%B8%AA%E4%BE%8B"><span class="nav-number">10.</span> <span class="nav-text">WRF 台风个例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%B0%E9%A3%8E%E4%BB%8B%E7%BB%8D"><span class="nav-number">10.1.</span> <span class="nav-text">台风介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E6%8B%9F%E8%8C%83%E5%9B%B4"><span class="nav-number">10.2.</span> <span class="nav-text">模拟范围</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%87%86%E5%A4%87"><span class="nav-number">10.3.</span> <span class="nav-text">文件准备</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%A4%B9%E5%87%86%E5%A4%87"><span class="nav-number">10.3.1.</span> <span class="nav-text">文件夹准备</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#FNL%E6%96%87%E4%BB%B6"><span class="nav-number">10.3.2.</span> <span class="nav-text">FNL文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#namelist-wps-%E6%96%87%E4%BB%B6"><span class="nav-number">10.3.3.</span> <span class="nav-text">namelist.wps 文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#namelist-input-%E6%96%87%E4%BB%B6"><span class="nav-number">10.3.4.</span> <span class="nav-text">namelist.input 文件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B-1"><span class="nav-number">10.4.</span> <span class="nav-text">运行流程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#WPS%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="nav-number">10.4.1.</span> <span class="nav-text">WPS文件夹</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#step-1-x2F-geogrid-exe"><span class="nav-number">10.4.1.1.</span> <span class="nav-text">step 1 : .&#x2F;geogrid.exe</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#step-2-x2F-link-grib-csh-x2F-FNL-x2F-fnl"><span class="nav-number">10.4.1.2.</span> <span class="nav-text">step 2 : .&#x2F;link_grib.csh ..&#x2F;FNL&#x2F;fnl*</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#step-3-x2F-ungrib-exe"><span class="nav-number">10.4.1.3.</span> <span class="nav-text">step 3 : .&#x2F;ungrib.exe</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#step-4-x2F-metgrid-exe"><span class="nav-number">10.4.1.4.</span> <span class="nav-text">step 4 : .&#x2F;metgrid.exe</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WRF-test-em-real%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="nav-number">10.4.2.</span> <span class="nav-text">WRF-test-em_real文件夹</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#step-1-ln-sf-x2F-x2F-x2F-WPS-x2F-met-em-d"><span class="nav-number">10.4.2.1.</span> <span class="nav-text">step 1 : ln -sf ..&#x2F;..&#x2F;..&#x2F;WPS&#x2F;met_em.d* .</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#step-2-x2F-real-exe"><span class="nav-number">10.4.2.2.</span> <span class="nav-text">step 2 : .&#x2F;real.exe</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#step-3-x2F-wrf-exe"><span class="nav-number">10.4.2.3.</span> <span class="nav-text">step 3 : .&#x2F;wrf.exe</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ruyanc"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">ruyanc</p>
  <div class="site-description" itemprop="description">E-mail: ruyan1810@gmail.com</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">164</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>




      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ruyanc</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.3" zIndex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>




  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true,"scale":0.5},"log":false});</script></body>
</html>

