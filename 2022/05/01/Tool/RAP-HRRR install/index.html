<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/Egg_32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/Egg_16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="推荐 spack 底层环境配置12spack env create RaH_Gnu spack env activate RaH_Gnu    安装gcc 5.4.0  1234567891011# 1. 安装spack install gcc@5.4.0 cppflags&#x3D;&amp;#x27;-std&#x3D;gnu++14&amp;#x27; cxxflags&#x3D;&amp;#x27;-std&#x3D;gnu++14&amp;#x27;  #">
<meta property="og:type" content="article">
<meta property="og:title" content="RAP-HRRR install">
<meta property="og:url" content="http://example.com/2022/05/01/Tool/RAP-HRRR%20install/index.html">
<meta property="og:site_name" content="ruyanc">
<meta property="og:description" content="推荐 spack 底层环境配置12spack env create RaH_Gnu spack env activate RaH_Gnu    安装gcc 5.4.0  1234567891011# 1. 安装spack install gcc@5.4.0 cppflags&#x3D;&amp;#x27;-std&#x3D;gnu++14&amp;#x27; cxxflags&#x3D;&amp;#x27;-std&#x3D;gnu++14&amp;#x27;  #">
<meta property="og:locale">
<meta property="article:published_time" content="2022-05-01T04:00:00.000Z">
<meta property="article:modified_time" content="2025-09-18T03:10:44.871Z">
<meta property="article:author" content="ruyanc">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2022/05/01/Tool/RAP-HRRR%20install/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>RAP-HRRR install | ruyanc</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">ruyanc</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Acedemic Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-atmsci">

    <a href="/categories/AtmSci/" rel="section"><i class="fa fa-graduation-cap fa-fw"></i>AtmSci</a>

  </li>
        <li class="menu-item menu-item-ocnsci">

    <a href="/categories/OcnSci/" rel="section"><i class="fa fa-graduation-cap fa-fw"></i>OcnSci</a>

  </li>
        <li class="menu-item menu-item-seminar">

    <a href="/categories/Seminar/" rel="section"><i class="fa fa-users fa-fw"></i>Seminar</a>

  </li>
        <li class="menu-item menu-item-readcube">

    <a href="/categories/ReadCube/" rel="section"><i class="fa fa-archive fa-fw"></i>ReadCube</a>

  </li>
        <li class="menu-item menu-item-publication">

    <a href="/categories/Publication" rel="section"><i class="fa fa-archive fa-fw"></i>Publication</a>

  </li>
        <li class="menu-item menu-item-recharge">

    <a href="/categories/Recharge/" rel="section"><i class="fa fa-coffee fa-fw"></i>Recharge</a>

  </li>
        <li class="menu-item menu-item-tool">

    <a href="/categories/Tool/" rel="section"><i class="fa fa-wrench fa-fw"></i>Tool</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/01/Tool/RAP-HRRR%20install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ruyanc">
      <meta itemprop="description" content="E-mail: ruyan1810@gmail.com">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruyanc">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          RAP-HRRR install
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-05-01 12:00:00" itemprop="dateCreated datePublished" datetime="2022-05-01T12:00:00+08:00">2022-05-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-18 11:10:44" itemprop="dateModified" datetime="2025-09-18T11:10:44+08:00">2025-09-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tool/" itemprop="url" rel="index"><span itemprop="name">Tool</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="推荐-spack-底层环境配置"><a href="#推荐-spack-底层环境配置" class="headerlink" title="推荐 spack 底层环境配置"></a>推荐 spack 底层环境配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spack env create RaH_Gnu </span><br><span class="line">spack env activate RaH_Gnu </span><br></pre></td></tr></table></figure>

<ul>
<li>安装gcc 5.4.0</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1. 安装</span></span><br><span class="line">spack install gcc@5.4.0 cppflags=&#x27;-std=gnu++14&#x27; cxxflags=&#x27;-std=gnu++14&#x27;</span><br><span class="line"><span class="meta prompt_">  </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2. 把刚装好的 5.4.0 注册为可用编译器</span></span><br><span class="line">spack compiler add &quot;$(spack location -i gcc@5.4.0)&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3. 验证</span></span><br><span class="line">spack compiler list</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4. 安装后使用</span></span><br><span class="line">spack load gcc@5.4.0</span><br></pre></td></tr></table></figure>

<ul>
<li>安装 <a href="mailto:&#111;&#x70;&#x65;&#x6e;&#109;&#112;&#x69;&#x40;&#x34;&#x2e;&#x35;&#x2e;&#x31;">&#111;&#x70;&#x65;&#x6e;&#109;&#112;&#x69;&#x40;&#x34;&#x2e;&#x35;&#x2e;&#x31;</a></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spack add openmpi@4.5.1</span><br><span class="line">spack concretize</span><br><span class="line">spack install</span><br></pre></td></tr></table></figure>

<ul>
<li>安装<a href="mailto:&#x70;&#121;&#x74;&#104;&#111;&#x6e;&#x40;&#x33;&#x2e;&#x38;&#x2e;&#48;">&#x70;&#121;&#x74;&#104;&#111;&#x6e;&#x40;&#x33;&#x2e;&#x38;&#x2e;&#48;</a></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spack add python@3.8.0</span><br><span class="line">spack concretize</span><br><span class="line">spack install</span><br></pre></td></tr></table></figure>

<ul>
<li>特殊情况</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spack add w3nco@2.4.1</span><br><span class="line">spack concretize --force</span><br><span class="line">spack install</span><br></pre></td></tr></table></figure>

<p>安装其他依赖库，也可具体安装时根据具体需求再安装</p>
<ul>
<li>ecflow</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spack add libtiff@4.7.0+pic%gcc@5.4.0</span><br><span class="line">spack concretize</span><br><span class="line">spack install</span><br><span class="line">spack add ecflow+ui%gcc@5.4.0</span><br></pre></td></tr></table></figure>







<h3 id="⭐️-可选-hpc-stack-安装基本软件依赖"><a href="#⭐️-可选-hpc-stack-安装基本软件依赖" class="headerlink" title="⭐️ 可选 hpc-stack 安装基本软件依赖"></a>⭐️ 可选 hpc-stack 安装基本软件依赖</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zlib libpng jasper hdf5 pnetcdf netcdf nco esmf bacio sigio</span><br><span class="line">sfcio gfsio w3nco sp ip nemsio w3emc g2 g2tmpl crtm </span><br><span class="line">wrf_io bufr prod_util grib_util</span><br></pre></td></tr></table></figure>

<ul>
<li><p>建议打包好放到<code>/home/cry/down_soft/hpc-stack/pkg</code>目录下</p>
</li>
<li><p>修改 <code>config_hrrr.sh</code>  前几行机器信息后</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./setup_modules.sh -p /home/cry/down_soft/hpc-stack -c  config/config_hrrr.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>所有软件安装命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./build_stack.sh -p /home/cry/down_soft/hpc-stack -c config/config_hrrr.sh -y stack/stack_custom.yaml -m</span><br></pre></td></tr></table></figure>
</li>
<li><p>单个软件安装命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./build_stack.sh -p /home/cry/down_soft/hpc-stack -c config/config_hrrr.sh -y stack/stack_custom.yaml -m -l miniconda3</span><br></pre></td></tr></table></figure>
</li>
<li><p>debug</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">bacio 安装时找不到路径</span></span><br><span class="line">export bacio_DIR=/home/cry/down_soft/hpc-stack/gnu-13.3.0/bacio/2.4.1/lib/cmake/bacio/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">g2 3.4.5 安装失败</span></span><br><span class="line">需要配合 g2c 1.8.0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">grib_util 1.4.0 安装失败</span></span><br><span class="line">配合 g2 3.4.5 和 g2c 1.8.0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ip2 安装失败 报sp_8 错误</span></span><br><span class="line">pkg/ip2-v1.1.2/src/CMakeLists.txt 中 </span><br><span class="line"><span class="meta prompt_">target_link_libraries($</span><span class="language-bash">&#123;lib_name&#125; PUBLIC sp::sp_<span class="variable">$&#123;kind&#125;</span>)</span></span><br><span class="line">改为 target_link_libraries($&#123;lib_name&#125; PUBLIC sp::sp_d)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">crtm 安装错误</span></span><br><span class="line">先安装ecbuild 和 eckit</span><br><span class="line">module load ecbuild </span><br><span class="line">module load eckit</span><br><span class="line">修改crtm-v2.4.0/CMakeLists.txt</span><br><span class="line">将 project( crtm LANGUAGES Fortran ) 改为</span><br><span class="line">project(crtm VERSION 2.4.0 LANGUAGES C CXX Fortran) </span><br><span class="line">注释掉 add_subdirectory(test)  </span><br></pre></td></tr></table></figure>
</li>
<li><p>载入安装好的模块</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">module use /home/cry/down_soft/hpc-stack/modulefiles/stack</span><br><span class="line">module load hpc hpc-gnu hpc-openmpi</span><br><span class="line">module avail</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="安装RAP"><a href="#安装RAP" class="headerlink" title="安装RAP"></a>安装RAP</h2><h3 id="编译-rap-wrfarw-serial"><a href="#编译-rap-wrfarw-serial" class="headerlink" title="编译 rap_wrfarw_serial"></a>编译 <code>rap_wrfarw_serial</code></h3><p>用于编译所需要的<code>wrfio</code>等库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cd $&#123;BASE&#125;/rap_wrfarw.fd/WRFV3.9</span><br><span class="line">./clean -aa</span><br><span class="line">./clean -a</span><br><span class="line">./clean</span><br><span class="line">cd external/io_int/</span><br><span class="line">rm -f *.f *.o *.obj *.i *.mod *.a diffwrf io_int_idx_tags.h</span><br><span class="line">cd -</span><br><span class="line">cp configure.wrf.lxcry configure.wrf</span><br><span class="line">./configure -hyb</span><br><span class="line">./compile em_real |&amp; tee make.log</span><br></pre></td></tr></table></figure>

<p><code>configure.wrf.lxcry</code>为依据<code>configure.wrf.serial</code>修改对应编译选项后的适配文件</p>
<ul>
<li>出现real_em.f90  <code>#ifdef DM_PARALLEL</code>报错</li>
</ul>
<p>vi .&#x2F;main&#x2F;real_em.F</p>
<figure class="highlight plaintext"><figcaption><span>./main/real_em.F</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">去掉下面宏定义前面的空格</span><br><span class="line">#ifdef DM_PARALLEL</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure>

<h3 id="编译rap-update-bc"><a href="#编译rap-update-bc" class="headerlink" title="编译rap_update_bc"></a>编译<code>rap_update_bc</code></h3><ul>
<li>source 环境变量</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source sorc/spack_rap_load.sh</span><br></pre></td></tr></table></figure>

<ul>
<li>修改<code>makefile</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FC  = mpif90</span><br></pre></td></tr></table></figure>

<ul>
<li>make</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd $&#123;BASE&#125;/rap_update_bc.fd</span><br><span class="line">mkdir -p ../../exec</span><br><span class="line">make clean</span><br><span class="line">make</span><br></pre></td></tr></table></figure>

<h3 id="编译-rap-wrfpost"><a href="#编译-rap-wrfpost" class="headerlink" title="编译 rap_wrfpost"></a>编译 <code>rap_wrfpost</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone -b upp_v11.0.0 https://github.com/NOAA-EMC/UPP</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd UPP/tests</span><br><span class="line">./compile_upp.sh</span><br></pre></td></tr></table></figure>

<p>修改<code>compile_upp.sh</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compiler=&quot;gnu&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>Spack 安装 g2、g2tmpl</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spack add g2@3.4.5%gcc@5.4.0^libpng+pic</span><br></pre></td></tr></table></figure>

<p>A successful build will create an executable called upp.x in the UPP&#x2F;tests&#x2F;install&#x2F;bin&#x2F; directory.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp tests/install/bin/upp.x ../../exec/rap_wrfpost</span><br></pre></td></tr></table></figure>

<ul>
<li>Obtain and unpack CRTM fix coefficient files</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd UPP</span><br><span class="line">mkdir crtm &amp;&amp; cd crtm</span><br><span class="line">wget https://github.com/NOAA-EMC/UPP/releases/download/upp_v10.1.0/fix.tar.gz</span><br><span class="line">tar -xzf fix.tar.gz</span><br></pre></td></tr></table></figure>

<h3 id="编译-rap-wps"><a href="#编译-rap-wps" class="headerlink" title="编译 rap_wps"></a>编译 <code>rap_wps</code></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd $&#123;BASE&#125;/rap_wps.fd/WPSV3.9.1</span><br><span class="line">./clean -aa</span><br><span class="line">./clean -a</span><br><span class="line">./clean</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp ungrib/src/ungrib.exe $&#123;BASE&#125;/../exec/rap_wps_ungrib</span><br><span class="line">cp metgrid/src/metgrid.exe $&#123;BASE&#125;/../exec/rap_wps_metgrid</span><br></pre></td></tr></table></figure>

<ul>
<li><p>尚未理解以下操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;BASE&#125;/../parm/rap_Vtable.gfs` 必须替换成为 `WRF-WPS` 提供的给**community**用户使用的 `Vtable</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="编译-rap-wrfarw"><a href="#编译-rap-wrfarw" class="headerlink" title="编译 rap_wrfarw"></a>编译 <code>rap_wrfarw</code></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd $&#123;BASE&#125;/rap_wrfarw.fd/WRFV3.9</span><br><span class="line">./clean -aa</span><br><span class="line">./clean -a</span><br><span class="line">./clean</span><br><span class="line">cd external/io_int/</span><br><span class="line">rm -f *.f *.o *.obj *.i *.mod *.a diffwrf io_int_idx_tags.h</span><br><span class="line">cd -</span><br><span class="line">cp configure.wrf.lxcry configure.wrf</span><br><span class="line">./compile em_real |&amp; tee make.log</span><br></pre></td></tr></table></figure>
<p><code>configure.wrf.lxcry</code>为依据<code>configure.wrf.optim</code>修改对应编译选项后的适配文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp main/real.exe $&#123;BASE&#125;/../exec/rap_wrfarw_real</span><br><span class="line">cp main/wrf.exe $&#123;BASE&#125;/../exec/rap_wrfarw_fcst</span><br></pre></td></tr></table></figure>



<h2 id="编译-rap-gsi"><a href="#编译-rap-gsi" class="headerlink" title="编译 rap_gsi"></a>编译 <code>rap_gsi</code></h2><ul>
<li>spack 安装 <a href="mailto:&#99;&#x6d;&#97;&#107;&#x65;&#64;&#51;&#46;&#49;&#x38;&#x2e;&#54;">&#99;&#x6d;&#97;&#107;&#x65;&#64;&#51;&#46;&#49;&#x38;&#x2e;&#54;</a>、<a href="mailto:&#x6f;&#112;&#101;&#110;&#x62;&#108;&#97;&#115;&#x40;&#x30;&#x2e;&#51;&#46;&#x32;&#x30;">&#x6f;&#112;&#101;&#110;&#x62;&#108;&#97;&#115;&#x40;&#x30;&#x2e;&#51;&#46;&#x32;&#x30;</a>、<a href="mailto:&#x62;&#97;&#99;&#105;&#x6f;&#x40;&#x32;&#x2e;&#52;&#x2e;&#49;">&#x62;&#97;&#99;&#105;&#x6f;&#x40;&#x32;&#x2e;&#52;&#x2e;&#49;</a></li>
<li>spack 安装 crtm</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt安装git-lfs后，export GIT_LFS_SKIP_SMUDGE=1</span><br></pre></td></tr></table></figure>

<ul>
<li><code>spack_rap_load.sh</code>中添加以下内容后重新source</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export BUFR_LIBd=$SPACK_LIB/libbufr_d_DA.a</span><br><span class="line">export NEMSIO_LIB=$SPACK_LIB/libnemsio.a</span><br><span class="line"></span><br><span class="line">export CRTM_INC=$SPACK_INCLUDE</span><br><span class="line">export CRTM_LIB=$SPACK_LIB/libcrtm.a</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 此为debug时找不到路径的解决方案</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>修改<code>CMakeLists.txt</code> 中部分内容如下</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#set(CMAKE_DISABLE_IN_SOURCE_BUILD ON)</span><br><span class="line"></span><br><span class="line">#set(CMAKE_C_COMPILER &quot;$&#123;crayComp&#125;/cc&quot;)</span><br><span class="line">#set(CMAKE_CXX_COMPILER &quot;$&#123;crayComp&#125;/CC&quot;)</span><br><span class="line">#set(CMAKE_Fortran_COMPILER &quot;$&#123;crayComp&#125;/ftn&quot;)</span><br><span class="line"></span><br><span class="line">set(ENV&#123;CC&#125; &quot;gcc&quot;)</span><br><span class="line">set(ENV&#123;CXX&#125; &quot;g++&quot;)</span><br><span class="line">set(ENV&#123;FC&#125; &quot;gfortran&quot;)</span><br></pre></td></tr></table></figure>

<ul>
<li>创建<code>build</code>文件夹</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd $&#123;BASE&#125;/rap_gsi.fd</span><br><span class="line">rm -fr build</span><br><span class="line">mkdir build</span><br><span class="line">cd $&#123;BASE&#125;/rap_gsi.fd/build</span><br></pre></td></tr></table></figure>

<ul>
<li>修改<code>$&#123;BASE&#125;/rap_gsi.fd/src/fv3gfs_ncio/CMakeLists.txt</code>中部分内容如下</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set(FV3GFS_NCIO_Fortran_FLAGS &quot;-ffree-line-length-none&quot;) # 新增</span><br><span class="line">set_source_files_properties( $&#123;FV3GFS_NCIO_SRC&#125; PROPERTIES COMPILE_FLAGS &quot;$&#123;FV3GFS_NCIO_Fortran_FLAGS&#125;&quot; ) # 修改</span><br></pre></td></tr></table></figure>

<ul>
<li>修改<code>/home/cry/WORK/HRRR/sorc/hrrr_gsi.fd/src/gsi/setupcldtot.F90</code>中部分内容如下</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">write(*,&#x27;(A,7i5)&#x27;) # 原 write(*,&#x27;(A,7i)&#x27;)</span><br></pre></td></tr></table></figure>

<ul>
<li>使用编译选项关掉已经安装的库</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake -DENKF_MODE=WRF -DBUILD_ENKF_PREPROCESS_ARW=ON -DBUILD_GSDCLOUD_ARW=ON -DBUILD_BACIO=OFF -DBUILD_SP=OFF -DBUILD_NEMSIO=OFF -DBUILD_NCO=OFF -DBUILD_EMC=OFF -DBUILD_SFCIO=OFF -DBUILD_SIGIO=OFF -DBUILD_BUFR=OFF -DBUILD_IP=OFF -DBUILD_CRTM=OFF ../.</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make -j1 |&amp; tee make.log</span><br></pre></td></tr></table></figure>

<ul>
<li>debug</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-lnetcdff 报错</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/usr/bin/ld: cannot find -lnetcdff: No such file or directory</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/usr/bin/ld: cannot find -lnetcdff: No such file or directory</span></span><br><span class="line">解决方式：</span><br><span class="line">修改 ./cmake/Modules/setGNUFlags.cmake 文件中以下两处</span><br><span class="line">set(EXTRA_LINKER_FLAGS &quot;-L$ENV&#123;NETCDF_LIB&#125; -lgomp -lnetcdf -lnetcdff&quot; CACHE INTERNAL &quot;&quot;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">找不到nemsio</span></span><br><span class="line">解决方式：</span><br><span class="line">gsi所需要的nemsio的环境变量需要指定到具体的库，而不是路径。将环境变量设为</span><br><span class="line">NEMSIO_LIB=$SPACK_LIB/libnemsio.a</span><br></pre></td></tr></table></figure>

<ul>
<li>拷贝生成的可执行文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cp bin/gsi.x        $&#123;BASE&#125;/../exec/rap_gsi</span><br><span class="line">cp bin/enkf_wrf.x   $&#123;BASE&#125;/../exec/rap_enkf</span><br><span class="line">cp bin/enspreproc.x $&#123;BASE&#125;/../exec/rap_process_enkf</span><br><span class="line">cp bin/initialens.x $&#123;BASE&#125;/../exec/rap_initialens</span><br></pre></td></tr></table></figure>



<h3 id="编译rap-full-cycle-surface"><a href="#编译rap-full-cycle-surface" class="headerlink" title="编译rap_full_cycle_surface"></a>编译<code>rap_full_cycle_surface</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd $&#123;BASE&#125;/rap_full_cycle_surface.fd</span><br></pre></td></tr></table></figure>

<ul>
<li>修改<code>makefile</code>部分如下：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FC       = mpif90</span><br><span class="line"></span><br><span class="line">FLAGS = -fopenmp</span><br><span class="line"></span><br><span class="line">NWPLIBS = $&#123;W3NCO_LIB4&#125; $&#123;BACIO_LIB4&#125; $&#123;W3EMC_LIB4&#125;</span><br><span class="line">INCLD = -I$&#123;NETCDF&#125;/include # -I$&#123;WRF_IO_INC&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>spack_rap_load.sh</code>中添加以下内容后重新source</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export WRF_IO_LIB=$SPACK_LIB/libwrf_io.a</span><br><span class="line">export W3NCO_LIB4=$SPACK_LIB/libw3nco_4.a</span><br><span class="line">export W3EMC_LIB4=$SPACK_LIB/libw3emc_4.a</span><br><span class="line">export BACIO_LIB4=$SPACK_LIB/libbacio_4.a</span><br></pre></td></tr></table></figure>

<ul>
<li>make</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make clean</span><br><span class="line">make</span><br></pre></td></tr></table></figure>

<ul>
<li>不报错并生成<code>*.o</code></li>
</ul>
<h3 id="编译-rap-process-cloud"><a href="#编译-rap-process-cloud" class="headerlink" title="编译 rap_process_cloud"></a>编译 <code>rap_process_cloud</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd $&#123;BASE&#125;/rap_process_cloud.fd  </span><br></pre></td></tr></table></figure>

<ul>
<li>修改<code>makefile</code>部分如下</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FC       = mpif90</span><br><span class="line"></span><br><span class="line">INCLD=  -I$&#123;NETCDF&#125;/include # -I$&#123;WRF_IO_INC&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>make</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make clean</span><br><span class="line">make</span><br></pre></td></tr></table></figure>



<h3 id="编译-rap-update-fields"><a href="#编译-rap-update-fields" class="headerlink" title="编译 rap_update_fields"></a>编译 <code>rap_update_fields</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd $&#123;BASE&#125;/rap_update_fields.fd</span><br></pre></td></tr></table></figure>

<ul>
<li>修改<code>makefile</code>部分如下</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FC       = mpif90</span><br><span class="line">FLAGS = -fopenmp</span><br><span class="line">INCLD= -I$&#123;NETCDF&#125;/include #-I$&#123;WRF_IO_INC&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>make</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make clean</span><br><span class="line">make</span><br></pre></td></tr></table></figure>



<h3 id="编译-rap-process-sst"><a href="#编译-rap-process-sst" class="headerlink" title="编译 rap_process_sst"></a>编译 <code>rap_process_sst</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd $&#123;BASE&#125;/rap_process_sst.fd</span><br></pre></td></tr></table></figure>

<ul>
<li>修改<code>makefile</code>部分如下</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FC       = mpif90</span><br><span class="line"></span><br><span class="line">FLAGS = -fopenmp</span><br><span class="line">NWPLIBS = $&#123;G2_LIB4&#125; $&#123;JASPER_LIB&#125; $&#123;PNG_LIB&#125; $&#123;Z_LIB&#125; $&#123;W3NCO_LIB4&#125; $&#123;BACIO_LIB4&#125;</span><br><span class="line"></span><br><span class="line">W3FLAGS = # -I/$&#123;W3NCO_INC4&#125;</span><br><span class="line">INCLD= -I$&#123;NETCDF&#125;/include -I$&#123;G2_INC4&#125; # -I$&#123;WRF_IO_INC&#125; -I$&#123;G2_INC4&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>spack_rap_load.sh</code>中添加以下内容后重新source</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export G2_LIB4=$SPACK_LIB/libg2_4.a</span><br><span class="line">export G2_INC4=/home/lxc/work_station/spack/opt/spack/linux-ubuntu24.04-x86_64_v3/gcc-5.4.0/g2-3.4.5-wclfxhd2sdu5bkqmivp2hryf3ctfmce3/include_4/</span><br><span class="line"></span><br><span class="line">export JASPER_LIB=$SPACK_LIB/libjasper.so</span><br><span class="line">export PNG_LIB=$SPACK_LIB/libpng.a</span><br><span class="line">export Z_LIB=$SPACK_LIB/libz.so.1.3.1.zlib-ng</span><br></pre></td></tr></table></figure>

<ul>
<li>make</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make clean</span><br><span class="line">make</span><br></pre></td></tr></table></figure>



<h3 id="编译-rap-update-gvf"><a href="#编译-rap-update-gvf" class="headerlink" title="编译 rap_update_gvf"></a>编译 <code>rap_update_gvf</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd $&#123;BASE&#125;/rap_update_gvf.fd</span><br></pre></td></tr></table></figure>

<ul>
<li>修改<code>makefile</code>部分如下</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FC       = mpif90</span><br><span class="line">INCLD=  -I$&#123;NETCDF&#125;/include -I$&#123;G2_INC4&#125; # -I$&#123;WRF_IO_INC&#125; -I$&#123;G2_INC4&#125; -I$&#123;G2TMPL_INC&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>make</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make clean</span><br><span class="line">make</span><br></pre></td></tr></table></figure>



<h3 id="编译-rap-process-imssnow-fd"><a href="#编译-rap-process-imssnow-fd" class="headerlink" title="编译 rap_process_imssnow.fd"></a>编译 <code>rap_process_imssnow.fd</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd $&#123;BASE&#125;/rap_process_imssnow.fd</span><br></pre></td></tr></table></figure>

<ul>
<li>修改<code>makefile</code>部分如下</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FC       = mpif90</span><br><span class="line">FLAGS = -fopenmp</span><br><span class="line">INCLD= -I$&#123;NETCDF&#125;/include -I$&#123;G2_INC4&#125; -I$&#123;IP_INC4&#125; </span><br></pre></td></tr></table></figure>

<ul>
<li><code>spack_rap_load.sh</code>中添加以下内容后重新source</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export G2_INC4=/home/lxc/work_station/spack/opt/spack/linux-ubuntu24.04-x86_64_v3/gcc-5.4.0/g2-3.4.5-wclfxhd2sdu5bkqmivp2hryf3ctfmce3/include_4/</span><br></pre></td></tr></table></figure>

<ul>
<li>make</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make clean</span><br><span class="line">make</span><br></pre></td></tr></table></figure>

<h2 id="安装HRRR"><a href="#安装HRRR" class="headerlink" title="安装HRRR"></a>安装HRRR</h2><p>相同操作参考RAP的流程即可</p>
<h3 id="编译-hrrr-process-mosaic"><a href="#编译-hrrr-process-mosaic" class="headerlink" title="编译 hrrr_process_mosaic"></a>编译 <code>hrrr_process_mosaic</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd $&#123;BASE&#125;/hrrr_process_mosaic.fd</span><br></pre></td></tr></table></figure>

<ul>
<li>修改<code>makefile</code>部分如下</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FC       = mpif90</span><br><span class="line">FLAGS    = -frounding-math -frecord-marker=4 -ffpe-trap=invalid,zero,overflow -DLINUX</span><br><span class="line">INCLD=  -I$&#123;NETCDF_INCLUDE&#125; -I$&#123;G2_INC4&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>make</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make clean</span><br><span class="line">make</span><br></pre></td></tr></table></figure>



<h3 id="编译-hrrr-process-lightning"><a href="#编译-hrrr-process-lightning" class="headerlink" title="编译 hrrr_process_lightning"></a>编译 <code>hrrr_process_lightning</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd $&#123;BASE&#125;/hrrr_process_lightning.fd</span><br></pre></td></tr></table></figure>

<ul>
<li>修改<code>makefile</code>部分如下</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FC       = mpif90</span><br></pre></td></tr></table></figure>

<ul>
<li>make</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make clean</span><br><span class="line">make</span><br></pre></td></tr></table></figure>





<h3 id="编译-hrrr-update-gvf"><a href="#编译-hrrr-update-gvf" class="headerlink" title="编译 hrrr_update_gvf"></a>编译 <code>hrrr_update_gvf</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd $&#123;BASE&#125;/hrrr_update_gvf.fd</span><br></pre></td></tr></table></figure>

<ul>
<li>apack 安装 g2c</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spack add g2c@1.6.2%gcc@5.4.0</span><br><span class="line">spack concretize</span><br><span class="line">spack install</span><br></pre></td></tr></table></figure>

<ul>
<li>修改<code>makefile</code>部分如下</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">FC       = mpif90</span><br><span class="line"></span><br><span class="line">NWPLIBS = $&#123;G2TMPL_LIB&#125; $&#123;G2_LIB4&#125; $&#123;JASPER_LIB&#125; $&#123;PNG_LIB&#125; $&#123;Z_LIB&#125; $&#123;BACIO_LIB4&#125; $&#123;W3EMC_LIB4&#125; $&#123;W3NCO_LIB4&#125; $&#123;BUFR_LIB4&#125; $&#123;G2C_LIB&#125;</span><br><span class="line"></span><br><span class="line">INCLD=  -I$&#123;NETCDF_INCLUDE&#125; -I$&#123;G2_INC4&#125; -I$&#123;G2TMPL_INC&#125;</span><br><span class="line"></span><br><span class="line">LIBS =  -L$&#123;NWPLIBS&#125; $&#123;WRF_IO_LIB&#125; \</span><br><span class="line">        -L$&#123;NETCDF&#125;/lib -lnetcdf -lnetcdff -lg2_4 -lg2c -lpng -lz -ljasper</span><br></pre></td></tr></table></figure>

<ul>
<li><code>spack_rap_load.sh</code>中添加以下内容后重新source</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export G2TMPL_INC=/home/lxc/work_station/spack/opt/spack/linux-ubuntu24.04-x86_64_v3/gcc-5.4.0/g2tmpl-1.13.0-rk5g5cg6dq6mfu3whjx2vonyoa2xseot/</span><br><span class="line">export G2C_LIB=$SPACK_LIB/libg2c.a</span><br></pre></td></tr></table></figure>

<ul>
<li>make</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make clean</span><br><span class="line">make</span><br></pre></td></tr></table></figure>



<h3 id="编译-hrrr-ref2tten"><a href="#编译-hrrr-ref2tten" class="headerlink" title="编译 hrrr_ref2tten"></a>编译 <code>hrrr_ref2tten</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd $&#123;BASE&#125;/hrrr_ref2tten.fd</span><br></pre></td></tr></table></figure>

<ul>
<li>修改<code>makefile</code>部分如下</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FC   = mpif90</span><br><span class="line"></span><br><span class="line">FLAGS= #-assume byterecl</span><br><span class="line"></span><br><span class="line">hrrr_ref2tten: $&#123;OBJS&#125; gsdcloudanalysis_ref2tten.o</span><br><span class="line">        $&#123;FC&#125; -fopenmp -o ../../exec/hrrr_ref2tten $&#123;FLAGS&#125; gsdcloudanalysis_ref2tten.o $&#123;OBJS&#125; $&#123;LIBS&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>make</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make clean</span><br><span class="line">make</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/05/01/Tool/SCP/" rel="prev" title="SCP">
      <i class="fa fa-chevron-left"></i> SCP
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/05/01/Tool/RAP%20run/" rel="next" title="RAP run">
      RAP run <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A8%E8%8D%90-spack-%E5%BA%95%E5%B1%82%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="nav-number">1.</span> <span class="nav-text">推荐 spack 底层环境配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%AD%90%EF%B8%8F-%E5%8F%AF%E9%80%89-hpc-stack-%E5%AE%89%E8%A3%85%E5%9F%BA%E6%9C%AC%E8%BD%AF%E4%BB%B6%E4%BE%9D%E8%B5%96"><span class="nav-number">1.1.</span> <span class="nav-text">⭐️ 可选 hpc-stack 安装基本软件依赖</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85RAP"><span class="nav-number">2.</span> <span class="nav-text">安装RAP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91-rap-wrfarw-serial"><span class="nav-number">2.1.</span> <span class="nav-text">编译 rap_wrfarw_serial</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91rap-update-bc"><span class="nav-number">2.2.</span> <span class="nav-text">编译rap_update_bc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91-rap-wrfpost"><span class="nav-number">2.3.</span> <span class="nav-text">编译 rap_wrfpost</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91-rap-wps"><span class="nav-number">2.4.</span> <span class="nav-text">编译 rap_wps</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91-rap-wrfarw"><span class="nav-number">2.5.</span> <span class="nav-text">编译 rap_wrfarw</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E8%AF%91-rap-gsi"><span class="nav-number">3.</span> <span class="nav-text">编译 rap_gsi</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91rap-full-cycle-surface"><span class="nav-number">3.1.</span> <span class="nav-text">编译rap_full_cycle_surface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91-rap-process-cloud"><span class="nav-number">3.2.</span> <span class="nav-text">编译 rap_process_cloud</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91-rap-update-fields"><span class="nav-number">3.3.</span> <span class="nav-text">编译 rap_update_fields</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91-rap-process-sst"><span class="nav-number">3.4.</span> <span class="nav-text">编译 rap_process_sst</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91-rap-update-gvf"><span class="nav-number">3.5.</span> <span class="nav-text">编译 rap_update_gvf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91-rap-process-imssnow-fd"><span class="nav-number">3.6.</span> <span class="nav-text">编译 rap_process_imssnow.fd</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85HRRR"><span class="nav-number">4.</span> <span class="nav-text">安装HRRR</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91-hrrr-process-mosaic"><span class="nav-number">4.1.</span> <span class="nav-text">编译 hrrr_process_mosaic</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91-hrrr-process-lightning"><span class="nav-number">4.2.</span> <span class="nav-text">编译 hrrr_process_lightning</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91-hrrr-update-gvf"><span class="nav-number">4.3.</span> <span class="nav-text">编译 hrrr_update_gvf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91-hrrr-ref2tten"><span class="nav-number">4.4.</span> <span class="nav-text">编译 hrrr_ref2tten</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ruyanc"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">ruyanc</p>
  <div class="site-description" itemprop="description">E-mail: ruyan1810@gmail.com</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">232</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>




      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ruyanc</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.3" zIndex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>




  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true,"scale":0.5},"log":false});</script></body>
</html>

